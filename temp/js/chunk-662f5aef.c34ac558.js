(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-662f5aef"],{"024c":function(e,t,i){"use strict";var s=i("9ab4"),r=i("2b0e"),a=i("2fe1");let n=class extends r["default"]{get pane(){return this.$store.state.panes.panes[this.paneId]}mounted(){this.$el.id=this.paneId,this.refreshZoom(),this.$nextTick(()=>{const e=this.$el.clientWidth;"function"===typeof this.onResize&&this.onResize(e,this.$el.clientHeight,!0)}),this.$el.addEventListener("mousedown",this.focusPane)}beforeDestroy(){this.$el.removeEventListener("mousedown",this.focusPane),this._onStoreMutation&&this._onStoreMutation()}refreshZoom(){this.$store.dispatch("panes/refreshZoom",this.paneId)}focusPane(){this.$store.commit("app/SET_FOCUSED_PANE",this.paneId)}};n=Object(s["a"])([Object(a["b"])({props:{paneId:{required:!0,type:String}}})],n),t["a"]=n},"043b":function(e,t,i){},1636:function(e,t,i){},"207f":function(e,t,i){"use strict";i("86bd")},"3ef3":function(e,t,i){"use strict";i("1636")},"82d7":function(e,t,i){"use strict";i("ec49")},"83ff":function(e,t,i){},"86bd":function(e,t,i){},"876a":function(e,t,i){},"8c91":function(e,t,i){"use strict";var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"pane-header hide-scrollbar pane-overlay d-flex",class:{"-loading":e.loading}},[t("div",{staticClass:"pane-header__loader"}),t("span",{staticClass:"pane-header__name ml4 mrauto",attrs:{"data-hide-header":""},on:{dblclick:e.renamePane}},[e._v(e._s(e.name))]),t("div",{staticClass:"toolbar flex-grow-1",on:{dblclick:e.maximizePane}},[e._t("default"),t("button",{staticClass:"toolbar__label min-768",attrs:{type:"button"},on:{click:e.openSearch}},[t("i",{staticClass:"icon-search"})]),e.settings?t("button",{staticClass:"toolbar__label min-768",attrs:{type:"button"},on:{click:e.openSettings}},[t("i",{staticClass:"icon-cog"})]):e._e(),t("button",{staticClass:"toolbar__label",attrs:{type:"button"},on:{click:e.toggleDropdown}},[t("i",{staticClass:"icon-more"})]),t("dropdown",{model:{value:e.paneDropdownTrigger,callback:function(t){e.paneDropdownTrigger=t},expression:"paneDropdownTrigger"}},[t("div",{staticClass:"d-flex btn-group"},[t("button",{staticClass:"btn -green",attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.changeZoom(t,-1)}}},[t("i",{staticClass:"icon-minus"})]),t("button",{staticClass:"btn -green text-monospace flex-grow-1 text-center",attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.resetZoom.apply(null,arguments)}}},[e._v(" × "+e._s(e.zoom.toFixed(2))+" ")]),t("button",{staticClass:"btn -green",attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.changeZoom(t,1)}}},[t("i",{staticClass:"icon-plus"})])]),e._t("menu"),null!==e.settings?t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.openSettings}},[t("i",{staticClass:"icon-cog"}),t("span",[e._v("Settings")])]):e._e(),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.$store.dispatch("app/showSearch",e.paneId)}}},[t("i",{staticClass:"icon-search"}),t("span",[e._v("Sources")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.maximizePane}},[t("i",{staticClass:"icon-enlarge"}),t("span",[e._v("Maximize")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.duplicatePane}},[t("i",{staticClass:"icon-copy-paste"}),t("span",[e._v("Duplicate")])]),t("div",{staticClass:"dropdown--divider"}),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.removePane}},[t("i",{staticClass:"icon-trash"}),t("span",[e._v("Remove")])])],2)],2)])},r=[],a=i("9ab4"),n=i("2b0e"),o=i("2fe1"),c=i("28f3"),l=i("0c01");let h=class extends n["default"]{constructor(){super(...arguments),this.paneDropdownTrigger=null}get zoom(){return this.$store.state.panes.panes[this.paneId].zoom||1}get type(){return this.$store.state.panes.panes[this.paneId].type}get name(){const e=this.$store.state.panes.panes[this.paneId].name,t=this.$store.state.panes.marketsListeners[this.$store.state.panes.panes[this.paneId].markets[0]];return e||(t?t.local:this.type)}openSearch(){this.$store.dispatch("app/showSearch",this.paneId)}changeZoom(e,t){const i=this.zoom+(e.shiftKey?.0625:.125)*t;this.$store.dispatch("panes/setZoom",{id:this.paneId,zoom:i}),this.$emit("zoom",i)}resetZoom(){this.$store.dispatch("panes/setZoom",{id:this.paneId,zoom:1}),this.$emit("zoom",1)}async removePane(){await l["a"].confirm(`Delete pane "${this.paneId}" ?`)&&this.$store.dispatch("panes/removePane",this.paneId)}duplicatePane(){this.$store.dispatch("panes/duplicatePane",this.paneId)}highlightPane(e){this.$el.parentElement.parentElement.classList[e?"add":"remove"]("-highlight")}maximizePane(e){if("dblclick"===e.type&&e.currentTarget!==e.target&&"toolbar__spacer"!==e.target.className)return;const t=this.$el.parentElement.parentElement,i=t.classList.toggle("-maximized"),s=Object(c["o"])(t);for(const a of s)a.getAttribute("type")&&(a.classList.remove("-maximized"),a.style.display=i?"none":"block");const r=Event;window.dispatchEvent(new r("resize"))}async renamePane(){const e=await l["a"].prompt({action:"Rename",input:this.name});e!==this.name&&this.$store.commit("panes/SET_PANE_NAME",{id:this.paneId,name:e})}toggleDropdown(e){this.paneDropdownTrigger?this.paneDropdownTrigger=null:this.paneDropdownTrigger=e.currentTarget}async openSettings(){this.settings&&l["a"].open((await this.settings()).default,{paneId:this.paneId})}};h=Object(a["a"])([Object(o["b"])({name:"PaneHeader",props:{paneId:{type:String},settings:{type:Function,default:null},loading:{type:Boolean,default:!1}}})],h);var d=h,p=d,u=i("2877"),m=Object(u["a"])(p,s,r,!1,null,null,null);t["a"]=m.exports},"8d64":function(e,t,i){"use strict";i("902c")},"8ffc":function(e,t,i){"use strict";i("876a")},"902c":function(e,t,i){},"9d1c":function(e,t,i){"use strict";i("83ff")},aa6c:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"pane-chart"},[t("pane-header",{attrs:{paneId:e.paneId,settings:()=>i.e("chunk-ebc5e646").then(i.bind(null,"be9d"))},scopedSlots:e._u([{key:"menu",fn:function(){return[t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.toggleLayout}},[t("i",{staticClass:"icon-resize-height"}),t("span",[e._v("Arrange")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.resetChart}},[t("i",{staticClass:"icon-refresh"}),t("span",[e._v("Restart")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.takeScreenshot}},[t("i",{staticClass:"icon-add-photo"}),t("span",[e._v("Snapshot")])]),t("div",{staticClass:"dropdown-divider"})]},proxy:!0}])},[e._l(e.favoriteTimeframes,(function(i,s){return t("button",{key:s,staticClass:"toolbar__label timeframe",attrs:{title:"Maintain shift key to change timeframe on all panes"},on:{click:function(t){return e.changeTimeframe(s)}}},[t("span",[e._v(e._s(i))])])})),t("button",{staticClass:"-arrow toolbar__label",on:{click:e.toggleTimeframeDropdown}},[e._v(" "+e._s(e.timeframeForHuman)+" ")]),t("dropdown",{model:{value:e.timeframeDropdownTrigger,callback:function(t){e.timeframeDropdownTrigger=t},expression:"timeframeDropdownTrigger"}},[t("timeframe-dropdown",{staticClass:"timeframe-dropdown",attrs:{"pane-id":e.paneId},on:{timeframe:function(t){return e.changeTimeframe(t)}}})],1)],2),t("div",{staticClass:"chart-overlay hide-scrollbar"},[t("indicators-overlay",{attrs:{"pane-id":e.paneId},on:{input:function(t){t?e.bindLegend():e.unbindLegend()}},model:{value:e.showIndicatorsOverlay,callback:function(t){e.showIndicatorsOverlay=t},expression:"showIndicatorsOverlay"}}),t("markets-overlay",{attrs:{"pane-id":e.paneId}})],1),t("div",{ref:"chartContainer",staticClass:"chart__container"},[e.layouting?t("chart-layout",{attrs:{"pane-id":e.paneId,layouting:e.layouting,axis:e.axis}}):e._e()],1)],1)},r=[],a=i("9ab4"),n=i("60a3"),o=i("9613"),c=i("28f3"),l=i("ecab"),h=i("0613");function d(e){e.state.open=e.state.close,e.state.high=e.state.close,e.state.low=e.state.close}function p(e){e.state.point={open:e.state.open,high:e.state.high,low:e.state.low,close:e.state.close}}function u(e){e.state.open=null,e.state.high=null,e.state.low=null}function m(e){e.state.points.push(e.state.output),e.state.count++,e.state.count>e.length-1&&(e.state.points.shift(),e.state.count--)}function f(e){e.state.points.push(e.state.output),e.state.sum+=e.state.output,e.state.count++,e.state.count>e.length-1&&(e.state.sum-=e.state.points.shift(),e.state.count--)}function g(e){e.state.lows.push(e.state.low),e.state.highs.push(e.state.high),e.state.count++,e.state.count>e.length-1&&(e.state.lows.shift(),e.state.highs.shift(),e.state.count--)}var v={avg_ohlc:{state:{open:null,high:null,low:null,close:null},next:d,update(e,t){let i,s=0,r=!1,a=0,n=0,o=0;null===e.open&&(r=!0,i=0);for(const c in t.sources)t.sources[c].active&&null!==t.sources[c].open&&(r&&(i+=t.sources[c].open),a+=t.sources[c].high,n+=t.sources[c].low,o+=t.sources[c].close,s++);return s?(r&&(e.open=i/s),e.high=Math.max(e.open,a/s),e.low=Math.min(e.open,n/s),e.close=o/s,{time:t.localTimestamp,open:e.open,high:e.high,low:e.low,close:e.close}):{time:t.localTimestamp}}},avg_heikinashi:{state:{open:null,high:null,low:null,close:null},next:p,update(e,t){let i=0;e.open=0,e.high=0,e.low=0,e.close=0;for(const s in t.sources)t.sources[s].active&&null!==t.sources[s].open&&(e.open+=t.sources[s].open,e.high+=t.sources[s].high,e.low+=t.sources[s].low,e.close+=t.sources[s].close,i++);return i||(i=1),e.high/=i,e.low/=i,e.open/=i,e.close=(e.open+e.high+e.low+e.close/i)/4,"undefined"!==typeof e.point?e.open=(e.point.open+e.point.close)/2:e.open=(e.open+e.close)/2,e.low=Math.min(e.open,e.low,e.close),e.high=Math.max(e.open,e.high,e.close),{time:t.localTimestamp,open:e.open,high:e.high,low:e.low,close:e.close}}},avg_ohlc_with_gaps:{state:{open:null,high:null,low:null,close:null},next:u,update(e,t){let i=0,s=0,r=0,a=0,n=0;for(const o in t.sources)t.sources[o].active&&null!==t.sources[o].open&&(s+=t.sources[o].open,r+=t.sources[o].high,a+=t.sources[o].low,n+=t.sources[o].close,i++);return i?(e.open=s/i,e.high=Math.max(null===e.high?-1/0:e.high,r/i),e.low=Math.min(null===e.low?1/0:e.low,a/i),e.close=n/i,{time:t.localTimestamp,open:e.open,high:e.high,low:e.low,close:e.close}):{time:t.localTimestamp}}},avg_close:{update(e,t){let i=0;e.close=0;for(const s in t.sources)null!==t.sources[s].open&&(e.close+=t.sources[s].close,i++);return i||(i=1),e.close/=i,e.close}},ohlc:{args:[{instruction:"renderer.localTimestamp",injected:!0}],next:d,update(e,t,i){return"undefined"===typeof e.open&&(e.open=i,e.high=i,e.low=i),e.high=Math.max(e.high,i),e.low=Math.min(e.low,i),e.close=i,{time:t,open:e.open,high:e.high,low:e.low,close:e.close}}},cum_ohlc:{args:[{instruction:"renderer.localTimestamp",injected:!0}],next:d,update(e,t,i){return"undefined"===typeof e.open?(e.open=i,e.high=i,e.low=i):i=e.open+i,e.high=Math.max(e.high,i),e.low=Math.min(e.low,i),e.close=i,{time:t,open:e.open,high:e.high,low:e.low,close:e.close}}},cum:{next:d,update(e,t){return"undefined"===typeof e.open&&(e.open=t),e.close=e.open+t,e.close}},pivot_high:{args:[{},{length:!0},{length:!0}],state:{points:[],count:0},next:m,update(e,t,i,s){e.output=t;let r=e.points[i];"undefined"===typeof r&&(r=t);const a=i+s;for(let n=0;n<=a;n++){const i=n<a-1?e.points[n]:t;if(i>r)return null}return r}},pivot_low:{args:[{},{length:!0},{length:!0}],state:{points:[],count:0},next:m,update(e,t,i,s){e.output=t;let r=e.points[i];"undefined"===typeof r&&(r=t);const a=i+s;for(let n=0;n<=a;n++){const i=n<a-1?e.points[n]:t;if(i<r)return null}return r}},highest:{args:[{},{length:!0}],state:{points:[],count:0},next:m,update(e,t,i){return e.output=t,e.count>1?Math.max.apply(null,e.points):t}},lowest:{args:[{},{length:!0}],state:{points:[],count:0},next:m,update(e,t,i){return e.output=t,e.count>1?Math.min.apply(null,e.points):t}},linreg:{args:[{},{length:!0}],state:{points:[],count:0},next:m,update(e,t,i){if(e.output=t,e.count<1)return null;let s=0,r=0,a=0,n=0,o=0,c=0;for(let p=0;p<=e.points.length;p++){const i=p===e.points.length?t:e.points[p];r=p+1,a+=r,n+=i,o+=r*r,c+=i*r,s++}const l=(s*c-a*n)/(s*o-a*a),h=n/s,d=h-l*a/i+l;return d+l*(s-1)}},avg:{update(e,t){let i=0,s=0;for(let r=0;r<t.length;r++)null!==t[r]&&(s+=t[r],i++);return s/i}},sum:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:f,update(e,t){return e.output=t,e.sum+t}},sma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:f,update(e,t){const i=(e.sum+t)/(e.count+1);return e.output=t,i}},cma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:f,update(e,t){return e.output=(e.sum+t)/(e.count+1),e.output}},ema:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:f,update(e,t,i){const s=2/(i+1);if(e.count){const i=e.points[e.points.length-1];e.output=(t-i)*s+i}else e.output=t;return e.output}},last:{args:[{},{length:!0}],state:{points:[],count:0},next:m,update(e,t){return e.output=t,e.count?e.points[0]:t}},rma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:f,update(e,t,i){const s=1/i;if(e.count){const i=e.points[e.points.length-1];e.output=s*t+(1-s)*i}else e.output=1;return e.output}},merge_overlapping_intervals:{update(e,t){return t.sort((e,t)=>e[0]-t[0]).reduce((e,t)=>{const i=e.length-1,s=e[i],r=s[1],a=t[0];return r>=a?e[i][1]=Math.max(r,t[1]):e.push(t),e},[t[0]])}},reverse_intervals:{update(e,t){return t.reduce((e,t,i,s)=>(i>0&&(e[i-1][1]=t[0]),i<s.length-1&&e.push([t[1]]),e),[])}},stoch:{args:[null,null,null,{length:!0}],state:{count:0,lows:[],highs:[]},next:g,update(e,t,i,s){e.low=s;const r=e.count>0?Math.min(Math.min.apply(null,e.lows),s):s;e.high=i;const a=e.count>0?Math.max(Math.max.apply(null,e.highs),i):i;return e.output=100*(t-r)/(a-r||1),e.output}}},b=i("8192");class I{constructor(){this.chunks=[],this.cacheRange={from:null,to:null},this.initialPrices={}}saveChunk(e){let t;if(!this.chunks.length||this.chunks[this.chunks.length-1].to<e.from)t=this.chunks.push(e)-1;else{if(!(this.chunks[0].from>e.to))return;this.chunks.unshift(e),t=0}return 0===t&&(this.cacheRange.from=e.from),t===this.chunks.length-1&&(this.cacheRange.to=e.to),e}clear(){this.chunks.splice(0,this.chunks.length),this.cacheRange.from=this.cacheRange.to=null,this.initialPrices={}}trim(e){if(!this.chunks.length)return;let t=!1;while(this.chunks[0]&&this.chunks[0].to<e)this.chunks.splice(0,1),t=!0;return this.cacheRange.from=this.chunks[0].from,t}}const y=/series\[[a-zA-Z0-9+\-$ ]+\]\.update\(/,_="vars",C="fns",w={candlestick:"ohlc",bar:"ohlc",line:"number",histogram:"number",area:"number",cloudarea:"range",brokenarea:"range",baseline:"number"};class k{build(e,t,i){this.paneId=i,this.indicatorId=e.id,this.serieIndicatorsMap=t,this.markets=[];for(const r of h["b"].state.panes.panes[this.paneId].markets)-1===this.markets.indexOf(r)&&this.markets.push(r);const s=this.parse(e.script);for(const r of s.functions)this.determineFunctionState(r);for(const r of s.variables)this.determineVariableState(r);return{output:s.output,silentOutput:s.silentOutput,functions:s.functions,variables:s.variables,references:s.references,markets:s.markets,plots:s.plots}}normalizeInput(e,t){e=e.replace(/([^.])?\b(indicatorId)\b/gi,`$1'${this.indicatorId}'`),e=e.replace(/([^.])?\b(bar)\b/gi,"$1renderer"),e=e.replace(/([^.]|^)\b(vbuy|vsell|cbuy|csell|lbuy|lsell)\b/gi,"$1renderer.bar.$2"),e=e.replace(/([^.]|^)\b(time)\b([^:])/gi,"$1renderer.localTimestamp$3"),e=e.replace(/(\n|^)\s*?\/\/.*/g,"");const i=/'([^']*)'|"([^"]*)"/;let s=null,r=0;do{if(s=i.exec(e)){let i=t.indexOf(s[0]);-1===i&&(i=t.push(s[0])-1),e=e.slice(0,s.index)+"#STRING_"+i+"#"+e.slice(s.index+s[0].length)}}while(s&&++r<1e3);const a=/\(/g;let n;r=0;do{if(n=a.exec(e)){const t=Object(c["g"])(e,n.index,/\(|{|\[/,/\)|}|\]/);if(-1!==t){const i=e.slice(n.index+1,t).replace(/\n/g," ");e=e.slice(0,n.index)+e.slice(n.index,n.index+1)+i.replace(/\n/g,"")+e.slice(t,t+1)+"\n"+e.slice(t+1,e.length),a.lastIndex=t}}}while(n&&++r<1e3);return e}determineFunctionState(e){if(v[e.name],"object"!==typeof v[e.name].state)e.state={};else{e.state={};for(const i in v[e.name].state)try{e.state[i]=JSON.parse(JSON.stringify(v[e.name].state[i]))}catch(t){e.state[i]=v[e.name].state[i]}}}determineVariableState(e){e.length>1?e.state=[0]:e.state=0}getSilentOutput(e){let t=e,i=null,s=0;do{if(i=y.exec(t)){const e=i.index+i[0].length-1,s=Object(c["g"])(t,e);t=t.replace(i[0]+t.slice(e+1,s+1),1)}}while(i&&++s<1e3);return t}parse(e){const t=[],i=[],s=[],r={},a=[],n=[];let o=this.normalizeInput(e,n);o=this.parseVariables(o,i),o=this.parseMarkets(o,r);for(let l=0;l<n.length;l++)o=o.replace(new RegExp("#STRING_"+l+"#","g"),n[l].replace(/\$/g,"$$$"));o=this.parseFunctions(o,t,s),o=this.parseReferences(o,a,s),o=this.formatOutput(o);const c=this.getSilentOutput(o);return{output:o,silentOutput:c,functions:t,variables:i,plots:s,markets:r,references:a}}formatOutput(e){const t=/\(|{|\[/g;let i,s=0;do{if(i=t.exec(e)){const s="("===i[0],r=Object(c["g"])(e,i.index,/\(|{|\[/,/\)|}|\]/),a=e.slice(i.index+1,r).replace(/\n/g," ");/if|for|else/.test(e.slice(i.index-2,2))&&(e=e.slice(0,i.index)+e.slice(i.index,i.index+1)+a+e.slice(r,r+1)+(s?"\n":"")+e.slice(r+1,e.length)),t.lastIndex=r}}while(i&&++s<1e3);const r=e.trim().split(/\n/);for(let a=0;a<r.length;a++){const e=r[a].match(/renderer.sources\['[\w/:_-]+']\.\w+/g);e&&1===e.length&&(r[a]=`if (${e[0]}) {\n          ${r[a]}\n        }`)}return r.join("\n").replace(/\n\n/g,"\n")}parseVariables(e,t){const i=/(?:^|\n)\s*((?:var )?[a-zA-Z0-9_]+)\(?(\d*)\)?\s*=\s*([^\n;,]*)?/;let s=null,r=0;const a=[];do{if(s=i.exec(e)){let i=s[1];const r=/^var/.test(i);if(-1!==a.indexOf(i)||r){r&&(i=i.replace(/var\s*/,""),e=e.replace(s[0],"\nvar "+i+"="+s[3]),a.push(i)),e=e.replace(new RegExp("([^.$]|^)\\b("+i+")\\b(?!:)(?!\\()(?!\\$)","ig"),`$1${i}$`);continue}const n=+s[2]||1;e=e.replace(new RegExp("([^.]|^)\\b("+i+")\\b(?!:)","ig"),`$1${_}[${t.length}]`);const o={length:n};t.push(o),e=e.replace(new RegExp(`(${_}\\[${t.length-1}\\])\\(${o.length}\\)\\s*=\\s*`),"$1=")}}while(s&&++r<1e3);return e=this.determineVariablesType(e,t),e}parseSerie(e,t,i){const s=t[1].replace(/^plot/,""),r=Object(c["g"])(e,t.index+t[1].length),a=e.slice(t.index+t[1].length+1,r),n=t[1]+"("+a+")",o=Object(c["t"])(a),h={};for(let c=1;c<o.length;c++)try{const[,e,t]=o[c].match(/^(\w+)\s*=(.*)/);if(!e||!t.length)continue;let i=t.trim();try{i=JSON.parse(i)}catch(_){}h[e.trim()]=i,o.splice(c,1),c--}catch(_){continue}const d=`renderer.indicators['${this.indicatorId}'].series[${i.length}]`;let p=d+" = ";const u=w[s];let m="renderer.localTimestamp";h.offset&&(m+="+renderer.timeframe*"+h.offset);const f=/{/.test(o[0])&&/}/.test(o[0]),g=/^[\w_$]+\$/.test(o[0]);if(1===o.length&&(f||"line"!==s&&g))p+=o[0];else if("ohlc"===u)if(4===o.length)p+=`{ time: ${m}, open: ${o[0]}, high: ${o[1]}, low: ${o[2]}, close: ${o[3]} }`;else{if(1!==o.length)throw new Error(`Invalid input for function ${t[1]}, expected a ohlc object or 4 number`);/^[A-Z_]+:\w+/.test(o[0])?p+=`${o[0]}.close === null ? { time: ${m} } : { time: ${m}, open: ${o[0]}.open, high: ${o[0]}.high, low: ${o[0]}.low, close: ${o[0]}.close }`:p+=o[0]}else if("range"===u){if(2!==o.length)throw new Error(`Invalid input for function ${t[1]}, expected 2 arguments (lowerValue and higherValue)`);p+=`{ time: ${m}, lowerValue: ${o[0]}, higherValue: ${o[1]} }`}else if("number"===u){if(1!==o.length)throw new Error(`Invalid input for function ${t[1]}, expected 1 value (number)`);p+=`{ time: ${m}, value: ${o[0]} }`}const v=`series[${i.length}].update(renderer.indicators['${this.indicatorId}'].series[${i.length}])`;let b,I=p+",";"histogram"===s?I+=d+".value&&":"line"===s?I+=d+".value !== null&&":"cloudarea"!==s&&"brokenarea"!==s||(I+=d+".lowerValue !== null&&"),I+=v,e=e.replace(n,I),"string"===typeof h.id&&h.id.length?(b=h.id,delete h.id):b=0===i.length?this.indicatorId:Object(c["v"])(8);const y=Object.keys(this.serieIndicatorsMap).concat(i.map(e=>e.id));return i.push({id:Object(c["y"])(b,y),type:l["i"][s]||s,expectedInput:u,options:h}),e}parseFunctions(e,t,i){const s=new RegExp("([a-zA-Z0_9_]+)\\(","g");let r=null,a=0;do{if(r=s.exec(e)){const a=r[1],n=Object.prototype.hasOwnProperty.call(Math,a),o=w[a.replace(/^plot/,"")],l="."===e[r.index-1];if(n||o||l){s.lastIndex=r.index+r[0].length,"string"===typeof o&&(e=this.parseSerie(e,r,i));continue}const h=v[a];if(!h){if(/for|if|rgba/i.test(a)){s.lastIndex=r.index+r[0].length;continue}throw new Error(`Function ${a} doesn't exists`)}const d={name:a,args:[]};let p=0;const u=r.index,m=Object(c["g"])(e,u+r[1].length),f=Object(c["t"])(e.slice(u+r[1].length+1,m));let g=(h.args?h.args.length:0)+f.length;for(let e=0;e<g;e++){const t=h.args&&h.args[e]?h.args[e]:{},i={...t};if(t.injected){p++,d.args.push(i);continue}g--;const s=f[e-p];"undefined"!==typeof s&&(i.instruction=s),d.args.push(i)}e=`${e.slice(0,u)}utils.${a}.update(${C}[${t.length}].state,${d.args.map(e=>e.instruction).join(",")})${e.slice(m+1,e.length)}`,t.push(d)}}while(r&&++a<1e3);return e}parseMarkets(e,t){const i=/\b([A-Z_]{3,}:[a-zA-Z0-9/_-]{5,})(:[\w]{4,})?\.?([a-z]{3,})?\b/g;let s=null,r=0;do{if(s=i.exec(e)){const r=s[1]+(s[2]?s[2]:""),a=s[3];t[r]||(t[r]=[]),a&&-1===t[r].indexOf(a)&&t[r].push(a);const n=`renderer.sources['${r}']${a?"."+a:""}`;i.lastIndex=s.index+n.length,e=e.slice(0,s.index)+n+e.slice(s.index+s[0].length)}}while(s&&++r<1e3);return e}parseReferences(e,t,i){const s=new RegExp("\\$(\\w+[a-z_\\-0-9]+)\\b");let r=null,a=0;do{if(r=s.exec(e)){const s=r[1];try{const[r,a]=this.getSeriePath(s,i);t.find(e=>e.indicatorId===r&&e.plotIndex===a)||t.push({indicatorId:r,serieId:s,plotIndex:a}),e=e.replace(new RegExp("\\$("+s+")\\b","ig"),`renderer.indicators['${r}'].series[${a}]`)}catch(n){throw{message:`The serie "${s}" was not found in the current indicators`,status:"indicator-required",serieId:s}}}}while(r&&++a<1e3);return e}getSeriePath(e,t){let i,s;const r=t.find(t=>t.id===e||t.id.replace(/\W/g,"")===e.replace(/\W/g,""));if(r&&(i=this.indicatorId,s=t.indexOf(r)),!i&&this.serieIndicatorsMap[e]&&({indicatorId:i,plotIndex:s}=this.serieIndicatorsMap[e]),i||-1===Object.values(this.serieIndicatorsMap).map(e=>e.indicatorId).indexOf(e)||(i=e,s=0),i)return[i,s]}determineVariablesType(e,t){for(const i of t){const s=t.indexOf(i),r=new RegExp(`${_}\\[${s}\\](?:\\[(\\d+)\\])?`,"g");let a=null,n=0;do{if(a=r.exec(e)){const t=a[1],n=a.index+a[0].length;if("undefined"===typeof t){const t="["===e[n];e=e.substring(0,n)+".state"+(t?"":"[0]")+e.substring(n)}else{const i=e.substring(0,a.index),n=`${_}[${s}].state[Math.min(${_}[${s}].state.length-1,${t})]`,o=e.substring(a.index+a[0].length);e=`${i}${n}${o}`,r.lastIndex=i.length+n.length}i.length=Math.max(i.length,(+t||0)+1)}}while(a&&++n<1e3);if(!i.length)throw new Error("Unexpected no length on var");1===i.length&&(e=e.replace(new RegExp(`${_}\\[${s}\\]\\.state\\[\\d+\\]`,"g"),`${_}[${s}].state`)),e=e.replace(new RegExp(`#${_}\\[${s}\\]\\.state\\[\\d+\\]`,"g"),`${_}[${s}].state`)}return e}getAdapter(e){return function(){return new Function("renderer",C,_,"series","options","utils",'"use strict"; '+e)}()}getRendererIndicatorData(e){const{functions:t,variables:i,plots:s}=JSON.parse(JSON.stringify(e.model));e.options.minLength=0;for(const n of t){n.length=0;for(let t=0;t<n.args.length;t++)if("undefined"!==typeof n.args[t].instruction&&""!==n.args[t].instruction)try{n.args[t].instruction=new Function("options","'use strict'; return "+n.args[t].instruction)(e.options),n.args[t].length&&!isNaN(n.args[t].instruction)&&(n.length+=n.args[t].instruction)}catch(a){}e.options.minLength=Math.max(e.options.minLength,n.length)}const r=[];for(const n of s)r.push(this.getCustomPlotOptions(e,n));return{canRender:e.options.minLength<=1,series:[],functions:t,variables:i,plotsOptions:r,minLength:e.options.minLength}}getCustomPlotOptions(e,t){const i={};for(const r in t.options)try{i[r]=new Function("options","'use strict'; return "+t.options[r])(e.options)}catch(s){i[r]=t.options[r]}return i}}var O=i("0c01"),x=i("d951"),R=i("a914"),S=i("be31"),T=i("8766"),$=i("06c2"),E=i("4902");class M{constructor(e){this.loadedIndicators=[],this.renderedRange={from:null,to:null},this.markets={},this.alerts={},this.timezoneOffset=0,this.fillGapsWithEmpty=!0,this.propagateInitialPrices=!0,this.priceScales=[],this.queuedTrades=[],this.seriesIndicatorsMap={},this._queueHandler=this.releaseQueue.bind(this),this._refreshDecimalsHandler=this.refreshAutoDecimals.bind(this),this.paneId=e,this.chartCache=new I,this.serieBuilder=new k,this.setTimeframe(h["b"].state[this.paneId].timeframe),this.setTimezoneOffset(h["b"].state.settings.timezoneOffset),this.refreshMarkets(),R["a"].on("decimals",this._refreshDecimalsHandler),this.fillGapsWithEmpty=Boolean(h["b"].state[this.paneId].fillGapsWithEmpty)}async refreshMarkets(){if(h["b"].state.app.isExchangesReady)this._promiseOfMarkets&&(this._promiseOfMarkets=null);else{if(this._promiseOfMarkets)return this._promiseOfMarkets;this._promiseOfMarkets=Object(x["e"])(e=>e.app.isExchangesReady).then(this.refreshMarkets.bind(this))}const e=h["b"].state.panes.panes[this.paneId].markets,t=h["b"].state.app.historicalMarkets,i=h["b"].state.settings.normalizeWatermarks,s=[],r={};for(const a of e){const[e]=a.split(":"),n=h["b"].state.panes.marketsListeners[a];let o=a;n&&(o=Object($["o"])(n.local)),r[a]={active:h["b"].state.exchanges[e]&&!h["b"].state.exchanges[e].disabled&&!h["b"].state[this.paneId].hiddenMarkets[a],index:o,historical:-1!==t.indexOf(a)},r[a].active&&-1===s.indexOf(o)&&s.push((!i&&n?n.exchange+":":"")+o)}this.markets=r,h["b"].state.app.isExchangesReady&&await this.retrieveAlerts(),this.updateWatermark(s),this.resetPriceScales()}setTimeframe(e){/t$/.test(e)?this.type="tick":this.type="time",this.timeframe=parseFloat(e),this.isOddTimeframe=Object(c["r"])(this.timeframe),this.updateWatermark()}setTimezoneOffset(e){const t=this.timezoneOffset;this.timezoneOffset=e/1e3;const i=this.timezoneOffset-t;this.activeRenderer&&(this.activeRenderer.localTimestamp+=i)}createChart(e){const t=Object(l["f"])(l["a"]);h["b"].state[this.paneId].showVerticalGridlines&&(t.grid.vertLines.visible=h["b"].state[this.paneId].showVerticalGridlines,t.grid.vertLines.color=h["b"].state[this.paneId].verticalGridlinesColor),h["b"].state[this.paneId].showHorizontalGridlines&&(t.grid.horzLines.visible=h["b"].state[this.paneId].showHorizontalGridlines,t.grid.horzLines.color=h["b"].state[this.paneId].horizontalGridlinesColor),h["b"].state[this.paneId].showWatermark&&(t.watermark.visible=h["b"].state[this.paneId].showWatermark,t.watermark.color=h["b"].state[this.paneId].watermarkColor);const i=h["b"].state[this.paneId].barSpacing;i&&(t.timeScale.barSpacing=h["b"].state[this.paneId].barSpacing,t.timeScale.rightOffset=Math.ceil(.05*e.clientWidth/t.timeScale.barSpacing)),this.chartInstance=b["b"](e,t),this.chartElement=e,this.addEnabledSeries(),this.updateWatermark(),this.updateFontSize()}removeChart(){if(this.chartInstance){while(this.loadedIndicators.length)this.removeIndicator(this.loadedIndicators[0]);this.chartInstance.remove(),this.priceScales.splice(0,this.priceScales.length),this.chartInstance=null}}getLoadedIndicator(e){for(let t=0;t<this.loadedIndicators.length;t++)if(this.loadedIndicators[t].id===e)return this.loadedIndicators[t]}setIndicatorOption(e,t,i,s=!1){const r=this.getLoadedIndicator(e);if(r&&(r.options[t]=i,!s))if("visible"!==t){"priceFormat"===t&&i.auto&&this.refreshAutoDecimals(e);for(let e=0;e<r.apis.length;e++)"priceFormat"!==t||i.auto||(r.apis[e].precision=i.precision),r.apis[e].applyOptions({[t]:i});this.optionRequiresRedraw(t)&&this.redrawIndicator(e)}else this.toggleIndicatorVisibility(r,i)}toggleIndicatorVisibility(e,t){t?(e.model?this.createIndicatorSeries(e):this.prepareIndicator(e),this.redrawIndicator(e.id)):this.removeIndicatorSeries(e)}optionRequiresRedraw(e){const t=/upColor|downColor|wickDownColor|wickUpColor|borderDownColor|borderUpColor|compositeOperation/i;if(t.test(e))return!0;const i=/color|priceFormat|linetype|width|style/i;return!i.test(e)}rebuildIndicator(e){this.removeIndicator(this.getLoadedIndicator(e)),this.addIndicator(e)&&this.redrawIndicator(e)}getReferencedIndicators(e){return e.model.references.slice().map(e=>e.indicatorId).filter((e,t,i)=>i.indexOf(e)===t)}redrawIndicator(e){const t=this.getLoadedIndicator(e);this.clearIndicatorSeries(t);let i=[];for(const r of this.chartCache.chunks)i=i.concat(r.bars);const s=this.getReferencedIndicators(t);this.ensureIndicatorVisible(s),this.renderBars(i,[...s,e])}ensureIndicatorVisible(e){for(const t of e)this.loadedIndicators[t]&&!1===this.loadedIndicators[t].options.visible&&this.setIndicatorOption(t,"visible",!0,!0)}getVisibleRange(){const e=this.chartInstance.timeScale().getVisibleRange();return e?(e.from-=this.timezoneOffset,e.to-=this.timezoneOffset,e):e}addEnabledSeries(){for(const e in h["b"].state[this.paneId].indicators)this.addIndicator(e)}updateWatermark(e){if(e)if(h["b"].state.settings.normalizeWatermarks)this.watermark=e.join(" | ");else{const t=e.length-3;this.watermark=e.slice(0,3).join(" + ")+(t>0?" + "+t+" other"+(t>1?"s":""):"")}this.chartInstance&&this.chartInstance.applyOptions({watermark:{text:`    ${this.watermark+" | "+Object(c["p"])(h["b"].state[this.paneId].timeframe)}    `,visible:h["b"].state[this.paneId].showWatermark,color:h["b"].state[this.paneId].watermarkColor}})}updateFontSize(){const e=h["b"].state.panes.panes[this.paneId].zoom||1,t=h["b"].state.settings.normalizeWatermarks?72:48;this.chartInstance.applyOptions({layout:{fontSize:14*e},watermark:{fontSize:t*e}})}addIndicator(e,t){if(this.getLoadedIndicator(e))return!0;if(t>5)return!1;const i=h["b"].state[this.paneId].indicators[e],s=i.options||{},r={id:e,options:JSON.parse(JSON.stringify(s)),script:i.script,model:null,adapter:null,silentAdapter:null,apis:[]};try{this.prepareIndicator(r)}catch(a){return"indicator-required"!==a.status||this.resolveDependency(r.id,a.serieId,t||0)||O["a"].confirm({message:`"${r.id}" indicator need the "${a.serieId}" serie but that one WAS NOT found anywhere in the current indicators.`,ok:"I see",cancel:!1}),a.status||O["a"].isDialogOpened("indicator")||O["a"].openIndicator(this.paneId,r.id),!1}return this.loadedIndicators.push(r),!0}resolveDependency(e,t,i){const s=h["b"].state[this.paneId].indicators;for(const r in s)if(r!==e&&s[r].series&&-1!==s[r].series.indexOf(t))return!!this.addIndicator(r,i+1)&&(0===i&&this.addIndicator(e,i+1),!0);return!(!s[t]||!this.addIndicator(s[t].id,i+1))&&(0===i&&this.addIndicator(e,i+1),!0)}prepareIndicator(e){try{const t=this.serieBuilder.build(e,this.seriesIndicatorsMap,this.paneId);h["b"].state[this.paneId].indicatorsErrors[e.id]&&h["b"].commit(this.paneId+"/SET_INDICATOR_ERROR",{id:e.id,error:null}),e.model=t,!1!==e.options.visible&&this.createIndicatorSeries(e)}catch(t){if(!1!==e.options.visible)throw h["b"].commit(this.paneId+"/SET_INDICATOR_ERROR",{id:e.id,error:t.message}),t}}bindIndicator(e,t){if(t&&"undefined"===typeof t.indicators[e.id]&&e.model){if(t.indicators[e.id]=this.serieBuilder.getRendererIndicatorData(e),!this.activeRenderer||t===this.activeRenderer){for(let i=0;i<t.indicators[e.id].plotsOptions.length;i++)e.apis[i].applyOptions(t.indicators[e.id].plotsOptions[i]);e.adapter=this.serieBuilder.getAdapter(e.model.output),e.silentAdapter=this.serieBuilder.getAdapter(e.model.silentOutput)}return this.prepareRendererForIndicators(e,t),e}}unbindIndicator(e,t){t&&"undefined"!==typeof t.indicators[e.id]&&delete t.indicators[e.id]}ensurePriceScale(e,t){if(-1!==this.priceScales.indexOf(e))return;this.priceScales.push(e);let i=h["b"].state[this.paneId].priceScales[e];i||(i={},t&&t.options.scaleMargins?i.scaleMargins=t.options.scaleMargins:i.scaleMargins={top:.1,bottom:.2},h["b"].commit(this.paneId+"/SET_PRICE_SCALE",{id:e,priceScale:i})),this.refreshPriceScale(e)}resetPriceScales(){for(let e=0;e<this.priceScales.length;e++)this.chartInstance.priceScale(this.priceScales[e]).applyOptions({autoScale:!0})}removeIndicator(e){"string"===typeof e&&(e=this.getLoadedIndicator(e)),e&&(this.removeIndicatorSeries(e),this.loadedIndicators.splice(this.loadedIndicators.indexOf(e),1))}clearChart(e){e||this.preventPan();for(const t of this.loadedIndicators)this.clearIndicatorSeries(t);this.renderedRange.from=this.renderedRange.to=null}clearData(){this.activeRenderer=null,this.activeChunk=null,this.queuedTrades.splice(0,this.queuedTrades.length)}clearPriceLines(e){for(let t=0;t<this.loadedIndicators.length;t++)if(!e||-1!==e.indexOf(this.loadedIndicators[t].id)){this._priceIndicatorId===this.loadedIndicators[t].id&&(this._alertsRendered=!1);for(let e=0;e<this.loadedIndicators[t].apis.length;e++)this.loadedIndicators[t].apis[e].removeAllPriceLines()}}clear(){this.chartCache.clear(),this.clearData(),this.clearChart(),this.setTimeframe(h["b"].state[this.paneId].timeframe),this.propagateInitialPrices=!0}resample(e){const t=Object(c["h"])(this.activeRenderer.timestamp,e),i=this.getActiveChunk();if(i)for(const a in this.activeRenderer.sources)!1===this.activeRenderer.sources[a].empty&&i.bars.push(this.cloneSourceBar(this.activeRenderer.sources[a],t));if(this.setTimeframe(e),!this.chartCache.chunks.length)return;const s=(e,t,i)=>("number"===typeof e.close?t.open=t.high=t.low=t.close=e.close:"undefined"!==typeof t.close&&null!==t.close||(t.open=t.high=t.low=t.close=null,t.vbuy=0,t.vsell=0,t.cbuy=0,t.csell=0,t.lbuy=0,t.lsell=0),t.timestamp=i,t),r={};for(let a=0;a<this.chartCache.chunks.length;a++){for(let e=0;e<this.chartCache.chunks[a].bars.length;e++){const t=this.chartCache.chunks[a].bars[e],i=t.exchange+":"+t.pair,n=Object(c["h"])(t.timestamp,this.timeframe,this.isOddTimeframe);!r[i]||r[i].timestamp<n?r[i]?r[i]=s(r[i],t,n):r[i]=s({},t,n):(null===typeof r[i].open&&(r[i].open=t.open,r[i].high=t.high,r[i].low=t.low,r[i].close=t.close),r[i].vbuy+=t.vbuy,r[i].vsell+=t.vsell,r[i].cbuy+=t.cbuy,r[i].csell+=t.csell,r[i].lbuy+=t.lbuy,r[i].lsell+=t.lsell,r[i].close=t.close,r[i].high=Math.max(r[i].high,t.high,t.open,t.close),r[i].low=Math.min(r[i].low,t.low,t.open,t.close),this.chartCache.chunks[a].bars.splice(e--,1))}if(a&&this.chartCache.chunks[a].bars.length<o["c"]){if(this.chartCache.chunks[a].bars.length){const e=o["c"]-this.chartCache.chunks[a-1].bars.length;e&&(this.chartCache.chunks[a-1].bars=this.chartCache.chunks[a-1].bars.concat(this.chartCache.chunks[a].bars.splice(0,e)))}this.chartCache.chunks[a].bars.length||(this.chartCache.chunks.splice(a,1),a--)}}this.activeRenderer=null,this.renderAll()}getActiveChunk(){return this.activeChunk||this.chartCache.cacheRange.to!==this.activeRenderer.timestamp?(this.activeChunk&&(this.activeChunk.active=!1),this.activeChunk=this.chartCache.saveChunk({from:this.activeRenderer.timestamp,to:this.activeRenderer.timestamp,active:!0,rendered:!0,bars:[]})):(this.activeChunk=this.chartCache.chunks[this.chartCache.chunks.length-1],this.activeChunk.active=!0),this.activeChunk}destroy(){this.chartCache.clear(),this.clearData(),this.clearChart(),this.removeChart(),this.clearQueue(),R["a"].off("decimals",this._refreshDecimalsHandler)}clearIndicatorSeries(e){for(let t=0;t<e.apis.length;t++)e.apis[t].removeAllPriceLines(),e.apis[t].setData([])}setupQueue(){this._releaseQueueInterval||(h["b"].state[this.paneId].refreshRate?this._releaseQueueInterval=setInterval(this._queueHandler,h["b"].state[this.paneId].refreshRate):this._releaseQueueInterval=requestAnimationFrame(this._queueHandler))}clearQueue(){this._releaseQueueInterval&&(clearInterval(this._releaseQueueInterval),cancelAnimationFrame(this._releaseQueueInterval),delete this._releaseQueueInterval,this.releaseQueue())}releaseQueue(){this.queuedTrades.length&&(this.renderRealtimeTrades(this.queuedTrades),this.queuedTrades.splice(0,this.queuedTrades.length))}queueTrades(e){Array.prototype.push.apply(this.queuedTrades,e),h["b"].state[this.paneId].refreshRate||(this._releaseQueueInterval=requestAnimationFrame(this._queueHandler))}renderRealtimeTrades(e){if(!e.length)return;let t=!1;for(let i=0;i<e.length;i++){const s=e[i],r=s.exchange+":"+s.pair;if("undefined"===typeof this.markets[r])continue;let a;if(a=this.activeRenderer?"time"===this.activeRenderer.type?Object(c["h"])(s.timestamp/1e3,this.timeframe,this.isOddTimeframe):this.activeRenderer.bar.cbuy+this.activeRenderer.bar.csell>=this.timeframe?Math.max(this.activeRenderer.timestamp+.001,Math.round(s.timestamp/1e3)):this.activeRenderer.timestamp:s.timestamp/1e3,!this.activeRenderer||this.activeRenderer.timestamp<a)if(this.activeRenderer){(!this.activeChunk||this.activeChunk.to<this.activeRenderer.timestamp&&this.activeChunk.bars.length>=o["c"])&&this.getActiveChunk(),this.activeRenderer.bar.empty||this.updateBar(this.activeRenderer);for(const e in this.activeRenderer.sources)!1===this.activeRenderer.sources[e].empty&&this.activeChunk.bars.push(this.cloneSourceBar(this.activeRenderer.sources[e],this.activeRenderer.timestamp));this.activeChunk.to=this.chartCache.cacheRange.to=this.activeRenderer.timestamp,this.renderedRange.to<this.activeRenderer.timestamp&&(this.renderedRange.to=this.activeRenderer.timestamp),this.nextBar(a,this.activeRenderer)}else this.activeRenderer=this.createRenderer(a);const n=s.price*s.size;this.activeRenderer.sources[r]&&"undefined"!==typeof this.activeRenderer.sources[r].pair||(this.propagateInitialPrices&&(this.chartCache.initialPrices[r]={exchange:s.exchange,pair:s.pair,price:s.price},t||(t=!0)),this.activeRenderer.sources[r]={pair:s.pair,exchange:s.exchange,close:+s.price,active:this.markets[r].active},this.resetBar(this.activeRenderer.sources[r]));const l=this.markets[r].active;s.liquidation?(this.activeRenderer.sources[r]["l"+s.side]+=n,this.activeRenderer.bar.empty=!1,l&&(this.activeRenderer.bar["l"+s.side]+=n)):(this.activeRenderer.sources[r].close=+s.price,this.activeRenderer.sources[r].empty?this.activeRenderer.sources[r].open=this.activeRenderer.sources[r].high=this.activeRenderer.sources[r].low=this.activeRenderer.sources[r].close:(this.activeRenderer.sources[r].high=Math.max(this.activeRenderer.sources[r].high,this.activeRenderer.sources[r].close),this.activeRenderer.sources[r].low=Math.min(this.activeRenderer.sources[r].low,this.activeRenderer.sources[r].close)),this.activeRenderer.sources[r]["c"+s.side]+=s.count,this.activeRenderer.sources[r]["v"+s.side]+=n,this.activeRenderer.sources[r].empty=!1,l&&(this.activeRenderer.bar["v"+s.side]+=n,this.activeRenderer.bar["c"+s.side]+=s.count,this.activeRenderer.bar.empty=!1))}this.activeRenderer&&(t?this.renderAll():this.activeRenderer.bar.empty||(this.updateBar(this.activeRenderer),this.renderedRange.to<this.activeRenderer.timestamp&&(this.renderedRange.to=this.activeRenderer.timestamp)))}cloneSourceBar(e,t){return{pair:e.pair,exchange:e.exchange,timestamp:t||e.timestamp,open:e.open,high:e.high,low:e.low,close:e.close,vbuy:e.vbuy,vsell:e.vsell,cbuy:e.cbuy,csell:e.csell,lbuy:e.lbuy,lsell:e.lsell}}renderBars(e,t,i,s){e.length&&this.prependInitialPrices(e,i),this.clearPriceLines(t);const r={};let a,n,o=null,c=null;if(e.length){if(this.activeRenderer&&this.activeRenderer.timestamp>e[e.length-1].timestamp){const t=Object.values(this.activeRenderer.sources).filter(e=>!1===e.empty);for(let i=0;i<t.length;i++){const s=t[i];s.timestamp=this.activeRenderer.timestamp;for(let r=e.length-1;r>=0;r--){const a=e[r];if(a.timestamp<this.activeRenderer.timestamp){e.splice(r+1,0,s),t.splice(i,1),i--;break}if(a.exchange===s.exchange&&a.pair===s.pair){a.vbuy+=s.vbuy,a.vsell+=s.vsell,a.cbuy+=s.cbuy,a.csell+=s.csell,a.lbuy+=s.lbuy,a.lsell+=s.lsell,a.open=s.open,a.high=s.high,a.low=s.low,a.close=s.close,t.splice(i,1),i--;break}}}}}else if(this.activeRenderer&&this.activeRenderer.bar&&!this.activeRenderer.bar.empty&&(e=Object.values(this.activeRenderer.sources).filter(e=>!1===e.empty)),!e.length)return;let l,h=0;for(let d=0;d<=e.length;d++){const i=e[d];if(!i||!a||i.timestamp>a.timestamp){if(a){if(a.bar.empty&&!this.fillGapsWithEmpty&&i){this.nextBar(i.timestamp,a);continue}null===o&&(o=a.timestamp),c=a.timestamp,n=this.computeBar(a,t);for(const e in n)"undefined"===typeof r[e]&&(r[e]=[]),r[e].push(n[e])}if(!i)break;if(h++,a){if(this.fillGapsWithEmpty&&"time"===a.type){const e=(i.timestamp-a.timeframe-a.timestamp)/a.timeframe;if(e>0)for(let t=0;t<e;t++){this.incrementRendererBar(a);for(const e in n)"undefined"===typeof r[e]&&(r[e]=[]),r[e].push({time:a.localTimestamp})}}this.nextBar(i.timestamp,a)}else a=this.createRenderer(i.timestamp||this.activeRenderer.timestamp,t)}const s=i.exchange+":"+i.pair,l=this.markets[s].active;l&&!i.empty&&(a.bar.empty=!1,a.bar.vbuy+=i.vbuy,a.bar.vsell+=i.vsell,a.bar.cbuy+=i.cbuy,a.bar.csell+=i.csell,a.bar.lbuy+=i.lbuy,a.bar.lsell+=i.lsell),a.sources[s]=this.cloneSourceBar(i),a.sources[s].empty=!1,a.sources[s].active=l}if(this.activeRenderer){this.activeRenderer.bar=a.bar;for(const e in a.indicators)this.activeRenderer.indicators[e]=a.indicators[e];for(const e in a.sources)this.activeRenderer.sources[e]=a.sources[e]}else this.activeRenderer=a;t&&t.length||(this.activeRenderer.length=h,l=this.chartInstance.timeScale().scrollPosition(),e.length?(this.renderedRange.from=o,this.renderedRange.to=c):this.renderedRange.from=this.renderedRange.to=null),this.replaceData(r,s),l&&this.chartInstance.timeScale().scrollToPosition(l,!1),this.renderAlerts()}prependInitialPrices(e,t){const i=Object.keys(this.markets).filter(e=>this.markets[e].historical),s=100*i.length;if(this.propagateInitialPrices){const r=e[0].timestamp;if(t)for(let a=0;a<e.length;a++){const n=e[a].exchange+":"+e[a].pair;let o;if(t){if(e[a].timestamp<=r){-1!==(o=i.indexOf(n))&&i.splice(o,1);continue}if(-1!==(o=i.indexOf(n)))this.chartCache.initialPrices[n]={exchange:e[a].exchange,pair:e[a].pair,price:e[a].close},i.splice(o,1);else if(!i.length||a>s)break}}for(const t in this.chartCache.initialPrices){const i=this.chartCache.initialPrices[t].price,s=this.chartCache.initialPrices[t].exchange,a=this.chartCache.initialPrices[t].pair,n=this.resetBar({timestamp:r,exchange:s,pair:a,open:i,high:i,low:i,close:i});e.unshift(n)}}}removeIndicatorSeries(e){for(let i=0;i<e.apis.length;i++)this.chartInstance.removeSeries(e.apis[i]),e.apis.splice(i--,1);this.unbindIndicator(e,this.activeRenderer);const t="undefined"===typeof this.loadedIndicators.find(t=>t.id!==e.id&&!1!==t.options.visible&&t.options.priceScaleId===e.options.priceScaleId);t&&this.priceScales.splice(this.priceScales.indexOf(e.options.priceScaleId),1)}createIndicatorSeries(e){const t=[];for(let i=0;i<e.model.plots.length;i++){const s=e.model.plots[i],r=Object(c["c"])("add-"+s.type+"-series"),a=this.serieBuilder.getCustomPlotOptions(e,s),n={...l["c"],...l["b"][s.type]||{},...e.options,...a};n.scaleMargins&&delete n.scaleMargins;const o=this.chartInstance[r](n);o.id=s.id,n.priceFormat&&"number"===typeof n.priceFormat.precision&&(o.precision=n.priceFormat.precision),this.seriesIndicatorsMap[s.id]={indicatorId:e.id,plotIndex:i},t.push(s.id),e.apis.push(o)}h["b"].commit(this.paneId+"/SET_INDICATOR_SERIES",{id:e.id,series:t}),this.ensurePriceScale(e.options.priceScaleId,e),this.bindIndicator(e,this.activeRenderer)}refreshPriceScale(e){const t=h["b"].state[this.paneId].priceScales[e];this.chartInstance.priceScale(e).applyOptions({...t})}preventPan(){if(this.panPrevented)return;const e=100;"undefined"!==typeof this._releasePanTimeout&&clearTimeout(this._releasePanTimeout),this.panPrevented=!0,this._releasePanTimeout=window.setTimeout(()=>{this.panPrevented=!1},e)}renderAll(e,t){if(this.chartInstance){if(this._promiseOfMarkets)return this._promiseOfMarketsRender||(this._promiseOfMarketsRender=this._promiseOfMarkets.then(()=>{this._promiseOfMarketsRender=null,this.renderAll(!1,!0)})),this._promiseOfMarketsRender;this.clearChart(t),this.renderBars(this.chartCache.chunks.length?this.chartCache.chunks.reduce((e,t)=>e.concat(t.bars),[]):[],null,e,t)}}async retrieveAlerts(){const e=Object.values(this.markets).reduce((e,t)=>(-1===e.indexOf(t.index)&&e.push(t.index),e),[]);for(const t of Object.keys(this.alerts))-1===e.indexOf(t)&&delete this.alerts[t];for(const t of e)this.alerts[t]||(this.alerts[t]=[],await S["a"].getAlerts(t).then(e=>{for(let i=0;i<e.length;i++)this.alerts[t].push(e[i])}))}renderAlerts(){if(this._alertsRendered||!h["b"].state.settings.alerts)return;const e=this.getPriceApi();if(e){for(const t in this.alerts)for(let i=0;i<this.alerts[t].length;i++)this.renderAlert(this.alerts[t][i],e);this._alertsRendered=!0}}triggerAlert(e,t){if(!this.alerts[e])return;const i=this.alerts[e].find(e=>e.price===t);if(i){h["b"].state.settings.alertSound&&E["d"].playOnce(h["b"].state.settings.alertSound),i.triggered=!0;const e=this.getPriceApi(),s=e.getPriceLine(t);s&&e.removePriceLine(s),this.renderAlert(i,e)}}renderAlert(e,t,i){let s,r;if(e.timestamp){const t=Object(c["h"])(e.timestamp,this.timeframe);s=this.chartInstance.timeScale().coordinateToLogical(this.chartInstance.timeScale().timeToCoordinate(t))}return e.triggered&&(r="✔"),t.createPriceLine({market:e.market,index:s,price:e.price,color:i||h["b"].state.settings.alertsColor,lineWidth:h["b"].state.settings.alertsLineWidth,lineStyle:h["b"].state.settings.alertsLineStyle,title:r})}replaceData(e,t){t||this.preventPan();for(let s=this.loadedIndicators.length-1;s>=0;s--)if(!1!==this.loadedIndicators[s].options.visible)for(let t=0;t<this.loadedIndicators[s].apis.length;t++){const r=this.loadedIndicators[s].apis[t].id;if(e[r])try{this.loadedIndicators[s].apis[t].setData(e[r])}catch(i){h["b"].commit(this.paneId+"/SET_INDICATOR_ERROR",{id:this.loadedIndicators[s].id,error:i.message}),this.setIndicatorOption(this.loadedIndicators[s].id,"visible",!1)}}}updateBar(e){this.preventPan();for(let t=0;t<this.loadedIndicators.length;t++){if(!1===this.loadedIndicators[t].options.visible)continue;const i=this.loadedIndicators[t],s=e.indicators[i.id];s.canRender?this.loadedIndicators[t].adapter(e,s.functions,s.variables,i.apis,i.options,v):this.loadedIndicators[t].silentAdapter(e,s.functions,s.variables,i.apis,i.options,v)}}computeBar(e,t){const i={};for(let r=0;r<this.loadedIndicators.length;r++){if(t&&-1===t.indexOf(this.loadedIndicators[r].id)||!1===this.loadedIndicators[r].options.visible)continue;const a=this.loadedIndicators[r],n=e.indicators[a.id];n.series=[];try{a.silentAdapter(e,n.functions,n.variables,a.apis,a.options,v)}catch(s){h["b"].commit(this.paneId+"/SET_INDICATOR_ERROR",{id:a.id,error:s.message});continue}for(let t=0;t<n.series.length;t++){if(!a.model.plots[t])break;e.length<n.minLength||!n.series[t]||"undefined"!==typeof n.series[t].value&&null===n.series[t].value||"undefined"!==typeof n.series[t].lowerValue&&null===n.series[t].lowerValue||"histogram"===a.model.plots[t].type&&0===n.series[t].value||(i[a.apis[t].id]=n.series[t])}}return i}getPriceApi(){for(let e=0;e<this.loadedIndicators.length;e++)for(let t=0;t<this.loadedIndicators[e].apis.length;t++){const i=this.loadedIndicators[e].apis[t];if("right"===i.options().priceScaleId)return this._priceIndicatorId=this.loadedIndicators[e].id,i}}createRenderer(e,t){e=Object(c["h"])(e,this.timeframe);const i={timestamp:e,localTimestamp:e+this.timezoneOffset,timeframe:this.timeframe,type:this.type,length:1,indicators:{},sources:{},bar:{vbuy:0,vsell:0,cbuy:0,csell:0,lbuy:0,lsell:0,empty:!0}};this.loadedIndicators=this.loadedIndicators.sort((e,t)=>{const i=e.model?e.model.references.length:0,s=t.model?t.model.references.length:0;return i-s});for(const s of this.loadedIndicators)t&&-1===t.indexOf(s.id)||!1===s.options.visible||this.bindIndicator(s,i);return i}nextBar(e,t){if(this.fillGapsWithEmpty&&t===this.activeRenderer&&"time"===this.activeRenderer.type&&this.activeRenderer.timestamp<e-this.activeRenderer.timeframe){const i=(e-this.activeRenderer.timeframe-this.activeRenderer.timestamp)/this.activeRenderer.timeframe;for(let e=0;e<this.loadedIndicators.length;e++)for(let s=0;s<this.loadedIndicators[e].apis.length;s++)for(let r=0;r<i;r++)0===e&&0===s&&this.incrementRendererBar(t),this.loadedIndicators[e].apis[s].update({time:t.localTimestamp})}this.incrementRendererBar(t),this.resetRendererBar(t),t.timestamp=e,t.localTimestamp=e+this.timezoneOffset}incrementRendererBar(e){e.length++,e.timestamp+=e.timeframe,e.localTimestamp+=e.timeframe;for(let t=0;t<this.loadedIndicators.length;t++){const i=e.indicators[this.loadedIndicators[t].id];if(i){i.canRender=e.length>=i.minLength;for(let e=0;e<i.functions.length;e++){const t=i.functions[e];"function"===typeof v[t.name].next&&v[t.name].next(t)}for(let e=0;e<i.variables.length;e++){const t=i.variables[e];t.length>1&&(t.state.unshift(t.state[0]),t.state.length>t.length&&t.state.pop())}}}}resetRendererBar(e){if(e.bar={vbuy:0,vsell:0,cbuy:0,csell:0,lbuy:0,lsell:0,empty:!0},"undefined"!==typeof e.sources)for(const t in e.sources)this.resetBar(e.sources[t])}resetBar(e){return null!==e.close&&(e.open=e.close,e.high=e.close,e.low=e.close),e.vbuy=0,e.vsell=0,e.cbuy=0,e.csell=0,e.lbuy=0,e.lsell=0,e.empty=!0,e}prepareRendererForIndicators(e,t){const i=Object.keys(e.model.markets);for(let s=0;s<i.length;s++){t.sources[i[s]]||(t.sources[i[s]]={open:null,high:null,low:null,close:null});const r=e.model.markets[i[s]];if(r.length)for(let e=0;e<r.length;e++)"undefined"===typeof t.sources[i[s]][r[e]]&&"open"!==r[e]&&"high"!==r[e]&&"low"!==r[e]&&"close"!==r[e]&&(t.sources[i[s]][r[e]]=0)}}toggleFillGapsWithEmpty(){this.fillGapsWithEmpty=!this.fillGapsWithEmpty,this.renderAll()}refreshAutoDecimals(e){const t=Object.keys(this.markets),i=Object.keys($["l"]).find(e=>-1!==t.indexOf(e));if(i){const t=$["l"][i];for(let i=0;i<this.loadedIndicators.length;i++){if(e&&e!==this.loadedIndicators[i].id)continue;let s=this.loadedIndicators[i].options.priceFormat||{type:"price"};if(s.auto&&"volume"!==s.type&&s.precision!==t){s={...s,precision:t,minMove:1/Math.pow(10,t)},h["b"].dispatch(this.paneId+"/setIndicatorOption",{id:this.loadedIndicators[i].id,key:"priceFormat",value:s,silent:!0});for(let e=0;e<this.loadedIndicators[i].apis.length;e++)this.loadedIndicators[i].apis[e].applyOptions({priceFormat:s}),this.loadedIndicators[i].apis[e].precision=t}}}}getPricelineAtPoint(e){const t=Object(T["a"])(e),i={x:t.x,y:t.y},s=this.getPriceApi();if(!s)return;let r=s.coordinateToPrice(t.y);if(!r)return;let a,n=s.getPriceLine(r,this.chartInstance.timeScale().coordinateToLogical(t.x));if(n){const e=n.options();a=e.market,e.market?(a=e.market,r=e.price):n=null}if(!a){for(const e in this.markets)if(this.markets[e].active&&this.markets[e].historical){a=this.markets[e].index;break}a||(a=Object.values(this.markets)[0].index)}n||(r=+Object($["e"])(r,s.options().priceFormat.precision));const o=h["b"].state.settings.alerts&&(e.shiftKey||h["b"].state.settings.alertsClick);return{api:s,price:r,market:a,priceline:n,canCreate:o,originalOffset:t,offset:i}}disableCrosshair(){this.chartInstance.applyOptions({crosshair:{vertLine:{color:"transparent",labelVisible:!1},horzLine:{color:"transparent",labelVisible:!1}}})}enableCrosshair(){const e=Object(l["e"])();this.chartInstance.applyOptions({crosshair:{vertLine:{color:e.crosshair.vertLine.color,labelVisible:!0},horzLine:{color:e.crosshair.horzLine.color,labelVisible:!0}}})}}var P=i("fa07"),L=i("ba10"),A=i.n(L);class D extends A.a{constructor(){super(),this.promisesOfData={},this.url=Object(c["j"])("historical")}filterOutUnavailableMarkets(e){return e.filter(e=>-1!==h["b"].state.app.historicalMarkets.indexOf(e))}getApiUrl(e,t,i,s){const r=[e,t,(1e3*i).toString()];return s&&s.length&&r.push(encodeURIComponent(s.join("+"))),`${this.url}/${r.join("/")}`}fetch(e,t,i,s){const r=this.getApiUrl(e,t,i,s);return this.promisesOfData[r]||(h["b"].commit("app/TOGGLE_LOADING",!0),this.promisesOfData[r]=fetch(r).then(e=>e.json().then(t=>(t.status=e.status,t))).then(e=>{if(!e||e.error)throw new Error(e&&e.error?e.error:"empty-response");if(!e.results.length)throw new Error("No more data");if("point"!==e.format)throw new Error("Bad data");return this.normalizePoints(e.results,e.columns,i,s)}).catch(e=>{throw Object(c["q"])(e),e}).then(e=>(h["b"].commit("app/TOGGLE_LOADING",!1),delete this.promisesOfData[r],e))),this.promisesOfData[r]}normalizePoints(e,t,i,s){const r={};if(s=s.slice(),!e||!e.length)return e;let a;a=Array.isArray(e[0])?e[0][0]:+new Date(e[0].time)/1e3,s=[...s];const n={},o=Object(c["r"])(i);for(let l=0;l<e.length;l++){if(!e[l].time&&e[l][0])e[l]={time:"undefined"!==typeof t["time"]?e[l][t["time"]]:0,cbuy:"undefined"!==typeof t["cbuy"]?e[l][t["cbuy"]]:0,close:"undefined"!==typeof t["close"]?e[l][t["close"]]:0,csell:"undefined"!==typeof t["csell"]?e[l][t["csell"]]:0,high:"undefined"!==typeof t["high"]?e[l][t["high"]]:0,lbuy:"undefined"!==typeof t["lbuy"]?e[l][t["lbuy"]]:0,low:"undefined"!==typeof t["low"]?e[l][t["low"]]:0,lsell:"undefined"!==typeof t["lsell"]?e[l][t["lsell"]]:0,market:"undefined"!==typeof t["market"]?e[l][t["market"]]:0,open:"undefined"!==typeof t["open"]?e[l][t["open"]]:0,vbuy:"undefined"!==typeof t["vbuy"]?e[l][t["vbuy"]]:0,vsell:"undefined"!==typeof t["vsell"]?e[l][t["vsell"]]:0},e[l].timestamp=e[l].time;else{if(!r[e[l].market])for(let t=l-1;t>=0;t--)if(e[t].market===e[l].market){r[e[l].market]=e[t];break}if(e[l].timestamp=Object(c["h"])(e[l].time/1e3,i,o),!r[e[l].market]||r[e[l].market].timestamp<e[l].timestamp)r[e[l].market]=e[l];else if(r[e[l].market]!==e[l]){r[e[l].market].vbuy+=e[l].vbuy,r[e[l].market].vsell+=e[l].vsell,r[e[l].market].cbuy+=e[l].cbuy,r[e[l].market].csell+=e[l].csell,r[e[l].market].lbuy+=e[l].lbuy,r[e[l].market].lsell+=e[l].lsell,r[e[l].market].high=Math.max(e[l].high,r[e[l].market].high),r[e[l].market].low=Math.min(e[l].low,r[e[l].market].low),r[e[l].market].close=e[l].close,e.splice(l,1),l--;continue}}if("number"!==typeof n[e[l].market]&&(n[e[l].market]=e[l].open),e[l].timestamp===a){const t=s.indexOf(e[l].market);s.splice(t,1)}const[h,d]=Object($["m"])(e[l].market);e[l].exchange=h,e[l].pair=d,delete e[l].time}return{data:e,markets:s,from:e[0].timestamp,to:e[e.length-1].timestamp}}}var j=new D,z=i("f634"),G=i("024c"),N=i("8c91"),F=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"chart-layout",style:{right:e.axis[0]+"px",bottom:e.axis[1]+"px"},on:{dblclick:function(t){return e.$store.commit(e.paneId+"/TOGGLE_LAYOUTING")}}},[t("div",{staticClass:"chart-layout__controls"},[t("button",{staticClass:"btn -red -small",attrs:{title:"Close menu while reverting chart layout to it's original state"},on:{click:e.cancel}},[e._v(" Cancel "),t("i",{staticClass:"icon-eraser ml4"})]),t("button",{staticClass:"btn -green -small ml8",attrs:{title:"Click if you finished rearranging the chart layout"},on:{click:function(t){return e.$store.commit(e.paneId+"/TOGGLE_LAYOUTING")}}},[e._v(" Ok "),t("i",{staticClass:"icon-check ml4"})])]),e._l(e.activePriceScales,(function(i,s){return t("chart-price-scale",{key:s,staticClass:"chart-layout__item",attrs:{paneId:e.paneId,priceScaleId:s,priceScale:i},on:{update:function(t){return e.updatePriceScaleScaleMargins(s,t)}}})}))],2)},B=[],q=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"chart-pricescale",class:{"-active":!!e.currentSide},style:{top:e.roundedTop+"%",bottom:e.roundedBottom+"%"}},[t("div",{staticClass:"chart-pricescale__content"},[t("div",{staticClass:"chart-pricescale__title pane-overlay",on:{mousedown:e.handleMove,touchstart:e.handleMove}},[t("i",{staticClass:"icon-move mr8"}),e._v(" "+e._s(e.priceScale.indicators.join(", "))+" "),"right"===e.priceScaleId?t("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"ml4",attrs:{title:"Main scale"}},[e._v("👑")]):e._e(),t("dropdown-button",{staticClass:"chart-pricescale__mode -text -small ml8 text-bold -arrow",attrs:{options:e.modes,placeholder:"linear"},on:{input:function(t){return e.updateMode(t)}},model:{value:e.priceScale.mode,callback:function(t){e.$set(e.priceScale,"mode",t)},expression:"priceScale.mode"}})],1),t("div",{staticClass:"chart-pricescale__size pane-overlay",domProps:{textContent:e._s(100-e.roundedTop-e.roundedBottom+"%")}})]),t("div",{staticClass:"chart-pricescale__boundary -top",class:{"-active":"top"===e.currentSide},on:{mousedown:function(t){return e.handleResize(t,"top")},touchstart:function(t){return e.handleResize(t,"top")}}}),t("div",{staticClass:"chart-pricescale__boundary -bottom",class:{"-active":"bottom"===e.currentSide},on:{mousedown:function(t){return e.handleResize(t,"bottom")},touchstart:function(t){return e.handleResize(t,"bottom")}}})])},H=[],V=i("3918");let W=class extends n["c"]{constructor(){super(...arguments),this.top=null,this.bottom=null,this.roundedTop=null,this.roundedBottom=null,this.currentMoveId=null,this.currentSide=null,this.currentOrigin=null,this.currentContainerHeight=null,this.modes={0:"Linear",1:"Logarithimic",2:"Percent",3:"Indexed to 100"}}created(){this.getSize()}beforeDestroy(){this.release()}getSize(){this.roundedTop=this.top=100*this.priceScale.scaleMargins.top,this.roundedBottom=this.bottom=100*this.priceScale.scaleMargins.bottom}handleResize(e,t){this.currentMoveId?this.release():(this.start(t,Object(c["m"])(e).y),document.addEventListener("mousemove",this.resize),document.addEventListener("mouseup",this.release),document.addEventListener("touchmove",this.resize),document.addEventListener("touchend",this.release))}resize(e){const t=this.getPercentMove(e);t&&(this[this.currentSide]+=t*("top"===this.currentSide?1:-1),this.updateScaleMargins(e))}handleMove(e){this.currentMoveId?this.release():(this.start("both",Object(c["m"])(e).y),document.addEventListener("mousemove",this.move),document.addEventListener("mouseup",this.release),document.addEventListener("touchmove",this.move),document.addEventListener("touchend",this.release))}move(e){const t=this.getPercentMove(e);t&&(this.top+=t,this.bottom-=t,this.updateScaleMargins(e))}release(){this.currentSide&&("both"!==this.currentSide?(document.removeEventListener("mousemove",this.resize),document.removeEventListener("touchmove",this.resize)):(document.removeEventListener("mousemove",this.move),document.removeEventListener("touchmove",this.move)),document.removeEventListener("mouseup",this.release),document.removeEventListener("touchend",this.release),this.currentMoveId=null,this.currentSide=null,this.top=this.roundedTop,this.bottom=this.roundedBottom)}updateScaleMargins(e){const t=Math.round(this.top),i=Math.round(this.bottom);this.roundedTop=Math.max(0,Math.min(100-i,t)),this.roundedBottom=Math.max(0,Math.min(i,100-t));const s={top:this.roundedTop/100,bottom:this.roundedBottom/100};this.priceScale.scaleMargins.top===s.top&&this.priceScale.scaleMargins.bottom===s.bottom||this.$emit("update",{id:this.currentMoveId,side:this.currentSide,value:s,syncable:"touchmove"!==e.type&&!e.shiftKey})}updateMode(e){this.priceScale.mode=+e,this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:this.priceScaleId,priceScale:this.priceScale})}getContainerHeight(){const e=parseFloat(this.$el.parentElement.clientHeight);return e}getPercentMove(e){const t=Object(c["m"])(e),i=(t.y-this.currentOrigin)/this.currentContainerHeight*100;return i?(this.currentOrigin=t.y,i):null}start(e,t){this.currentMoveId=Object(c["v"])(8),this.currentSide=e,this.currentOrigin=t,this.currentContainerHeight=this.getContainerHeight()}};W=Object(a["a"])([Object(n["a"])({name:"ChartPriceScale",components:{DropdownButton:V["a"]},props:{paneId:{required:!0},priceScaleId:{required:!0},priceScale:{required:!0}},watch:{"priceScale.scaleMargins.top":function(){this.currentMoveId||this.getSize()},"priceScale.scaleMargins.bottom":function(){this.currentMoveId||this.getSize()}}})],W);var U=W,Z=U,Q=(i("ab22"),i("2877")),K=Object(Q["a"])(Z,q,H,!1,null,null,null),J=K.exports;let Y=class extends n["c"]{created(){this.getActivePriceScales()}mounted(){document.body.classList.add("-unselectable")}beforeDestroy(){document.body.classList.remove("-unselectable")}getActivePriceScales(){const e=this.$store.state[this.paneId].indicators;this.activePriceScales=Object.keys(e).reduce((t,i)=>{if("string"===typeof this.layouting&&i!==this.layouting)return t;const s=e[i].options.priceScaleId;return t[s]||(t[s]=this.$store.state[this.paneId].priceScales[s],t[s].indicators=[]),t[s].indicators.push(e[i].name),t},{}),this._originalActivePriceScales=JSON.parse(JSON.stringify(this.activePriceScales))}updatePriceScaleScaleMargins(e,t){t.syncable&&this.unsyncableMoveId!==t.id&&(this.syncMoveWithOthers(e,t.side,t.value)||(this.unsyncableMoveId=t.id)),this.activePriceScales[e].scaleMargins=t.value,this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:e,priceScale:this.activePriceScales[e]})}syncMoveWithOthers(e,t,i){const s=this.activePriceScales[e].scaleMargins;let r=!1;for(const a in this.activePriceScales){if(e===a)continue;const t=this.activePriceScales[a].scaleMargins;t.top===s.top&&t.bottom===s.bottom&&(n["c"].set(this.activePriceScales[a],"scaleMargins",i),this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:a,priceScale:this.activePriceScales[a]}),r=!0)}return r}cancel(){for(const e in this._originalActivePriceScales)this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:e,priceScale:this._originalActivePriceScales[e]});this.$store.commit(this.paneId+"/TOGGLE_LAYOUTING")}};Y=Object(a["a"])([Object(n["a"])({components:{ChartPriceScale:J},name:"ChartLayout",props:{paneId:{required:!0},axis:{required:!0},layouting:{required:!0}}})],Y);var X=Y,ee=X,te=(i("8d64"),Object(Q["a"])(ee,F,B,!1,null,null,null)),ie=te.exports,se=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"timeframe-dropdown"},[t("div",{staticClass:"dropdown-item timeframe-dropdown__header",on:{click:function(e){e.stopPropagation()}}},[t("timeframe-input",{staticClass:"timeframe-dropdown__input",attrs:{placeholder:"enter tf."},on:{input:e.onInput,submit:e.addTimeframe}}),e.typeaheadTimeframe&&e.typeaheadTimeframe.value?t("div",{staticClass:"text-nowrap text-monospace text-muted"},[e._v(" ~ "+e._s(e.typeaheadTimeframe.label)+" ")]):e._e(),t("button",{staticClass:"btn -text",attrs:{type:"button"},on:{click:e.toggleEdit}},[t("i",{class:e.editing?"icon-cross":"icon-edit"})])],1),e._l(e.groups,(function(i){return t("section",{key:i.title,staticClass:"section section--small"},[-1!==e.timeframeGroups.indexOf(i.title)?t("div",{staticClass:"section__content"},e._l(i.timeframes,(function(i){return t("button",{key:i.value,staticClass:"dropdown-item dropdown-item--space-between",attrs:{type:"button"},on:{click:function(t){return e.$emit("timeframe",i.value)}}},[t("span",[e._v(e._s(i.label))]),e.editing?t("i",{staticClass:"icon-trash",on:{click:function(t){return t.stopPropagation(),e.removeTimeframe(i.value)}}}):t("i",{staticClass:"icon-star",class:{"icon-star-filled":e.favoriteTimeframes[i.value]},on:{click:function(t){return t.stopPropagation(),e.toggleFavoriteTimeframe(i.value)}}})])})),0):e._e(),t("div",{staticClass:"section__title",on:{click:function(t){return t.stopPropagation(),e.toggleGroup(i)}}},[e._v(" "+e._s(i.title)+" "),t("i",{staticClass:"icon-up-thin"})])])}))],2)},re=[],ae=i("a0a8");let ne=class extends n["c"]{constructor(){super(...arguments),this.editing=!1,this.typeaheadTimeframe=null}get timeframes(){return this.$store.state.settings.timeframes}get favoriteTimeframes(){return this.$store.state.settings.favoriteTimeframes}get timeframeGroups(){return this.$store.state.settings.timeframeGroups}created(){}mounted(){}get groups(){const e=["seconds","minutes","hours","ticks"];let t=-1;const i=60,s=60*i,r=24*s,a=this.typeaheadTimeframe;return this.timeframes.sort((e,t)=>{const i=e.value&&"t"===e.value[e.value.length-1],s=t.value&&"t"===t.value[t.value.length-1];let r=i===s?0:i?1e5:-1e5;return r+=parseFloat(e.value)-parseFloat(t.value),r}).reduce((n,o)=>{if(a&&a.value!=o.value&&-1===o.label.indexOf(a.label))return n;let c;return c=+o.value<i?0:+o.value<s?1:+o.value<=r?2:3,c>t&&(n.push({title:e[c],timeframes:[]}),t=c),n[n.length-1].timeframes.push(o),n},[])}toggleGroup(e){this.$store.commit("settings/TOGGLE_TIMEFRAME_GROUP",e.title)}toggleFavoriteTimeframe(e){this.$store.commit("settings/TOGGLE_FAVORITE_TIMEFRAME",e)}addTimeframe(e){e&&(this.$store.commit(this.paneId+"/SET_TIMEFRAME",e),this.timeframes.find(t=>t.value==e)||(this.$store.commit("settings/ADD_TIMEFRAME",e),this.$store.dispatch("app/showNotice",{title:`Added timeframe ${Object(c["p"])(e)} to the list !`})))}removeTimeframe(e){this.$store.commit("settings/REMOVE_TIMEFRAME",e)}toggleEdit(){this.editing=!this.editing}async onInput(e){this.typeaheadTimeframe=e,await this.$nextTick();const t=Object.keys(this.groups);1===t.length&&-1===this.timeframeGroups.indexOf(this.groups[t[0]].title)&&this.toggleGroup(this.groups[t[0]])}};ne=Object(a["a"])([Object(n["a"])({name:"TimeframeDropdown",components:{TimeframeInput:ae["a"]},props:{paneId:{type:String,required:!0}}})],ne);var oe=ne,ce=oe,le=(i("82d7"),Object(Q["a"])(ce,se,re,!1,null,"0d62332e",null)),he=le.exports,de=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"chart-overlay__panel indicators-overlay"},[e.value?t("div",{staticClass:"chart-overlay__content"},[t("dropdown",{model:{value:e.dropdownTrigger,callback:function(t){e.dropdownTrigger=t},expression:"dropdownTrigger"}},[t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.editIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-edit"}),t("span",[e._v("Edit")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.resizeIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-resize-height"}),t("span",[e._v("Resize")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.duplicateIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-copy-paste"}),t("span",[e._v("Duplicate")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.downloadIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-download"}),t("span",[e._v("Download")])]),t("div",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.removeIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-trash"}),t("span",[e._v("Remove")])])]),e._l(e.indicators,(function(i,s){return t("IndicatorControl",{key:s,attrs:{"indicator-id":s,"pane-id":e.paneId},on:{action:e.onClickIndicator}})}))],2):e._e(),t("div",{staticClass:"chart-overlay__title pane-overlay",on:{click:e.toggleOverlay}},[t("span",[e._v("Indicators")]),t("button",{staticClass:"btn badge -outline",attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.addIndicator.apply(null,arguments)}}},[e._v(" Add "),t("i",{staticClass:"icon-plus -small ml4"})]),t("i",{staticClass:"icon-up-thin"})])])},pe=[],ue=i("2b0e"),me=i("2fe1"),fe=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"indicator",class:{"-error":!!e.error,"-disabled":!e.visible}},[t("button",{staticClass:"indicator__name pane-overlay",attrs:{type:"button"},on:{click:e.onClick}},[e._v(" "+e._s(e.name)+" ")]),t("div",{staticClass:"indicator__controls"},[t("button",{staticClass:"btn",attrs:{title:e.visible?"Hide":"Show"},on:{click:e.toggleVisibility}},[t("i",{class:{"icon-visible":!e.visible,"icon-hidden":e.visible}})]),t("button",{staticClass:"btn",attrs:{title:"Menu"},on:{click:function(t){return e.$emit("action",{indicatorId:e.indicatorId,actionName:"menu",event:t})}}},[t("i",{staticClass:"icon-more"})])]),t("div",{staticClass:"indicator__legend pane-overlay",attrs:{id:e.paneId+e.indicator.id}}),e.error?t("div",[t("i",{staticClass:"icon-warning ml4 mr8"}),e._v(" "+e._s(e.error)+" ")]):e._e()])},ge=[];let ve=class extends ue["default"]{get indicator(){return this.$store.state[this.paneId].indicators[this.indicatorId]}get showLegend(){return this.$store.state[this.paneId].showLegend}get name(){return this.indicator.displayName?this.indicator.displayName:this.indicator.name?this.indicator.name:this.indicatorId}get visible(){return!this.indicator.options||"undefined"===typeof this.indicator.options.visible||this.indicator.options.visible}get error(){return this.$store.state[this.paneId].indicatorsErrors[this.indicatorId]}onClick(e){e.shiftKey?this.$emit("action",{actionName:"resize",indicatorId:this.indicatorId}):this.$emit("action",{indicatorId:this.indicatorId})}toggleVisibility(){this.$nextTick(()=>{this.$store.dispatch(this.paneId+"/toggleSerieVisibility",this.indicatorId)})}};ve=Object(a["a"])([Object(me["b"])({name:"IndicatorControl",props:{paneId:{required:!0},indicatorId:{required:!0}}})],ve);var be=ve,Ie=be,ye=(i("8ffc"),Object(Q["a"])(Ie,fe,ge,!1,null,"1bc47e00",null)),_e=ye.exports,Ce=function(){var e=this,t=e._self._c;return t("Dialog",{staticClass:"-auto",on:{clickOutside:e.close},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"title"},[e._v("Add indicator")]),t("div",{staticClass:"column -center"})]},proxy:!0}])},[t("div",{staticClass:"d-flex mobile-dir-col-desktop-dir-row"},[e.indicators.length?[t("div",{staticClass:"form-group"},[t("label",[e._v("Choose from existing indicator")]),t("div",{staticClass:"d-flex mb8"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.query,expression:"query"}],staticClass:"form-control",attrs:{type:"text",placeholder:"search"},domProps:{value:e.query},on:{input:function(t){t.target.composing||(e.query=t.target.value)}}}),t("div",{staticClass:"-center text-muted ml16",domProps:{textContent:e._s(e.indicators.length)}})]),e.filteredIndicators.length?t("table",{staticClass:"table"},[t("thead",[t("tr",[t("th",[e._v("Name")]),t("th",{staticClass:"min-768"},[e._v("Description")]),t("th")])]),t("tbody",e._l(e.filteredIndicators,(function(i){return t("tr",{key:i.id,staticClass:"-action",on:{click:function(t){return e.selectIndicator(i)}}},[t("td",{staticClass:"table-input"},[e._v(" "+e._s((i.displayName||i.name).replace(/\{[\w_]+\}/g,""))+" ")]),t("td",{staticClass:"min-768 table-input"},[t("span",{staticClass:"text-muted"},[e._v(e._s(i.description))])]),t("td",{staticClass:"table-action -hover",on:{click:function(t){return t.stopPropagation(),e.toggleDropdown(t,i)}}},[t("button",{staticClass:"btn -text -small"},[t("i",{staticClass:"icon-more"})])])])})),0)]):e._e()]),t("hr",{staticClass:"-single -horizontal"}),t("hr",{staticClass:"-single -vertical"})]:e._e(),t("div",{staticClass:"-unshrinkable"},[t("div",{staticClass:"form-group mb16"},[t("label",[e._v("Import indicator")]),t("button",{staticClass:"btn -blue -large -cases w-100 -file"},[t("i",{staticClass:"icon-upload mr8"}),e._v(" Browse "),t("input",{attrs:{type:"file"},on:{change:e.handleFile}})]),t("div",{staticClass:"divider -horizontal",staticStyle:{display:"flex"}},[e._v("Or")]),t("label",[e._v("Create blank indicator")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"form-control",attrs:{placeholder:"Name it"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]),t("div",{staticClass:"form-group mb16"},[t("label",[e._v("Scale with")]),t("dropdown-button",{staticClass:"-outline form-control -arrow",attrs:{options:e.availableScales,placeholder:"Default scale"},on:{input:function(t){return e.setPriceScaleId(t)}},model:{value:e.priceScaleId,callback:function(t){e.priceScaleId=t},expression:"priceScaleId"}})],1),t("div",{staticClass:"text-right"},[t("button",{staticClass:"btn -large -green ml16",on:{click:function(t){return e.createIndicator()}}},[e._v(" Start coding "),t("i",{staticClass:"icon-plus ml8"})])])])],2),t("dropdown",{model:{value:e.dropdownTrigger,callback:function(t){e.dropdownTrigger=t},expression:"dropdownTrigger"}},[t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.selectIndicator()}}},[t("i",{staticClass:"icon-plus"}),t("span",[e._v("Add to chart")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.duplicateIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-copy-paste"}),t("span",[e._v("Duplicate")])]),t("div",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.removeIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-trash"}),t("span",[e._v("Remove")])])])],1)},we=[],ke=i("7250"),Oe=i("1ea0"),xe=i("e7a1"),Re={mixins:[Oe["a"]],components:{Dialog:ke["a"],DropdownButton:V["a"]},props:{paneId:{type:String,required:!0}},data:()=>({name:"",priceScaleId:"right",query:"",indicators:[],selectedIndicator:null,dropdownTrigger:null}),computed:{indicatorId:function(){return Object(c["y"])(Object(c["x"])(this.name),this.indicators.map(e=>e.id))},queryFilter:function(){return new RegExp(this.query.replace(/\W/,".*"),"i")},filteredIndicators:function(){return this.indicators.filter(e=>this.queryFilter.test(e.name)||this.queryFilter.test(e.displayName))},availableScales:function(){return this.indicators.map(e=>e.options&&e.options.priceScaleId).reduce((e,t)=>(!t||e[t]||(e[t]=t),e),{"":"Own scale",right:"Main scale (right)"})}},async created(){await this.getIndicators()},beforeDestroy(){this.editor&&this.editor.destroy()},methods:{async getIndicators(){this.indicators=(await S["a"].getIndicators()).sort((e,t)=>(t.uses||0)-(e.uses||0))},async handleFile(e){try{const t=await xe["a"].getJSON(e.target.files[0]);if(!t.data)throw new Error("indicator is empty");if("indicator"!==t.type)throw new Error("not an indicator");this.createIndicator({name:t.name.split(":").slice(1).join(":"),script:t.data.script||"",options:t.data.options||{}})}catch(t){this.$store.dispatch("app/showNotice",{title:t.message,type:"error"})}},async createIndicator(e){if(e||(e={}),e.name?this.name=e.name:this.name||(this.name="Untitled"),e.id=this.indicatorId,e.name=this.name,!e.priceScaleId){const t=Object(c["x"])(e.name);e.priceScaleId=this.priceScaleId||t}this.$store.dispatch(this.paneId+"/addIndicator",e),O["a"].openIndicator(this.paneId,e.id),this.close(null)},selectIndicator(e=this.selectedIndicator){S["a"].incrementIndicatorUsage(e.id),this.$store.dispatch(this.paneId+"/addIndicator",e),this.close(null)},async removeIndicator(e=this.selectedIndicator){await O["a"].confirm(`Delete indicator "${e.name}" ?`)&&(S["a"].deleteIndicator(e.id),this.indicators.splice(this.indicators.indexOf(e),1))},async duplicateIndicator(e=this.selectedIndicator){this.$store.dispatch(this.paneId+"/duplicateIndicator",{paneId:this.paneId,indicatorId:e.id})},toggleDropdown(e,t){!e||this.dropdownTrigger&&this.selectedIndicator===t?(this.dropdownTrigger=null,this.selectedIndicator=null):(this.dropdownTrigger=e.currentTarget,this.selectedIndicator=t)},setPriceScaleId(e){this.priceScaleId=e}}},Se=Re,Te=Object(Q["a"])(Se,Ce,we,!1,null,null,null),$e=Te.exports;let Ee=class extends ue["default"]{constructor(){super(...arguments),this.dropdownTrigger=null,this.selectedIndicator=null}get indicators(){return this.$store.state[this.paneId].indicators}get ids(){return Object.values(this.indicators).map(e=>e.id)}toggleOverlay(){this.$emit("input",!this.value)}toggleDropdown(e,t){!e||this.dropdownTrigger&&this.selectedIndicator===t?(this.dropdownTrigger=null,this.selectedIndicator=null):(this.dropdownTrigger=e.currentTarget,this.selectedIndicator=t)}async editIndicator(e){O["a"].open((await Promise.all([i.e("chunk-d2fbbe60"),i.e("chunk-1e0e1a87")]).then(i.bind(null,"bb45"))).default,{paneId:this.paneId,indicatorId:e},"indicator"),this.dropdownTrigger=null}removeIndicator(e){this.$store.dispatch(this.paneId+"/removeIndicator",{id:e})}resizeIndicator(e){this.$store.commit(this.paneId+"/TOGGLE_LAYOUTING",e)}duplicateIndicator(e){this.$store.dispatch(this.paneId+"/duplicateIndicator",e)}downloadIndicator(e){this.$store.dispatch(this.paneId+"/downloadIndicator",e)}addIndicator(){O["a"].open($e,{paneId:this.paneId})}onClickIndicator({indicatorId:e,actionName:t,event:i}){switch(t){case"menu":return this.toggleDropdown(i,e);case"remove":return this.removeIndicator(e);case"resize":return this.resizeIndicator(e)}return this.editIndicator(e)}};Ee=Object(a["a"])([Object(me["b"])({name:"IndicatorsOverlay",components:{IndicatorControl:_e},props:{paneId:{type:String},value:{type:Boolean,required:!0}}})],Ee);var Me=Ee,Pe=Me,Le=(i("207f"),Object(Q["a"])(Pe,de,pe,!1,null,"4463ad8b",null)),Ae=Le.exports,De=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"chart-overlay__panel markets-overlay"},[e.showOverlay?t("div",{staticClass:"chart-overlay__content pane-overlay"},[t("div",{staticClass:"column"},[t("a",{staticClass:"btn -text",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.toggleMarkets("perp")}}},[e._v("perp")]),t("i",{staticClass:"pipe -center"},[e._v("|")]),t("a",{staticClass:"btn -text",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.toggleMarkets("spot")}}},[e._v("spot")]),t("i",{staticClass:"pipe -center"},[e._v("|")]),t("a",{staticClass:"btn -text",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.toggleMarkets("all")}}},[e._v("all")])]),t("div",{staticClass:"mx8 mt0"},e._l(e.markets,(function(i){return t("div",{key:i,on:{click:function(t){return e.toggleMarket(t,i)}}},[t("label",{staticClass:"checkbox-control -extra-small mb4"},[t("input",{staticClass:"form-control",attrs:{type:"checkbox"},domProps:{checked:!e.hiddenMarkets[i]},on:{click:function(e){e.stopPropagation(),e.preventDefault()}}}),t("div"),t("span",[e._v(e._s(i))])])])})),0)]):e._e(),t("div",{staticClass:"chart-overlay__title pane-overlay",on:{click:function(t){e.showOverlay=!e.showOverlay}}},[t("div",[e._v("Sources")]),t("button",{staticClass:"btn badge -outline",attrs:{type:"button"},on:{click:e.searchMarkets}},[t("span",{staticClass:"mr4"},[e._v(" "+e._s(e.visibleMarkets)+" ")]),e._v("| "),t("span",[e._v(" Add")]),t("i",{staticClass:"icon-plus -small ml4"})]),t("i",{staticClass:"icon-up-thin"})])])},je=[];let ze=class extends ue["default"]{constructor(){super(...arguments),this.showOverlay=!1}get markets(){return this.$store.state.panes.panes[this.paneId].markets}get hiddenMarkets(){return this.$store.state[this.paneId].hiddenMarkets}get visibleMarkets(){return this.markets.filter(e=>!this.hiddenMarkets[e]).length}searchMarkets(e){this.$store.dispatch("app/showSearch",this.paneId),e.stopPropagation()}toggleMarket(e,t){this.$store.dispatch(this.paneId+"/toggleMarkets",{id:t,inverse:e.shiftKey})}toggleMarkets(e){this.$store.dispatch(this.paneId+"/toggleMarkets",{type:e})}};ze=Object(a["a"])([Object(me["b"])({name:"MarketsOverlay",props:{paneId:{type:String}}})],ze);var Ge=ze,Ne=Ge,Fe=(i("9d1c"),Object(Q["a"])(Ne,De,je,!1,null,null,null)),Be=Fe.exports;let qe=class extends(Object(n["b"])(G["a"])){constructor(){super(...arguments),this.axis=[null,null],this.showIndicatorsOverlay=!1,this.timeframeDropdownTrigger=null}get layouting(){return this.updateChartAxis(),this.$store.state[this.paneId].layouting}get showLegend(){return this.$store.state[this.paneId].showLegend}get favoriteTimeframes(){return this.$store.state.settings.favoriteTimeframes}get timeframe(){return this.$store.state[this.paneId].timeframe}get timeframeForHuman(){return this.timeframe?Object(c["p"])(this.timeframe):"ERR"}get alerts(){return this.$store.state[this.paneId].alerts}created(){this._chartController=new M(this.paneId),this._legendElements={},this._onStoreMutation=this.$store.subscribe(e=>{switch(e.type){case"settings/SET_TEXT_COLOR":this._chartController.chartInstance.applyOptions(Object(l["e"])(e.payload));break;case"settings/SET_CHART_THEME":this._chartController.chartInstance.applyOptions(Object(l["e"])());break;case"settings/TOGGLE_NORMAMIZE_WATERMARKS":this._chartController.refreshMarkets();break;case"settings/SET_TIMEZONE_OFFSET":this._chartController.setTimezoneOffset(this.$store.state.settings.timezoneOffset),this._chartController.clearChart(),this._chartController.renderAll();break;case"panes/SET_PANE_MARKETS":e.payload.id===this.paneId&&(this.$store.state[this.paneId].hiddenMarkets={},this._chartController.refreshMarkets(),this.clear(),this.fetch());break;case"panes/SET_PANE_ZOOM":e.payload.id===this.paneId&&this._chartController.updateFontSize(),this.updateChartAxis();break;case this.paneId+"/SET_TIMEFRAME":this.setTimeframe(e.payload);break;case"settings/TOGGLE_ALERTS":case"app/EXCHANGE_UPDATED":case this.paneId+"/TOGGLE_MARKET":this._chartController.refreshMarkets(),this._chartController.renderAll();break;case this.paneId+"/SET_REFRESH_RATE":this._chartController.clearQueue(),this._chartController.setupQueue();break;case this.paneId+"/TOGGLE_LEGEND":this.showLegend?this.bindLegend():this.unbindLegend();break;case this.paneId+"/SET_GRIDLINES":this.updateGridlines(e.payload.type);break;case this.paneId+"/SET_WATERMARK":case this.paneId+"/TOGGLE_NORMAMIZE_WATERMARKS":this._chartController.updateWatermark();break;case this.paneId+"/SET_INDICATOR_OPTION":this._chartController.setIndicatorOption(e.payload.id,e.payload.key,e.payload.value,e.payload.silent);break;case this.paneId+"/SET_PRICE_SCALE":e.payload.priceScale&&this._chartController.refreshPriceScale(e.payload.id);break;case this.paneId+"/SET_INDICATOR_SCRIPT":this._chartController.rebuildIndicator(e.payload.id);break;case this.paneId+"/ADD_INDICATOR":this._chartController.addIndicator(e.payload.id)&&(this._chartController.redrawIndicator(e.payload.id),this.bindLegend(e.payload.id));break;case this.paneId+"/REMOVE_INDICATOR":this.unbindLegend(e.payload),this._chartController.removeIndicator(e.payload);break;case this.paneId+"/TOGGLE_FILL_GAPS_WITH_EMPTY":this._chartController.toggleFillGapsWithEmpty();break;case this.paneId+"/TOGGLE_FORCE_NORMALIZE_PRICE":this._chartController.propagateInitialPrices=this.$store.state[this.paneId].forceNormalizePrice,this.clear(),this.fetch();break;case"settings/TOGGLE_AUTO_HIDE_HEADERS":this.refreshChartDimensions();break}})}mounted(){this.showIndicatorsOverlay=this.$parent.$el.clientHeight>420,this.createChart()}async createChart(){await this.$nextTick(),this._chartController.createChart(this.$refs.chartContainer),await this.$nextTick(),this.bindChartEvents(),this.setupRecycle(),this.fetch(),this._chartController.setupQueue()}destroyChart(){this.unbindChartEvents(),this._chartController.destroy(),clearTimeout(this._recycleTimeout)}beforeDestroy(){this.destroyChart()}fetch(e){e||(this._reachedEnd=!1);const t=this._chartController.chartCache.cacheRange&&this._chartController.chartCache.cacheRange.from,i=j.filterOutUnavailableMarkets(this.$store.state.panes.panes[this.paneId].markets);if(!i.length)return;const s=+this.$store.state[this.paneId].timeframe;if(!s)return void(this._reachedEnd=!0);if(-1===this.$store.state.app.apiSupportedTimeframes.indexOf(this.timeframe.toString()))return;const r=this._chartController.getVisibleRange();let a;if(e)a=e;else{let e;e=t?this._chartController.chartCache.cacheRange.from:r&&r.from?r.from+this.$store.state.settings.timezoneOffset/1e3:Date.now()/1e3,a={from:e-20*s,to:e}}a.from=Object(c["h"])(Math.round(a.from),s),a.to=Object(c["h"])(Math.round(a.to),s)+s,this._chartController.chartCache.cacheRange.from&&(a.to=Math.min(Object(c["h"])(this._chartController.chartCache.cacheRange.from,s),a.to));const n=Math.floor((a.to-a.from)/s),o=112,l=Object(c["i"])(n*i.length*o);return this.$store.dispatch("app/showNotice",{id:"fetching-"+this.paneId,timeout:15e3,title:`Fetching ${n*i.length} bars (~${l})`,type:"info"}),this._loading=!0,j.fetch(1e3*a.from,1e3*a.to,s,i).then(e=>this.onHistorical(e)).catch(e=>{this._reachedEnd=!0}).then(()=>{this.$store.dispatch("app/hideNotice","fetching-"+this.paneId),setTimeout(()=>{this._loading=!1,this.fetchMore(this._chartController.chartInstance.timeScale().getVisibleLogicalRange())},200)})}onCrosshair(e){let t;if(e&&e.time&&e.point.x>0&&e.point.x<this.$refs.chartContainer.clientWidth&&(t=e.point.x),this._lastCrosshairCoordinates!==t){this._lastCrosshairCoordinates=t;for(let i=0;i<this._chartController.loadedIndicators.length;i++){const s=this._chartController.loadedIndicators[i];if(!s.apis.length)continue;const r=this.paneId+s.id;if(!this._legendElements[r])continue;if(!t)continue;let a="";for(let t=0;t<s.apis.length;t++){if(t>10)break;const i=s.apis[t],r=e.seriesPrices.get(i);if(a.length&&(a+=" | "),!r){a+="na";continue}const n=s.options.priceFormat&&"volume"===s.options.priceFormat.type?$["c"]:$["e"];"number"===typeof r?a+=n(r,i.precision):r.close&&(a+=`O: ${n(r.open,i.precision)} H: ${n(r.high,i.precision)} L: ${n(r.low,i.precision)} C: ${n(r.close,i.precision)}`)}this._legendElements[r].textContent=a}}}onHistorical(e){const t={from:e.from,to:e.to,bars:e.data};this._chartController.chartCache.saveChunk(t),this.$store.state[this.paneId].forceNormalizePrice||(this._chartController.propagateInitialPrices=!1),this._chartController.renderAll(!0)}onTrades(e){this._chartController.queueTrades(e)}onAlert({price:e,market:t}){this._chartController.triggerAlert(t,e)}refreshChartDimensions(){this._chartController&&this._chartController.chartInstance&&this.$nextTick(()=>{let e=0;this.$store.state.settings.autoHideHeaders||(e=2*(this.$store.state.panes.panes[this.paneId].zoom||1)*16),this._chartController.chartInstance.resize(this.$el.clientWidth,this.$el.clientHeight-e)})}onPan(e){!e||this._chartController.panPrevented||this._loading||/t$/.test(this.timeframe)||(this._onPanTimeout&&(clearTimeout(this._onPanTimeout),this._onPanTimeout=null),this._onPanTimeout=setTimeout(()=>{this._onPanTimeout=null,null!==this._chartController.chartCache.cacheRange.from&&(e=this._chartController.chartInstance.timeScale().getVisibleLogicalRange(),this.savePosition(e),this.fetchMore(e))},500))}bindChartEvents(){R["a"].on("trades",this.onTrades),R["a"].on("alert",this.onAlert),this.showLegend&&this.showIndicatorsOverlay&&this.bindLegend(),this._chartController.chartInstance.timeScale().subscribeVisibleLogicalRangeChange(this.onPan)}unbindChartEvents(){R["a"].off("trades",this.onTrades),R["a"].off("alert",this.onAlert),this.unbindLegend(),this._chartController.chartInstance.timeScale().unsubscribeVisibleLogicalRangeChange(this.onPan)}onLevelDragStart(e){if(this._levelDragEndHandler||!this.$store.state.settings.alerts||e.button||O["a"].hasDialogOpened)return;const t=this._chartController.getPricelineAtPoint(e);if(!t||!t.api)return;const i=this._chartController.chartElement.querySelector("canvas:nth-child(2)");t.priceline&&this._chartController.disableCrosshair(),this._levelDragMoveHandler=this.onLevelDragMove.bind(this,t,Date.now()),i.addEventListener(/touch/.test(e.type)?"touchmove":"mousemove",this._levelDragMoveHandler),this._levelDragEndHandler=this.onLevelDragEnd.bind(this,t,Date.now()),i.addEventListener(/touch/.test(e.type)?"touchend":"mouseup",this._levelDragEndHandler)}onLevelDragMove({api:e,priceline:t,originalOffset:i,offset:s},r,a){const{x:n,y:o}=Object(T["a"])(a),c=Math.abs(i.y-o)>5||Date.now()-r>100;if(s.x=n,s.y=o,t){if(a.stopPropagation(),!c)return;const i=+Object($["e"])(e.coordinateToPrice(o),e.options().priceFormat.precision);t.applyOptions({price:i})}}async onLevelDragEnd({api:e,priceline:t,price:i,market:s,canCreate:r,originalOffset:a,offset:n},o,c){const l=this._chartController.chartElement.querySelector("canvas:nth-child(2)"),h=Math.abs(a.y-n.y)>5||Date.now()-o>200;if(r=!t&&r&&!h,(t||r)&&this._chartController.chartInstance.clearCrosshairPosition(),l.removeEventListener(/touch/.test(c.type)?"touchend":"mouseup",this._levelDragEndHandler),this._levelDragEndHandler=null,this._levelDragMoveHandler&&(l.removeEventListener(/touch/.test(c.type)?"touchmove":"mousemove",this._levelDragMoveHandler),this._levelDragMoveHandler=null),!this._onPanTimeout)if(t){this._chartController.enableCrosshair();const r=this._chartController.alerts[s].find(e=>e.price===i),a=t.options().price;if(i!==a&&h){const e=await z["a"].moveAlert(s,i,a);r.triggered=!1,r.price=a,r.active=e,await S["a"].saveAlerts({market:s,alerts:this._chartController.alerts[s].filter(e=>e.market===r.market)}),t.applyOptions({title:""})}else{e.removePriceLine(t);try{await z["a"].unsubscribe(s,i)}catch(d){r&&r.active&&this.$store.dispatch("app/showNotice",{id:"alert-registration-failure",title:d.message+"\nYou need to make sure your browser is set to allow push notifications.",type:"error"})}const a=this._chartController.alerts[s].indexOf(r);-1!==a&&this._chartController.alerts[s].splice(a,1),await S["a"].saveAlerts({market:s,alerts:this._chartController.alerts[s].filter(e=>e.price!==i)})}}else if(r){const t=Object(P["k"])(this.$store.state.settings.alertsColor),r=t[3]||1;let a;t[3]=.5*r,c.ctrlKey||c.metaKey||(a=this._chartController.chartInstance.timeScale().coordinateToTime(n.x));const o=this._chartController.renderAlert({price:i,market:s,timestamp:a},e,Object(P["i"])(t)),l={price:i,market:s,timestamp:a,active:!1};let h;this._chartController.alerts[s].push(l),await z["a"].subscribe(s,i).then(e=>{if(-1!==this._chartController.alerts[s].indexOf(l)){l.active=e;const i=e?r:.75*r;t[3]=i,h=Object(P["i"])(t)}}).catch(e=>{this.$store.dispatch("app/showNotice",{id:"alert-registration-failure",title:e.message+"\nYou need to make sure your browser is set to allow push notifications.",type:"error"}),h=this.$store.state.settings.alertsColor}).finally(()=>{S["a"].saveAlerts({market:s,alerts:this._chartController.alerts[s]}),o.applyOptions({color:h})})}}getBarSpacing(e){if(!e)return l["a"].timeScale.barSpacing;const t=this.$refs.chartContainer.querySelector("canvas").width;return t/(e.to-e.from)/window.devicePixelRatio}savePosition(e){this.$store.commit(this.paneId+"/SET_BAR_SPACING",this.getBarSpacing(e))}setupRecycle(){this._recycleTimeout=setTimeout(this.trimChart.bind(this),18e4),this.setTimeToRecycle()}trimChart(){if(Date.now()>this._timeToRecycle){const e=this._chartController.getVisibleRange();let t;e&&(t=e.from-2*(e.to-e.from)),this._chartController.chartCache.trim(t)&&this.renderChart(),this.setTimeToRecycle()}const e=this.$store.state[this.paneId].refreshRate<1e3;e&&this.fixFastRefreshRate(),this._recycleTimeout=setTimeout(this.trimChart,6e4*(e?3:15))}fixFastRefreshRate(){const e=this._chartController.chartInstance.options().layout.fontSize;this._chartController.preventPan(),this._chartController.chartInstance.applyOptions({layout:{fontSize:e+1}}),setTimeout(()=>{this._chartController.chartInstance.applyOptions({layout:{fontSize:e}})},50)}renderChart(){this._chartController.renderAll()}resetChart(){this.destroyChart(),this.$nextTick(()=>{this.createChart()})}async fetchMore(e){if(this._loading||this._reachedEnd||!e||e.from>0)return;let t=0;if(this._chartController.activeRenderer)for(const r in this._chartController.activeRenderer.indicators)this._chartController.activeRenderer.indicators[r].minLength&&(t=Math.max(t,this._chartController.activeRenderer.indicators[r].minLength));const i=Math.round(Math.min(Math.abs(e.from)+t,500));if(!i)return;const s={from:this._chartController.chartCache.cacheRange.from-i*this.$store.state[this.paneId].timeframe,to:this._chartController.chartCache.cacheRange.from-1};await this.fetch(s)}onResize(){this.refreshChartDimensions()}clear(){this._chartController.clear(),this._reachedEnd=!1}changeTimeframe(e){if(window.event.shiftKey)for(const t in this.$store.state.panes.panes){const i=this.$store.state.panes.panes[t].type;"chart"===i&&this.$store.state[t].timeframe!==e&&this.$store.commit(t+"/SET_TIMEFRAME",e)}else this.$store.commit(this.paneId+"/SET_TIMEFRAME",e)}setTimeframe(e){const t=parseInt(e),i="t"===e[e.length-1]?"tick":"time";i===this._chartController.type&&"time"===i&&this._chartController.timeframe<t&&-1===this.$store.state.app.apiSupportedTimeframes.indexOf(e)&&Number.isInteger(t/this._chartController.timeframe)?(this._chartController.resample(e),this.fetchMore(this._chartController.chartInstance.timeScale().getVisibleLogicalRange())):(this._chartController.clear(),this.fetch()),this._reachedEnd=!1}async bindLegend(e){if(!this.showLegend)return;if(!e){for(const e in this.$store.state[this.paneId].indicators)this.bindLegend(e);return void this._chartController.chartInstance.subscribeCrosshairMove(this.onCrosshair)}await this.$nextTick();const t=this.paneId+e;if(this._legendElements[t])return;const i=document.getElementById(t);i&&(this._legendElements[t]=i)}unbindLegend(e){if(!e){for(const e in this.$store.state[this.paneId].indicators)this.unbindLegend(e);return void this._chartController.chartInstance.unsubscribeCrosshairMove(this.onCrosshair)}const t=this.paneId+e;for(const i in this._legendElements)if(t===i)return this._legendElements[i].innerText="",void delete this._legendElements[i]}updateGridlines(e){const t=this.$store.state[this.paneId];let i,s;"vertical"===e?(i=t.showVerticalGridlines,s=t.verticalGridlinesColor):(i=t.showHorizontalGridlines,s=t.horizontalGridlinesColor),this._chartController.chartInstance.applyOptions({grid:{["vertical"===e?"vertLines":"horzLines"]:{color:s,visible:i}}})}updateWatermark(){const e=this.$store.state[this.paneId];this._chartController.chartInstance.applyOptions({watermark:{color:e.watermarkColor,visible:e.showWatermark}})}updateChartAxis(){this.$refs.chartContainer&&(this.axis=[this.$refs.chartContainer.querySelector("td:last-child canvas:nth-child(2)").clientWidth,this.$refs.chartContainer.querySelector("tr:last-child").clientHeight])}takeScreenshot(){const e=this._chartController.chartInstance.takeScreenshot(),t=document.createElement("canvas"),i=t.getContext("2d"),s=this.$store.state.panes.panes[this.paneId].zoom||1,r=window.devicePixelRatio||1,a=16*s*r,n=12*s*r;t.width=e.width,i.font=n+"px Share Tech Mono",i.textAlign="left",i.textBaseline="top";const o=[],l=(new Date).toUTCString(),h=this.$store.state.panes.panes[this.paneId].markets.filter(e=>!this.$store.state[this.paneId].hiddenMarkets[e]).length;o.push(l+" | "+this.timeframeForHuman),o.push(this._chartController.watermark+(h>1&&this.$store.state.settings.normalizeWatermarks?" ("+h+" markets)":""));const d=Math.round(n);t.height=e.height;const p=this.$store.state.settings.backgroundColor,u=getComputedStyle(document.documentElement).getPropertyValue("--theme-color-100");i.fillStyle=p,i.fillRect(0,0,t.width,t.height),i.fillStyle="light"===this.$store.state.settings.theme?"rgba(255,255,255,.2)":"rgba(0,0,0,.2)",i.fillRect(0,0,t.width,t.height),i.drawImage(e,0,0),i.fillStyle=u,i.font=n+"px Share Tech Mono",i.textAlign="left",i.textBaseline="top";let m=0;for(let c=0;c<o.length;c++)i.fillText(o[c],a,a+m),m+=d*(c+1);const f=Object(P["d"])(Object(P["k"])(p)),g=f<0?"#ffffff":"#000000";this.showIndicatorsOverlay&&(m+=2*a,Object.values(this.$store.state[this.paneId].indicators).forEach(e=>{const t=e.options;if(!1===t.visible)return;let s=t.color||t.upColor||g;try{s=Object(P["k"])(s),"undefined"!==typeof s[3]&&(s[3]=1),s=Object(P["i"])(s)}catch(n){}const r=e.displayName||e.name;i.fillStyle=p,i.fillText(r,a+1,m+1),i.fillText(r,a-1,m-1),i.fillStyle=s,i.fillText(r,a,m),m+=1.2*d}));const v=t.toDataURL("image/png"),b=v.indexOf("base64,")+7,I=v.substr(b);Object(c["s"])(I,"image/png")}toggleIndicatorOverlay(){this.showIndicatorsOverlay&&this.unbindLegend(),this.showIndicatorsOverlay=!this.showIndicatorsOverlay,this.showIndicatorsOverlay&&this.$nextTick(()=>{this.bindLegend()})}toggleLayout(){this.$store.commit(this.paneId+"/TOGGLE_LAYOUTING")}setTimeToRecycle(){const e=Date.now();if("time"===this._chartController.type){const t=this.$refs.chartContainer.querySelector("canvas").width,i=this.getBarSpacing(this._chartController.chartInstance.timeScale().getVisibleLogicalRange());this._timeToRecycle=e+Math.min(864e5,1e3*parseInt(this.timeframe)*(t/i)/2)}this._timeToRecycle=e+9e5}toggleTimeframeDropdown(e){this.timeframeDropdownTrigger?this.timeframeDropdownTrigger=null:this.timeframeDropdownTrigger=e.currentTarget}};qe=Object(a["a"])([Object(n["a"])({name:"Chart",components:{ChartLayout:ie,PaneHeader:N["a"],TimeframeDropdown:he,IndicatorsOverlay:Ae,MarketsOverlay:Be}})],qe);var He=qe,Ve=He,We=(i("3ef3"),Object(Q["a"])(Ve,s,r,!1,null,"4747b63b",null));t["default"]=We.exports},ab22:function(e,t,i){"use strict";i("043b")},ec49:function(e,t,i){}}]);
//# sourceMappingURL=chunk-662f5aef.c34ac558.js.map