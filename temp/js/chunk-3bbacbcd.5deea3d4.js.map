{"version":3,"sources":["webpack:///./src/mixins/paneMixin.ts","webpack:///./src/components/stats/Stats.vue?c92a","webpack:///./src/components/panes/PaneHeader.vue","webpack:///./src/components/panes/PaneHeader.vue?4649","webpack:///./src/components/panes/PaneHeader.vue?fd01","webpack:///./src/components/panes/PaneHeader.vue?c599","webpack:///./src/components/stats/Stats.vue","webpack:///./src/utils/bucket.ts","webpack:///./src/components/stats/Stats.vue?8d7f","webpack:///./src/components/stats/Stats.vue?ddcc","webpack:///./src/components/stats/Stats.vue?0bac"],"names":["PaneMixin","Vue","this","$store","state","panes","paneId","mounted","$el","id","refreshZoom","$nextTick","width","clientWidth","onResize","clientHeight","addEventListener","focusPane","beforeDestroy","removeEventListener","_onStoreMutation","dispatch","commit","Component","props","required","type","String","render","_vm","_c","_self","_setupProxy","staticClass","class","loading","attrs","on","renamePane","_v","_s","name","maximizePane","_t","openSearch","settings","openSettings","_e","toggleDropdown","model","value","paneDropdownTrigger","callback","$$v","expression","$event","stopPropagation","changeZoom","resetZoom","apply","arguments","zoom","toFixed","duplicatePane","removePane","staticRenderFns","constructor","market","marketsListeners","markets","local","event","direction","shiftKey","$emit","dialogService","confirm","highlightPane","parentElement","classList","currentTarget","target","className","el","isMaximized","toggle","siblings","getSiblings","sibling","getAttribute","remove","style","display","cls","Event","window","dispatchEvent","prompt","action","input","open","default","default_1","Function","Boolean","component","_l","data","bucket","key","editStat","enableChart","ref","Bucket","options","stacks","filled","remaining","timeouts","adapter","getAdapter","isNaN","store","precision","color","parseColor","granularity","Math","max","windowLabel","getHms","replace","clear","str","litteral","live","i","length","clearTimeout","unbind","onStats","stats","timestamp","appendStack","p","ceil","change","addData","Date","now","push","setTimeout","shiftStack","bind","shift","stack","getValue","createSerie","chart","serie","apiMethodName","charAt","toUpperCase","slice","Object","assign","defaultPlotsOptions","priceScaleId","title","priceLineVisible","lineWidth","scaleMargins","top","bottom","getColorOptions","updateSerie","point","time","update","r","g","b","indexOf","hexToRgb","splitColorCode","topColor","bottomColor","lineColor","colorInput","test","updateColor","applyOptions","removeIndicator","removeSeries","Mixins","_buckets","_feed","buckets","created","subscribe","mutation","_chart","payload","getChartCustomColorsOptions","prepareBuckets","recolorBucket","reloadBucketSerie","createChart","removeChart","createBucket","removeBucket","refreshBucket","refreshBucketName","aggregatorService","off","onVolume","clearBuckets","chartOptions","getChartOptions","defaultStatsChartOptions","TV","$refs","refreshChartDimensions","debounceTime","_refreshChartDimensionsTimeout","resize","getBucketId","pane","sums","$set","formatAmount","$delete","statBucket","enabled","StatDialog","bucketId","components","PaneHeader"],"mappings":"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","file":"js/chunk-3bbacbcd.5deea3d4.js","sourcesContent":["import { Pane } from '@/store/panes'\nimport Vue from 'vue'\nimport Component from 'vue-class-component'\n\n@Component({\n  props: {\n    paneId: {\n      required: true,\n      type: String\n    }\n  }\n})\nexport default class PaneMixin extends Vue {\n  paneId: string\n  protected _onStoreMutation: () => void\n\n  get pane(): Pane {\n    return this.$store.state.panes.panes[this.paneId]\n  }\n\n  mounted() {\n    this.$el.id = this.paneId\n\n    this.refreshZoom()\n\n    this.$nextTick(() => {\n      const width = this.$el.clientWidth\n\n      if (typeof this.onResize === 'function') {\n        this.onResize(width, this.$el.clientHeight, true)\n      }\n    })\n\n    this.$el.addEventListener('mousedown', this.focusPane)\n  }\n\n  beforeDestroy() {\n    this.$el.removeEventListener('mousedown', this.focusPane)\n\n    if (this._onStoreMutation) {\n      this._onStoreMutation()\n    }\n  }\n\n  refreshZoom() {\n    this.$store.dispatch('panes/refreshZoom', this.paneId)\n  }\n\n  focusPane() {\n    this.$store.commit('app/SET_FOCUSED_PANE', this.paneId)\n  }\n\n  onResize?(newWidth: number, newHeight: number, isMounting?: boolean)\n}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=style&index=0&id=b3a3024a&prod&lang=scss&\"","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('div',{staticClass:\"pane-header hide-scrollbar pane-overlay d-flex\",class:{ '-loading': _vm.loading }},[_c('div',{staticClass:\"pane-header__loader\"}),_c('span',{staticClass:\"pane-header__name ml4 mrauto\",attrs:{\"data-hide-header\":\"\"},on:{\"dblclick\":_vm.renamePane}},[_vm._v(_vm._s(_vm.name))]),_c('div',{staticClass:\"toolbar flex-grow-1\",on:{\"dblclick\":_vm.maximizePane}},[_vm._t(\"default\"),_c('button',{staticClass:\"toolbar__label min-768\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.openSearch}},[_c('i',{staticClass:\"icon-search\"})]),(_vm.settings)?_c('button',{staticClass:\"toolbar__label min-768\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.openSettings}},[_c('i',{staticClass:\"icon-cog\"})]):_vm._e(),_c('button',{staticClass:\"toolbar__label\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.toggleDropdown}},[_c('i',{staticClass:\"icon-more\"})]),_c('dropdown',{model:{value:(_vm.paneDropdownTrigger),callback:function ($$v) {_vm.paneDropdownTrigger=$$v},expression:\"paneDropdownTrigger\"}},[_c('div',{staticClass:\"d-flex btn-group\"},[_c('button',{staticClass:\"btn -green\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.changeZoom($event, -1)}}},[_c('i',{staticClass:\"icon-minus\"})]),_c('button',{staticClass:\"btn -green text-monospace flex-grow-1 text-center\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.resetZoom.apply(null, arguments)}}},[_vm._v(\" Ã— \"+_vm._s(_vm.zoom.toFixed(2))+\" \")]),_c('button',{staticClass:\"btn -green\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.changeZoom($event, 1)}}},[_c('i',{staticClass:\"icon-plus\"})])]),_vm._t(\"menu\"),(_vm.settings !== null)?_c('button',{staticClass:\"dropdown-item\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.openSettings}},[_c('i',{staticClass:\"icon-cog\"}),_c('span',[_vm._v(\"Settings\")])]):_vm._e(),_c('button',{staticClass:\"dropdown-item\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){return _vm.$store.dispatch('app/showSearch', _vm.paneId)}}},[_c('i',{staticClass:\"icon-search\"}),_c('span',[_vm._v(\"Sources\")])]),_c('button',{staticClass:\"dropdown-item\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.maximizePane}},[_c('i',{staticClass:\"icon-enlarge\"}),_c('span',[_vm._v(\"Maximize\")])]),_c('button',{staticClass:\"dropdown-item\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.duplicatePane}},[_c('i',{staticClass:\"icon-copy-paste\"}),_c('span',[_vm._v(\"Duplicate\")])]),_c('div',{staticClass:\"dropdown--divider\"}),_c('button',{staticClass:\"dropdown-item\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.removePane}},[_c('i',{staticClass:\"icon-trash\"}),_c('span',[_vm._v(\"Remove\")])])],2)],2)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\nimport Vue from 'vue'\nimport Component from 'vue-class-component'\n\nimport { getSiblings } from '@/utils/helpers'\nimport dialogService from '@/services/dialogService'\n\n@Component({\n  name: 'PaneHeader',\n  props: {\n    paneId: {\n      type: String\n    },\n    settings: {\n      type: Function,\n      default: null\n    },\n    loading: {\n      type: Boolean,\n      default: false\n    }\n  }\n})\nexport default class extends Vue {\n  private settings?: () => Promise<any>\n  paneId: string\n  paneDropdownTrigger = null\n\n  get zoom() {\n    return this.$store.state.panes.panes[this.paneId].zoom || 1\n  }\n\n  get type() {\n    return this.$store.state.panes.panes[this.paneId].type\n  }\n\n  get name() {\n    const name = this.$store.state.panes.panes[this.paneId].name\n    const market = this.$store.state.panes.marketsListeners[\n      this.$store.state.panes.panes[this.paneId].markets[0]\n    ]\n\n    if (name) {\n      return name\n    } else if (market) {\n      return market.local\n    } else {\n      return this.type\n    }\n  }\n\n  openSearch() {\n    this.$store.dispatch('app/showSearch', this.paneId)\n  }\n\n  changeZoom(event, direction) {\n    const zoom = this.zoom + (event.shiftKey ? 0.0625 : 0.125) * direction\n    this.$store.dispatch('panes/setZoom', { id: this.paneId, zoom: zoom })\n\n    this.$emit('zoom', zoom)\n  }\n\n  resetZoom() {\n    this.$store.dispatch('panes/setZoom', { id: this.paneId, zoom: 1 })\n\n    this.$emit('zoom', 1)\n  }\n\n  async removePane() {\n    if (await dialogService.confirm(`Delete pane \"${this.paneId}\" ?`)) {\n      this.$store.dispatch('panes/removePane', this.paneId)\n    }\n  }\n\n  duplicatePane() {\n    this.$store.dispatch('panes/duplicatePane', this.paneId)\n  }\n\n  highlightPane(value: boolean) {\n    this.$el.parentElement.parentElement.classList[value ? 'add' : 'remove'](\n      '-highlight'\n    )\n  }\n\n  maximizePane(event) {\n    if (\n      event.type === 'dblclick' &&\n      event.currentTarget !== event.target &&\n      event.target.className !== 'toolbar__spacer'\n    ) {\n      return\n    }\n\n    const el = this.$el.parentElement.parentElement\n    const isMaximized = el.classList.toggle('-maximized')\n\n    const siblings = getSiblings(el)\n\n    for (const sibling of siblings) {\n      if (!sibling.getAttribute('type')) {\n        continue\n      }\n      sibling.classList.remove('-maximized')\n      sibling.style.display = isMaximized ? 'none' : 'block'\n    }\n\n    const cls = Event as any\n\n    window.dispatchEvent(new cls('resize'))\n  }\n\n  async renamePane() {\n    const name = await dialogService.prompt({\n      action: 'Rename',\n      input: this.name\n    })\n\n    if (name !== this.name) {\n      this.$store.commit('panes/SET_PANE_NAME', { id: this.paneId, name: name })\n    }\n  }\n\n  toggleDropdown(event) {\n    if (this.paneDropdownTrigger) {\n      this.paneDropdownTrigger = null\n    } else {\n      this.paneDropdownTrigger = event.currentTarget\n    }\n  }\n\n  async openSettings() {\n    if (!this.settings) {\n      return\n    }\n\n    dialogService.open((await this.settings()).default, {\n      paneId: this.paneId\n    })\n  }\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--15-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--15-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PaneHeader.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--15-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--15-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PaneHeader.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./PaneHeader.vue?vue&type=template&id=219eac84&\"\nimport script from \"./PaneHeader.vue?vue&type=script&lang=ts&\"\nexport * from \"./PaneHeader.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('div',{staticClass:\"pane-stats\"},[_c('pane-header',{attrs:{\"paneId\":_vm.paneId,\"settings\":() => import('@/components/stats/StatsDialog.vue')}}),_c('ul',{staticClass:\"stats-buckets\"},_vm._l((_vm.data),function(bucket,id){return _c('li',{key:id,staticClass:\"stat-bucket\",on:{\"click\":function($event){return _vm.editStat(id)}}},[_c('div',{staticClass:\"stat-bucket__name\"},[_vm._v(_vm._s(bucket.name))]),_c('div',{staticClass:\"stat-bucket__value\"},[_vm._v(_vm._s(bucket.value))])])}),0),(_vm.enableChart)?_c('div',{ref:\"chart\",staticClass:\"stats-chart\"}):_vm._e()],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { defaultPlotsOptions } from '@/components/chart/options'\nimport { Volumes } from '@/types/types'\nimport { IChartApi, ISeriesApi, UTCTimestamp } from 'lightweight-charts'\nimport store from '../store'\nimport { hexToRgb, splitColorCode } from './colors'\nimport { getHms } from './helpers'\n\nexport type BucketColor = string | ((value: number) => string)\n\nexport interface BucketOptions {\n  id: string\n  name: string\n  window?: number\n  precision?: number\n  color?: string\n  type?: string\n}\n\nexport default class Bucket {\n  id: string\n  name: string\n  window: number\n  precision: number\n  color: BucketColor\n  granularity: number\n  type: string\n\n  stacks: any[] = []\n\n  private timestamp: number\n  private live: number\n  private filled = false\n  private remaining = 0\n\n  private adapter: (stats: Volumes) => number\n  private serie: ISeriesApi<'Line'>\n  private timeouts: number[] = []\n\n  constructor(input, options: BucketOptions, paneId: string) {\n    this.id = options.id\n    this.name = options.name\n\n    this.adapter = this.getAdapter(input)\n\n    this.window =\n      (!isNaN(options.window) ? +options.window : store.state[paneId].window) ||\n      60000\n    this.precision = options.precision\n    this.color = this.parseColor(options.color)\n    this.granularity = Math.max(\n      store.state[paneId].granularity,\n      this.window / 5000\n    )\n    this.type = options.type || 'line'\n\n    const windowLabel = getHms(this.window).replace(/^1(\\w)$/, '$1')\n\n    this.name += '/' + windowLabel\n\n    this.clear()\n\n    if (module.hot) {\n      module.hot.dispose(() => {\n        this.unbind()\n      })\n    }\n  }\n\n  getAdapter(str: string) {\n    const litteral = str.replace(\n      /([^.]|^)(vbuy|vsell|cbuy|csell|lbuy|lsell)/g,\n      '$1stats.$2'\n    )\n    return new Function('stats', `'use strict'; return ${litteral};`) as (\n      stats: Volumes\n    ) => number\n  }\n\n  clear() {\n    this.stacks = []\n    this.live = 0\n    this.filled = false\n    this.remaining = 0\n\n    for (let i = 0; i < this.timeouts.length; i++) {\n      clearTimeout(this.timeouts[i])\n    }\n\n    this.timeouts = []\n  }\n\n  unbind() {\n    this.clear()\n  }\n\n  onStats(stats: Volumes) {\n    const value = this.adapter(stats)\n\n    if (\n      !this.stacks.length ||\n      stats.timestamp > this.timestamp + this.granularity\n    ) {\n      this.appendStack(stats.timestamp)\n    } else if (this.filled && this.remaining) {\n      const p = (stats.timestamp - this.timestamp) / this.granularity\n      const remaining = Math.ceil(this.stacks[0] * (1 - p))\n      const change = this.remaining - remaining\n      this.remaining = remaining\n      this.live -= change\n    }\n\n    this.addData(value)\n  }\n\n  appendStack(timestamp) {\n    if (!timestamp) {\n      timestamp = Date.now()\n    }\n\n    if (!this.stacks.length || this.stacks[this.stacks.length - 1]) {\n      this.stacks.push(0)\n\n      this.timeouts.push(setTimeout(this.shiftStack.bind(this), this.window))\n    }\n\n    this.timestamp = timestamp\n\n    if (!this.filled && this.stacks.length === this.window / this.granularity) {\n      this.filled = true\n    }\n  }\n\n  shiftStack() {\n    this.timeouts.shift()\n\n    const stack = this.stacks.shift()\n\n    if (!stack) {\n      return\n    }\n\n    if (this.remaining) {\n      this.live -= this.remaining\n    }\n\n    this.remaining = this.stacks[0]\n\n    // this.live -= stack\n  }\n\n  addData(data) {\n    this.stacks[this.stacks.length - 1] += data\n    this.live += data\n  }\n\n  getValue() {\n    return this.live\n  }\n\n  createSerie(chart: IChartApi) {\n    if (this.serie) {\n      return\n    }\n\n    const apiMethodName =\n      'add' +\n      (this.type.charAt(0).toUpperCase() + this.type.slice(1)) +\n      'Series'\n    const options = Object.assign({}, defaultPlotsOptions[this.type], {\n      priceScaleId: this.name,\n      title: this.name,\n      priceLineVisible: false,\n      lineWidth: 1,\n      scaleMargins: {\n        top: 0.05,\n        bottom: 0.05\n      },\n      ...this.getColorOptions()\n    })\n\n    this.serie = chart[apiMethodName](options)\n  }\n\n  updateSerie() {\n    const value = this.getValue()\n\n    if (\n      !this.serie ||\n      !this.timestamp ||\n      (this.type === 'histogram' && !value)\n    ) {\n      return\n    }\n\n    const point: any = {\n      time: (this.timestamp / 1000) as UTCTimestamp,\n      value: value\n    }\n\n    if (typeof this.color === 'function') {\n      point.color = this.color(value)\n    }\n\n    this.serie.update(point)\n  }\n\n  getColorOptions() {\n    if (typeof this.color === 'function') {\n      return {}\n    }\n\n    if (this.type === 'area') {\n      let r: number\n      let g: number\n      let b: number\n\n      if ((this.color as string).indexOf('#') === 0) {\n        ;[r, g, b] = hexToRgb(this.color)\n      } else {\n        ;[r, g, b] = splitColorCode(this.color)\n      }\n\n      const topColor = `rgba(${r},${g},${b}, .4)`\n      const bottomColor = `rgba(${r},${g},${b}, 0)`\n      return {\n        topColor,\n        bottomColor,\n        lineColor: this.color\n      }\n    } else {\n      return { color: this.color }\n    }\n  }\n\n  parseColor(colorInput: string): BucketColor {\n    if (/rgba?\\(|#/.test(colorInput)) {\n      return colorInput\n    }\n\n    return (function() {\n      'use strict'\n      return new Function('value', '\"use strict\"; return ' + colorInput)\n    })() as BucketColor\n  }\n\n  updateColor(color) {\n    if (!this.serie) {\n      return\n    }\n\n    this.color = this.parseColor(color)\n\n    if (typeof color === 'string') {\n      this.serie.applyOptions(this.getColorOptions())\n    }\n  }\n\n  removeIndicator(chart: IChartApi) {\n    if (!this.serie) {\n      return\n    }\n\n    chart.removeSeries(this.serie)\n\n    delete this.serie\n  }\n}\n","\r\nimport { Component, Mixins } from 'vue-property-decorator'\r\nimport * as TV from 'lightweight-charts'\r\nimport aggregatorService from '@/services/aggregatorService'\r\nimport Bucket from '../../utils/bucket'\r\nimport {\r\n  defaultStatsChartOptions,\r\n  getChartOptions,\r\n  getChartCustomColorsOptions\r\n} from '../chart/options'\r\n\r\nimport StatDialog from './StatDialog.vue'\r\nimport dialogService from '@/services/dialogService'\r\n\r\nimport { getBucketId } from '@/utils/helpers'\r\nimport { formatAmount } from '@/services/productsService'\r\nimport PaneMixin from '@/mixins/paneMixin'\r\nimport PaneHeader from '../panes/PaneHeader.vue'\r\n\r\n@Component({\r\n  components: { PaneHeader },\r\n  name: 'Stats'\r\n})\r\nexport default class extends Mixins(PaneMixin) {\r\n  data = {}\r\n\r\n  $refs!: {\r\n    chart: HTMLElement\r\n  }\r\n\r\n  private _refreshChartDimensionsTimeout: number\r\n  private _chart: TV.IChartApi\r\n  private _buckets: { [id: string]: Bucket } = {}\r\n  private _feed: string = null\r\n\r\n  get enableChart() {\r\n    return this.$store.state[this.paneId].enableChart\r\n  }\r\n\r\n  get buckets() {\r\n    return this.$store.state[this.paneId].buckets\r\n  }\r\n\r\n  created() {\r\n    this._onStoreMutation = this.$store.subscribe(mutation => {\r\n      switch (mutation.type) {\r\n        case 'settings/SET_TEXT_COLOR':\r\n          if (this._chart && mutation.payload) {\r\n            this._chart.applyOptions(\r\n              getChartCustomColorsOptions(mutation.payload)\r\n            )\r\n          }\r\n          break\r\n        case 'settings/SET_CHART_THEME':\r\n          if (this._chart) {\r\n            this._chart.applyOptions(getChartCustomColorsOptions())\r\n          }\r\n          break\r\n        case 'panes/SET_PANE_MARKETS':\r\n        case this.paneId + '/SET_WINDOW':\r\n          if (mutation.payload.id && mutation.payload.id !== this.paneId) {\r\n            break\r\n          }\r\n          this.prepareBuckets()\r\n          break\r\n        case this.paneId + '/SET_BUCKET_COLOR':\r\n          this.recolorBucket(mutation.payload.id, mutation.payload.value)\r\n          break\r\n        case this.paneId + '/SET_BUCKET_TYPE':\r\n          if (this._chart) {\r\n            this.reloadBucketSerie(mutation.payload.id, mutation.payload.value)\r\n          }\r\n          break\r\n        case this.paneId + '/TOGGLE_CHART':\r\n          if (mutation.payload) {\r\n            this.createChart()\r\n          } else {\r\n            this.removeChart()\r\n          }\r\n          break\r\n        case this.paneId + '/TOGGLE_BUCKET':\r\n          if (mutation.payload.value) {\r\n            this.createBucket(this.buckets[mutation.payload.id])\r\n          } else {\r\n            this.removeBucket(mutation.payload.id)\r\n          }\r\n          break\r\n        case this.paneId + '/REMOVE_BUCKET':\r\n          this.removeBucket(mutation.payload)\r\n          break\r\n        case this.paneId + '/SET_BUCKET_WINDOW':\r\n        case this.paneId + '/SET_BUCKET_INPUT':\r\n        case this.paneId + '/SET_BUCKET_PRECISION':\r\n          this.refreshBucket(mutation.payload.id)\r\n          break\r\n        case this.paneId + '/RENAME_BUCKET':\r\n          this.refreshBucketName(mutation.payload)\r\n          break\r\n      }\r\n    })\r\n\r\n    this.prepareBuckets()\r\n  }\r\n\r\n  mounted() {\r\n    if (this.enableChart) {\r\n      this.createChart()\r\n    }\r\n  }\r\n\r\n  beforeDestroy() {\r\n    if (this._feed) {\r\n      aggregatorService.off(this._feed, this.onVolume)\r\n    }\r\n\r\n    this.clearBuckets()\r\n    this.removeChart()\r\n\r\n    this._chart = null\r\n  }\r\n\r\n  async createChart() {\r\n    await this.$nextTick()\r\n\r\n    const chartOptions = getChartOptions(defaultStatsChartOptions as any)\r\n\r\n    this._chart = TV.createChart(this.$refs.chart, chartOptions)\r\n\r\n    for (const id in this._buckets) {\r\n      this._buckets[id].createSerie(this._chart)\r\n    }\r\n\r\n    this.refreshChartDimensions(0)\r\n  }\r\n\r\n  removeChart() {\r\n    if (!this._chart) {\r\n      return\r\n    }\r\n\r\n    // this.stopChartUpdate()\r\n\r\n    for (const id in this._buckets) {\r\n      this._buckets[id].removeIndicator(this._chart)\r\n    }\r\n\r\n    this._chart.remove()\r\n\r\n    this._chart = null\r\n  }\r\n\r\n  /* chartUpdate() {\r\n    if (!this._chartUpdateInterval) {\r\n      this._chartUpdateInterval = setInterval(this.chartUpdate.bind(this), 100)\r\n      return\r\n    }\r\n\r\n    for (const id in this._buckets) {\r\n      this._buckets[id].updateSerie()\r\n    }\r\n  }\r\n  stopChartUpdate() {\r\n    if (this._chartUpdateInterval) {\r\n      clearInterval(this._chartUpdateInterval)\r\n      delete this._chartUpdateInterval\r\n    }\r\n  } */\r\n  async refreshChartDimensions(debounceTime = 500) {\r\n    if (!this.enableChart) {\r\n      return\r\n    }\r\n\r\n    clearTimeout(this._refreshChartDimensionsTimeout)\r\n\r\n    this._refreshChartDimensionsTimeout = setTimeout(() => {\r\n      this._chart &&\r\n        this._chart.resize(this.$el.clientWidth, this.$el.clientHeight)\r\n    }, debounceTime)\r\n  }\r\n  prepareBuckets() {\r\n    if (this._feed) {\r\n      console.log(`[stats/${this.paneId}] unsubscribe from feed`, this._feed)\r\n      aggregatorService.off(this._feed, this.onVolume)\r\n    }\r\n\r\n    this.clearBuckets()\r\n\r\n    for (const id in this.buckets) {\r\n      this.createBucket(this.buckets[id])\r\n    }\r\n\r\n    this._feed = 'bucket-' + getBucketId(this.pane.markets)\r\n    console.log(`[stats/${this.paneId}] subscribe to feed`, this._feed)\r\n\r\n    if (this._feed.length) {\r\n      aggregatorService.on(this._feed, this.onVolume)\r\n    } else {\r\n      console.log(`[stats/${this.paneId}] error feed empty...`)\r\n    }\r\n  }\r\n  onVolume(sums) {\r\n    for (const id in this._buckets) {\r\n      this._buckets[id].onStats(sums)\r\n\r\n      if (this._buckets[id].stacks.length) {\r\n        const value = this._buckets[id].getValue()\r\n\r\n        this.$set(\r\n          this.data[id],\r\n          'value',\r\n          formatAmount(value, this._buckets[id].precision)\r\n        )\r\n      }\r\n\r\n      if (this._chart) {\r\n        this._buckets[id].updateSerie()\r\n      }\r\n    }\r\n  }\r\n\r\n  clearBuckets() {\r\n    for (const id in this._buckets) {\r\n      this.removeBucket(id)\r\n    }\r\n\r\n    this._buckets = {}\r\n  }\r\n\r\n  removeBucket(id) {\r\n    if (!this._buckets[id]) {\r\n      return\r\n    }\r\n\r\n    this._buckets[id].unbind()\r\n\r\n    if (this._chart) {\r\n      this._buckets[id].removeIndicator(this._chart)\r\n    }\r\n\r\n    this.$delete(this.data, id)\r\n\r\n    delete this._buckets[id]\r\n  }\r\n  refreshBucket(id) {\r\n    const options = this.buckets[id]\r\n\r\n    if (!options) {\r\n      return\r\n    }\r\n\r\n    this.removeBucket(id)\r\n    this.createBucket(options)\r\n  }\r\n\r\n  recolorBucket(id, color) {\r\n    if (!this._buckets[id]) {\r\n      return\r\n    }\r\n\r\n    this._buckets[id].updateColor(color)\r\n\r\n    this.$set(this.data[id], 'color', color)\r\n  }\r\n\r\n  reloadBucketSerie(id, type?: string) {\r\n    if (!this._buckets[id]) {\r\n      return\r\n    }\r\n\r\n    if (type) {\r\n      // set different serie type\r\n      this._buckets[id].type = type\r\n    }\r\n\r\n    this._buckets[id].removeIndicator(this._chart)\r\n    this._buckets[id].createSerie(this._chart)\r\n  }\r\n\r\n  createBucket(statBucket) {\r\n    if (statBucket.enabled && typeof this.data[statBucket.id] === 'undefined') {\r\n      const bucket = new Bucket(statBucket.input, statBucket, this.paneId)\r\n\r\n      if (this._chart) {\r\n        bucket.createSerie(this._chart)\r\n      }\r\n\r\n      this._buckets[statBucket.id] = bucket\r\n\r\n      this.$set(this.data, bucket.id, {\r\n        value: 0,\r\n        name: bucket.name,\r\n        color: bucket.color\r\n      })\r\n    }\r\n  }\r\n\r\n  refreshBucketName({ id, name }: { id: string; name: string }) {\r\n    const bucket = this._buckets[id]\r\n    bucket.name = name\r\n    this.$set(this.data[id], 'name', name)\r\n  }\r\n\r\n  editStat(id) {\r\n    dialogService.open(StatDialog, { paneId: this.paneId, bucketId: id })\r\n  }\r\n\r\n  onResize() {\r\n    this.refreshChartDimensions()\r\n  }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--15-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--15-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--15-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--15-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Stats.vue?vue&type=template&id=b3a3024a&\"\nimport script from \"./Stats.vue?vue&type=script&lang=ts&\"\nexport * from \"./Stats.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Stats.vue?vue&type=style&index=0&id=b3a3024a&prod&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}