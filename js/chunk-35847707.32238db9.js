(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-35847707"],{"018d":function(e,t,r){},"024c":function(e,t,r){"use strict";var n=r("9ab4"),i=r("2b0e"),a=r("2fe1");function o(e){return o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),e}function u(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function d(e){var t=m();return function(){var r,n=v(e);if(t){var i=v(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p(this,r)}}function p(e,t){if(t&&("object"===o(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var y=function(e){u(r,e);var t=d(r);function r(){return s(this,r),t.apply(this,arguments)}return l(r,[{key:"pane",get:function(){return this.$store.state.panes.panes[this.paneId]}},{key:"mounted",value:function(){var e=this;this.$el.id=this.paneId,this.refreshZoom(),this.$nextTick((function(){var t=e.$el.clientWidth;"function"===typeof e.onResize&&e.onResize(t,e.$el.clientHeight,!0)})),this.$el.addEventListener("mousedown",this.focusPane)}},{key:"beforeDestroy",value:function(){this.$el.removeEventListener("mousedown",this.focusPane),this._onStoreMutation&&this._onStoreMutation()}},{key:"refreshZoom",value:function(){this.$store.dispatch("panes/refreshZoom",this.paneId)}},{key:"focusPane",value:function(){this.$store.commit("app/SET_FOCUSED_PANE",this.paneId)}}]),r}(i["default"]);y=Object(n["a"])([Object(a["b"])({props:{paneId:{required:!0,type:String}}})],y),t["a"]=y},2231:function(e,t,r){"use strict";r("6adc")},"37d2":function(e,t,r){},"3cd6":function(e,t,r){},"474f":function(e,t,r){"use strict";r("e983")},"5aa9":function(e,t,r){"use strict";r("37d2")},"6adc":function(e,t,r){},"711c":function(e,t,r){"use strict";r("c994")},"8c91":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"pane-header hide-scrollbar pane-overlay d-flex",class:{"-loading":e.loading}},[r("div",{staticClass:"pane-header__loader"}),r("span",{staticClass:"pane-header__name ml4 mrauto",attrs:{"data-hide-header":""},on:{dblclick:e.renamePane}},[e._v(e._s(e.name))]),r("div",{staticClass:"toolbar flex-grow-1",on:{dblclick:e.maximizePane}},[e._t("default"),r("button",{staticClass:"toolbar__label min-768",attrs:{type:"button"},on:{click:e.openSearch}},[r("i",{staticClass:"icon-search"})]),e.settings?r("button",{staticClass:"toolbar__label min-768",attrs:{type:"button"},on:{click:e.openSettings}},[r("i",{staticClass:"icon-cog"})]):e._e(),r("button",{staticClass:"toolbar__label",attrs:{type:"button"},on:{click:e.toggleDropdown}},[r("i",{staticClass:"icon-more"})]),r("dropdown",{model:{value:e.paneDropdownTrigger,callback:function(t){e.paneDropdownTrigger=t},expression:"paneDropdownTrigger"}},[r("div",{staticClass:"d-flex btn-group"},[r("button",{staticClass:"btn -green",attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.changeZoom(t,-1)}}},[r("i",{staticClass:"icon-minus"})]),r("button",{staticClass:"btn -green text-monospace flex-grow-1 text-center",attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.resetZoom.apply(null,arguments)}}},[e._v(" × "+e._s(e.zoom.toFixed(2))+" ")]),r("button",{staticClass:"btn -green",attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.changeZoom(t,1)}}},[r("i",{staticClass:"icon-plus"})])]),e._t("menu"),null!==e.settings?r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.openSettings}},[r("i",{staticClass:"icon-cog"}),r("span",[e._v("Settings")])]):e._e(),r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.$store.dispatch("app/showSearch",e.paneId)}}},[r("i",{staticClass:"icon-search"}),r("span",[e._v("Sources")])]),r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.maximizePane}},[r("i",{staticClass:"icon-enlarge"}),r("span",[e._v("Maximize")])]),r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.duplicatePane}},[r("i",{staticClass:"icon-copy-paste"}),r("span",[e._v("Duplicate")])]),r("div",{staticClass:"dropdown--divider"}),r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.removePane}},[r("i",{staticClass:"icon-trash"}),r("span",[e._v("Remove")])])],2)],2)])},i=[],a=r("9ab4"),o=r("2b0e"),s=r("2fe1"),c=r("28f3"),l=r("0c01");function u(e){return u="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function h(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=d(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function d(e,t){if(e){if("string"===typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}function y(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},g(e,t)}function b(e){var t=_();return function(){var r,n=w(e);if(t){var i=w(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return I(this,r)}}function I(e,t){if(t&&("object"===u(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return k(e)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}var O=function(e){y(r,e);var t=b(r);function r(){var e;return f(this,r),e=t.apply(this,arguments),e.paneDropdownTrigger=null,e}return v(r,[{key:"zoom",get:function(){return this.$store.state.panes.panes[this.paneId].zoom||1}},{key:"type",get:function(){return this.$store.state.panes.panes[this.paneId].type}},{key:"name",get:function(){var e=this.$store.state.panes.panes[this.paneId].name,t=this.$store.state.panes.marketsListeners[this.$store.state.panes.panes[this.paneId].markets[0]];return e||(t?t.local:this.type)}},{key:"openSearch",value:function(){this.$store.dispatch("app/showSearch",this.paneId)}},{key:"changeZoom",value:function(e,t){var r=this.zoom+(e.shiftKey?.0625:.125)*t;this.$store.dispatch("panes/setZoom",{id:this.paneId,zoom:r}),this.$emit("zoom",r)}},{key:"resetZoom",value:function(){this.$store.dispatch("panes/setZoom",{id:this.paneId,zoom:1}),this.$emit("zoom",1)}},{key:"removePane",value:async function(){await l["a"].confirm('Delete pane "'.concat(this.paneId,'" ?'))&&this.$store.dispatch("panes/removePane",this.paneId)}},{key:"duplicatePane",value:function(){this.$store.dispatch("panes/duplicatePane",this.paneId)}},{key:"highlightPane",value:function(e){this.$el.parentElement.parentElement.classList[e?"add":"remove"]("-highlight")}},{key:"maximizePane",value:function(e){if("dblclick"!==e.type||e.currentTarget===e.target||"toolbar__spacer"===e.target.className){var t,r=this.$el.parentElement.parentElement,n=r.classList.toggle("-maximized"),i=Object(c["o"])(r),a=h(i);try{for(a.s();!(t=a.n()).done;){var o=t.value;o.getAttribute("type")&&(o.classList.remove("-maximized"),o.style.display=n?"none":"block")}}catch(l){a.e(l)}finally{a.f()}var s=Event;window.dispatchEvent(new s("resize"))}}},{key:"renamePane",value:async function(){var e=await l["a"].prompt({action:"Rename",input:this.name});e!==this.name&&this.$store.commit("panes/SET_PANE_NAME",{id:this.paneId,name:e})}},{key:"toggleDropdown",value:function(e){this.paneDropdownTrigger?this.paneDropdownTrigger=null:this.paneDropdownTrigger=e.currentTarget}},{key:"openSettings",value:async function(){this.settings&&l["a"].open((await this.settings()).default,{paneId:this.paneId})}}]),r}(o["default"]);O=Object(a["a"])([Object(s["b"])({name:"PaneHeader",props:{paneId:{type:String},settings:{type:Function,default:null},loading:{type:Boolean,default:!1}}})],O);var C=O,S=C,R=r("2877"),x=Object(R["a"])(S,n,i,!1,null,null,null);t["a"]=x.exports},"9feb":function(e,t,r){},aa6c:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pane-chart"},[n("pane-header",{attrs:{paneId:e.paneId,settings:function(){return r.e("chunk-35bede6e").then(r.bind(null,"be9d"))}},scopedSlots:e._u([{key:"menu",fn:function(){return[n("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.toggleLayout}},[n("i",{staticClass:"icon-resize-height"}),n("span",[e._v("Arrange")])]),n("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.resetChart}},[n("i",{staticClass:"icon-refresh"}),n("span",[e._v("Restart")])]),n("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.takeScreenshot}},[n("i",{staticClass:"icon-add-photo"}),n("span",[e._v("Snapshot")])]),n("div",{staticClass:"dropdown-divider"})]},proxy:!0}])},[e._l(e.favoriteTimeframes,(function(t,r){return n("button",{key:r,staticClass:"toolbar__label timeframe",attrs:{title:"Maintain shift key to change timeframe on all panes"},on:{click:function(t){return e.changeTimeframe(r)}}},[n("span",[e._v(e._s(t))])])})),n("button",{staticClass:"-arrow toolbar__label",on:{click:e.toggleTimeframeDropdown}},[e._v(" "+e._s(e.timeframeForHuman)+" ")]),n("dropdown",{model:{value:e.timeframeDropdownTrigger,callback:function(t){e.timeframeDropdownTrigger=t},expression:"timeframeDropdownTrigger"}},[n("timeframe-dropdown",{staticClass:"timeframe-dropdown",attrs:{"pane-id":e.paneId},on:{timeframe:function(t){return e.changeTimeframe(t)}}})],1)],2),n("div",{staticClass:"chart-overlay hide-scrollbar"},[n("indicators-overlay",{attrs:{"pane-id":e.paneId},on:{input:function(t){t?e.bindLegend():e.unbindLegend()}},model:{value:e.showIndicatorsOverlay,callback:function(t){e.showIndicatorsOverlay=t},expression:"showIndicatorsOverlay"}}),n("markets-overlay",{attrs:{"pane-id":e.paneId}})],1),n("div",{ref:"chartContainer",staticClass:"chart__container"},[e.layouting?n("chart-layout",{attrs:{"pane-id":e.paneId,layouting:e.layouting,axis:e.axis}}):e._e()],1)],1)},i=[],a=r("9ab4"),o=r("60a3"),s=r("9613"),c=r("28f3"),l=r("ecab"),u=r("0613");function h(e){e.state.open=e.state.close,e.state.high=e.state.close,e.state.low=e.state.close}function d(e){e.state.point={open:e.state.open,high:e.state.high,low:e.state.low,close:e.state.close}}function p(e){e.state.open=null,e.state.high=null,e.state.low=null}function f(e){e.state.points.push(e.state.output),e.state.count++,e.state.count>e.length-1&&(e.state.points.shift(),e.state.count--)}function m(e){e.state.points.push(e.state.output),e.state.sum+=e.state.output,e.state.count++,e.state.count>e.length-1&&(e.state.sum-=e.state.points.shift(),e.state.count--)}function v(e){e.state.lows.push(e.state.low),e.state.highs.push(e.state.high),e.state.count++,e.state.count>e.length-1&&(e.state.lows.shift(),e.state.highs.shift(),e.state.count--)}var y={avg_ohlc:{state:{open:null,high:null,low:null,close:null},next:h,update:function(e,t){var r,n=0,i=!1,a=0,o=0,s=0;for(var c in null===e.open&&(i=!0,r=0),t.sources)t.sources[c].active&&null!==t.sources[c].open&&(i&&(r+=t.sources[c].open),a+=t.sources[c].high,o+=t.sources[c].low,s+=t.sources[c].close,n++);return n?(i&&(e.open=r/n),e.high=Math.max(e.open,a/n),e.low=Math.min(e.open,o/n),e.close=s/n,{time:t.localTimestamp,open:e.open,high:e.high,low:e.low,close:e.close}):{time:t.localTimestamp}}},avg_heikinashi:{state:{open:null,high:null,low:null,close:null},next:d,update:function(e,t){var r=0;for(var n in e.open=0,e.high=0,e.low=0,e.close=0,t.sources)t.sources[n].active&&null!==t.sources[n].open&&(e.open+=t.sources[n].open,e.high+=t.sources[n].high,e.low+=t.sources[n].low,e.close+=t.sources[n].close,r++);return r||(r=1),e.high/=r,e.low/=r,e.open/=r,e.close=(e.open+e.high+e.low+e.close/r)/4,"undefined"!==typeof e.point?e.open=(e.point.open+e.point.close)/2:e.open=(e.open+e.close)/2,e.low=Math.min(e.open,e.low,e.close),e.high=Math.max(e.open,e.high,e.close),{time:t.localTimestamp,open:e.open,high:e.high,low:e.low,close:e.close}}},avg_ohlc_with_gaps:{state:{open:null,high:null,low:null,close:null},next:p,update:function(e,t){var r=0,n=0,i=0,a=0,o=0;for(var s in t.sources)t.sources[s].active&&null!==t.sources[s].open&&(n+=t.sources[s].open,i+=t.sources[s].high,a+=t.sources[s].low,o+=t.sources[s].close,r++);return r?(e.open=n/r,e.high=Math.max(null===e.high?-1/0:e.high,i/r),e.low=Math.min(null===e.low?1/0:e.low,a/r),e.close=o/r,{time:t.localTimestamp,open:e.open,high:e.high,low:e.low,close:e.close}):{time:t.localTimestamp}}},avg_close:{update:function(e,t){var r=0;for(var n in e.close=0,t.sources)null!==t.sources[n].open&&(e.close+=t.sources[n].close,r++);return r||(r=1),e.close/=r,e.close}},ohlc:{args:[{instruction:"renderer.localTimestamp",injected:!0}],next:h,update:function(e,t,r){return"undefined"===typeof e.open&&(e.open=r,e.high=r,e.low=r),e.high=Math.max(e.high,r),e.low=Math.min(e.low,r),e.close=r,{time:t,open:e.open,high:e.high,low:e.low,close:e.close}}},cum_ohlc:{args:[{instruction:"renderer.localTimestamp",injected:!0}],next:h,update:function(e,t,r){return"undefined"===typeof e.open?(e.open=r,e.high=r,e.low=r):r=e.open+r,e.high=Math.max(e.high,r),e.low=Math.min(e.low,r),e.close=r,{time:t,open:e.open,high:e.high,low:e.low,close:e.close}}},cum:{next:h,update:function(e,t){return"undefined"===typeof e.open&&(e.open=t),e.close=e.open+t,e.close}},pivot_high:{args:[{},{length:!0},{length:!0}],state:{points:[],count:0},next:f,update:function(e,t,r,n){e.output=t;var i=e.points[r];"undefined"===typeof i&&(i=t);for(var a=r+n,o=0;o<=a;o++){var s=o<a-1?e.points[o]:t;if(s>i)return null}return i}},pivot_low:{args:[{},{length:!0},{length:!0}],state:{points:[],count:0},next:f,update:function(e,t,r,n){e.output=t;var i=e.points[r];"undefined"===typeof i&&(i=t);for(var a=r+n,o=0;o<=a;o++){var s=o<a-1?e.points[o]:t;if(s<i)return null}return i}},highest:{args:[{},{length:!0}],state:{points:[],count:0},next:f,update:function(e,t,r){return e.output=t,e.count>1?Math.max.apply(null,e.points):t}},lowest:{args:[{},{length:!0}],state:{points:[],count:0},next:f,update:function(e,t,r){return e.output=t,e.count>1?Math.min.apply(null,e.points):t}},linreg:{args:[{},{length:!0}],state:{points:[],count:0},next:f,update:function(e,t,r){if(e.output=t,e.count<1)return null;for(var n=0,i=0,a=0,o=0,s=0,c=0,l=0;l<=e.points.length;l++){var u=l===e.points.length?t:e.points[l];i=l+1,a+=i,o+=u,s+=i*i,c+=u*i,n++}var h=(n*c-a*o)/(n*s-a*a),d=o/n,p=d-h*a/r+h;return p+h*(n-1)}},avg:{update:function(e,t){for(var r=0,n=0,i=0;i<t.length;i++)null!==t[i]&&(n+=t[i],r++);return n/r}},sum:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:m,update:function(e,t){return e.output=t,e.sum+t}},sma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:m,update:function(e,t){var r=(e.sum+t)/(e.count+1);return e.output=t,r}},cma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:m,update:function(e,t){return e.output=(e.sum+t)/(e.count+1),e.output}},ema:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:m,update:function(e,t,r){var n=2/(r+1);if(e.count){var i=e.points[e.points.length-1];e.output=(t-i)*n+i}else e.output=t;return e.output}},last:{args:[{},{length:!0}],state:{points:[],count:0},next:f,update:function(e,t){return e.output=t,e.count?e.points[0]:t}},rma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:m,update:function(e,t,r){var n=1/r;if(e.count){var i=e.points[e.points.length-1];e.output=n*t+(1-n)*i}else e.output=1;return e.output}},merge_overlapping_intervals:{update:function(e,t){return t.sort((function(e,t){return e[0]-t[0]})).reduce((function(e,t){var r=e.length-1,n=e[r],i=n[1],a=t[0];return i>=a?e[r][1]=Math.max(i,t[1]):e.push(t),e}),[t[0]])}},reverse_intervals:{update:function(e,t){return t.reduce((function(e,t,r,n){return r>0&&(e[r-1][1]=t[0]),r<n.length-1&&e.push([t[1]]),e}),[])}},stoch:{args:[null,null,null,{length:!0}],state:{count:0,lows:[],highs:[]},next:v,update:function(e,t,r,n){e.low=n;var i=e.count>0?Math.min(Math.min.apply(null,e.lows),n):n;e.high=r;var a=e.count>0?Math.max(Math.max.apply(null,e.highs),r):r;return e.output=100*(t-i)/(a-i||1),e.output}}},g=r("8192");function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e,t,r){return t&&I(e.prototype,t),r&&I(e,r),e}var _=function(){function e(){b(this,e),this.chunks=[],this.cacheRange={from:null,to:null},this.initialPrices={}}return k(e,[{key:"saveChunk",value:function(e){var t;if(!this.chunks.length||this.chunks[this.chunks.length-1].to<e.from)t=this.chunks.push(e)-1;else{if(!(this.chunks[0].from>e.to))return;this.chunks.unshift(e),t=0}return 0===t&&(this.cacheRange.from=e.from),t===this.chunks.length-1&&(this.cacheRange.to=e.to),e}},{key:"clear",value:function(){this.chunks.splice(0,this.chunks.length),this.cacheRange.from=this.cacheRange.to=null,this.initialPrices={}}},{key:"trim",value:function(e){if(this.chunks.length){var t=!1;while(this.chunks[0]&&this.chunks[0].to<e)this.chunks.splice(0,1),t=!0;return this.cacheRange.from=this.chunks[0].from,t}}}]),e}();function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){C(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S(e,t){return T(e)||x(e,t)||P(e,t)||R()}function R(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function x(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done);o=!0)if(a.push(n.value),t&&a.length===t)break}catch(c){s=!0,i=c}finally{try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}return a}}function T(e){if(Array.isArray(e))return e}function E(e){return E="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function j(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=P(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function P(e,t){if(e){if("string"===typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function L(e,t,r){return t&&$(e.prototype,t),r&&$(e,r),e}var D=/series\[[a-zA-Z0-9+\-$ ]+\]\.update\(/,z="vars",G="fns",B={candlestick:"ohlc",bar:"ohlc",line:"number",histogram:"number",area:"number",cloudarea:"range",brokenarea:"range",baseline:"number"},N=function(){function e(){A(this,e)}return L(e,[{key:"build",value:function(e,t,r){this.paneId=r,this.indicatorId=e.id,this.serieIndicatorsMap=t,this.markets=[];var n,i=j(u["b"].state.panes.panes[this.paneId].markets);try{for(i.s();!(n=i.n()).done;){var a=n.value;-1===this.markets.indexOf(a)&&this.markets.push(a)}}catch(f){i.e(f)}finally{i.f()}var o,s=this.parse(e.script),c=j(s.functions);try{for(c.s();!(o=c.n()).done;){var l=o.value;this.determineFunctionState(l)}}catch(f){c.e(f)}finally{c.f()}var h,d=j(s.variables);try{for(d.s();!(h=d.n()).done;){var p=h.value;this.determineVariableState(p)}}catch(f){d.e(f)}finally{d.f()}return{output:s.output,silentOutput:s.silentOutput,functions:s.functions,variables:s.variables,references:s.references,markets:s.markets,plots:s.plots}}},{key:"normalizeInput",value:function(e,t){e=e.replace(/([^.])?\b(indicatorId)\b/gi,"$1'".concat(this.indicatorId,"'")),e=e.replace(/([^.])?\b(bar)\b/gi,"$1renderer"),e=e.replace(/([^.]|^)\b(vbuy|vsell|cbuy|csell|lbuy|lsell)\b/gi,"$1renderer.bar.$2"),e=e.replace(/([^.]|^)\b(time)\b([^:])/gi,"$1renderer.localTimestamp$3"),e=e.replace(/(\n|^)\s*?\/\/.*/g,"");var r=/'([^']*)'|"([^"]*)"/,n=null,i=0;do{if(n=r.exec(e)){var a=t.indexOf(n[0]);-1===a&&(a=t.push(n[0])-1),e=e.slice(0,n.index)+"#STRING_"+a+"#"+e.slice(n.index+n[0].length)}}while(n&&++i<1e3);var o,s=/\(/g;i=0;do{if(o=s.exec(e)){var l=Object(c["g"])(e,o.index,/\(|{|\[/,/\)|}|\]/);if(-1!==l){var u=e.slice(o.index+1,l).replace(/\n/g," ");e=e.slice(0,o.index)+e.slice(o.index,o.index+1)+u.replace(/\n/g,"")+e.slice(l,l+1)+"\n"+e.slice(l+1,e.length),s.lastIndex=l}}}while(o&&++i<1e3);return e}},{key:"determineFunctionState",value:function(e){if(E(y[e.name])&&"object"===E(y[e.name].state))for(var t in e.state={},y[e.name].state)try{e.state[t]=JSON.parse(JSON.stringify(y[e.name].state[t]))}catch(r){e.state[t]=y[e.name].state[t]}else e.state={}}},{key:"determineVariableState",value:function(e){e.length>1?e.state=[0]:e.state=0}},{key:"getSilentOutput",value:function(e){var t=e,r=null,n=0;do{if(r=D.exec(t)){var i=r.index+r[0].length-1,a=Object(c["g"])(t,i);t=t.replace(r[0]+t.slice(i+1,a+1),1)}}while(r&&++n<1e3);return t}},{key:"parse",value:function(e){var t=[],r=[],n=[],i={},a=[],o=[],s=this.normalizeInput(e,o);s=this.parseVariables(s,r),s=this.parseMarkets(s,i);for(var c=0;c<o.length;c++)s=s.replace(new RegExp("#STRING_"+c+"#","g"),o[c].replace(/\$/g,"$$$"));s=this.parseFunctions(s,t,n),s=this.parseReferences(s,a,n),s=this.formatOutput(s);var l=this.getSilentOutput(s);return{output:s,silentOutput:l,functions:t,variables:r,plots:n,markets:i,references:a}}},{key:"formatOutput",value:function(e){var t,r=/\(|{|\[/g,n=0;do{if(t=r.exec(e)){var i="("===t[0],a=Object(c["g"])(e,t.index,/\(|{|\[/,/\)|}|\]/),o=e.slice(t.index+1,a).replace(/\n/g," ");/if|for|else/.test(e.slice(t.index-2,2))&&(e=e.slice(0,t.index)+e.slice(t.index,t.index+1)+o+e.slice(a,a+1)+(i?"\n":"")+e.slice(a+1,e.length)),r.lastIndex=a}}while(t&&++n<1e3);for(var s=e.trim().split(/\n/),l=0;l<s.length;l++){var u=s[l].match(/renderer.sources\['[\w/:_-]+']\.\w+/g);u&&1===u.length&&(s[l]="if (".concat(u[0],") {\n          ").concat(s[l],"\n        }"))}return s.join("\n").replace(/\n\n/g,"\n")}},{key:"parseVariables",value:function(e,t){var r=/(?:^|\n)\s*((?:var )?[a-zA-Z0-9_]+)\(?(\d*)\)?\s*=\s*([^\n;,]*)?/,n=null,i=0,a=[];do{if(n=r.exec(e)){var o=n[1],s=/^var/.test(o);if(-1!==a.indexOf(o)||s){s&&(o=o.replace(/var\s*/,""),e=e.replace(n[0],"\nvar "+o+"="+n[3]),a.push(o)),e=e.replace(new RegExp("([^.$]|^)\\b("+o+")\\b(?!:)(?!\\()(?!\\$)","ig"),"$1".concat(o,"$"));continue}var c=+n[2]||1;e=e.replace(new RegExp("([^.]|^)\\b("+o+")\\b(?!:)","ig"),"$1".concat(z,"[").concat(t.length,"]"));var l={length:c};t.push(l),e=e.replace(new RegExp("(".concat(z,"\\[").concat(t.length-1,"\\])\\(").concat(l.length,"\\)\\s*=\\s*")),"$1=")}}while(n&&++i<1e3);return e=this.determineVariablesType(e,t),e}},{key:"parseSerie",value:function(e,t,r){for(var n=t[1].replace(/^plot/,""),i=Object(c["g"])(e,t.index+t[1].length),a=e.slice(t.index+t[1].length+1,i),o=t[1]+"("+a+")",s=Object(c["t"])(a),u={},h=1;h<s.length;h++)try{var d=s[h].match(/^(\w+)\s*=(.*)/),p=S(d,3),f=p[1],m=p[2];if(!f||!m.length)continue;var v=m.trim();try{v=JSON.parse(v)}catch(x){}u[f.trim()]=v,s.splice(h,1),h--}catch(x){continue}var y="renderer.indicators['".concat(this.indicatorId,"'].series[").concat(r.length,"]"),g="".concat(y," = "),b=B[n],I="renderer.localTimestamp";u.offset&&(I+="+renderer.timeframe*".concat(u.offset));var k=/{/.test(s[0])&&/}/.test(s[0]),_=/^[\w_$]+\$/.test(s[0]);if(1===s.length&&(k||"line"!==n&&_))g+=s[0];else if("ohlc"===b)if(4===s.length)g+="{ time: ".concat(I,", open: ").concat(s[0],", high: ").concat(s[1],", low: ").concat(s[2],", close: ").concat(s[3]," }");else{if(1!==s.length)throw new Error("Invalid input for function ".concat(t[1],", expected a ohlc object or 4 number"));/^[A-Z_]+:\w+/.test(s[0])?g+="".concat(s[0],".close === null ? { time: ").concat(I," } : { time: ").concat(I,", open: ").concat(s[0],".open, high: ").concat(s[0],".high, low: ").concat(s[0],".low, close: ").concat(s[0],".close }"):g+=s[0]}else if("range"===b){if(2!==s.length)throw new Error("Invalid input for function ".concat(t[1],", expected 2 arguments (lowerValue and higherValue)"));g+="{ time: ".concat(I,", lowerValue: ").concat(s[0],", higherValue: ").concat(s[1]," }")}else if("number"===b){if(1!==s.length)throw new Error("Invalid input for function ".concat(t[1],", expected 1 value (number)"));g+="{ time: ".concat(I,", value: ").concat(s[0]," }")}var w,O="series[".concat(r.length,"].update(renderer.indicators['").concat(this.indicatorId,"'].series[").concat(r.length,"])"),C=g+",";"histogram"===n?C+=y+".value&&":"line"===n?C+=y+".value !== null&&":"cloudarea"!==n&&"brokenarea"!==n||(C+=y+".lowerValue !== null&&"),C+=O,e=e.replace(o,C),"string"===typeof u.id&&u.id.length?(w=u.id,delete u.id):w=0===r.length?this.indicatorId:Object(c["v"])(8);var R=Object.keys(this.serieIndicatorsMap).concat(r.map((function(e){return e.id})));return r.push({id:Object(c["y"])(w,R),type:l["i"][n]||n,expectedInput:b,options:u}),e}},{key:"parseFunctions",value:function(e,t,r){var n=new RegExp("([a-zA-Z0_9_]+)\\(","g"),i=null,a=0;do{if(i=n.exec(e)){var o=i[1],s=Object.prototype.hasOwnProperty.call(Math,o),l=B[o.replace(/^plot/,"")],u="."===e[i.index-1];if(s||l||u){n.lastIndex=i.index+i[0].length,"string"===typeof l&&(e=this.parseSerie(e,i,r));continue}var h=y[o];if(!h){if(/for|if|rgba/i.test(o)){n.lastIndex=i.index+i[0].length;continue}throw new Error("Function ".concat(o," doesn't exists"))}for(var d={name:o,args:[]},p=0,f=i.index,m=Object(c["g"])(e,f+i[1].length),v=Object(c["t"])(e.slice(f+i[1].length+1,m)),g=(h.args?h.args.length:0)+v.length,b=0;b<g;b++){var I=h.args&&h.args[b]?h.args[b]:{},k=O({},I);if(I.injected)p++,d.args.push(k);else{g--;var _=v[b-p];"undefined"!==typeof _&&(k.instruction=_),d.args.push(k)}}e="".concat(e.slice(0,f),"utils.").concat(o,".update(").concat(G,"[").concat(t.length,"].state,").concat(d.args.map((function(e){return e.instruction})).join(","),")").concat(e.slice(m+1,e.length)),t.push(d)}}while(i&&++a<1e3);return e}},{key:"parseMarkets",value:function(e,t){var r=/\b([A-Z_]{3,}:[a-zA-Z0-9/_-]{5,})(:[\w]{4,})?\.?([a-z]{3,})?\b/g,n=null,i=0;do{if(n=r.exec(e)){var a=n[1]+(n[2]?n[2]:""),o=n[3];t[a]||(t[a]=[]),o&&-1===t[a].indexOf(o)&&t[a].push(o);var s="renderer.sources['".concat(a,"']").concat(o?"."+o:"");r.lastIndex=n.index+s.length,e=e.slice(0,n.index)+s+e.slice(n.index+n[0].length)}}while(n&&++i<1e3);return e}},{key:"parseReferences",value:function(e,t,r){var n=this,i=new RegExp("\\$(\\w+[a-z_\\-0-9]+)\\b"),a=null,o=0;do{if(a=i.exec(e)){var s=a[1];try{(function(){var i=n.getSeriePath(s,r),a=S(i,2),o=a[0],c=a[1];t.find((function(e){return e.indicatorId===o&&e.plotIndex===c}))||t.push({indicatorId:o,serieId:s,plotIndex:c}),e=e.replace(new RegExp("\\$("+s+")\\b","ig"),"renderer.indicators['".concat(o,"'].series[").concat(c,"]"))})()}catch(c){throw{message:'The serie "'.concat(s,'" was not found in the current indicators'),status:"indicator-required",serieId:s}}}}while(a&&++o<1e3);return e}},{key:"getSeriePath",value:function(e,t){var r,n,i=t.find((function(t){return t.id===e||t.id.replace(/\W/g,"")===e.replace(/\W/g,"")}));if(i&&(r=this.indicatorId,n=t.indexOf(i)),!r&&this.serieIndicatorsMap[e]){var a=this.serieIndicatorsMap[e];r=a.indicatorId,n=a.plotIndex}if(r||-1===Object.values(this.serieIndicatorsMap).map((function(e){return e.indicatorId})).indexOf(e)||(r=e,n=0),r)return[r,n]}},{key:"determineVariablesType",value:function(e,t){var r,n=j(t);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=t.indexOf(i),o=new RegExp("".concat(z,"\\[").concat(a,"\\](?:\\[(\\d+)\\])?"),"g"),s=null,c=0;do{if(s=o.exec(e)){var l=s[1],u=s.index+s[0].length;if("undefined"===typeof l){var h="["===e[u];e=e.substring(0,u)+".state"+(h?"":"[0]")+e.substring(u)}else{var d=e.substring(0,s.index),p="".concat(z,"[").concat(a,"].state[Math.min(").concat(z,"[").concat(a,"].state.length-1,").concat(l,")]"),f=e.substring(s.index+s[0].length);e="".concat(d).concat(p).concat(f),o.lastIndex=d.length+p.length}i.length=Math.max(i.length,(+l||0)+1)}}while(s&&++c<1e3);if(!i.length)throw new Error("Unexpected no length on var");1===i.length&&(e=e.replace(new RegExp("".concat(z,"\\[").concat(a,"\\]\\.state\\[\\d+\\]"),"g"),"".concat(z,"[").concat(a,"].state"))),e=e.replace(new RegExp("#".concat(z,"\\[").concat(a,"\\]\\.state\\[\\d+\\]"),"g"),"".concat(z,"[").concat(a,"].state"))}}catch(m){n.e(m)}finally{n.f()}return e}},{key:"getAdapter",value:function(e){return function(){return new Function("renderer",G,z,"series","options","utils",'"use strict"; '+e)}()}},{key:"getRendererIndicatorData",value:function(e){var t=JSON.parse(JSON.stringify(e.model)),r=t.functions,n=t.variables,i=t.plots;e.options.minLength=0;var a,o=j(r);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.length=0;for(var c=0;c<s.args.length;c++)if("undefined"!==typeof s.args[c].instruction&&""!==s.args[c].instruction)try{s.args[c].instruction=new Function("options","'use strict'; return ".concat(s.args[c].instruction))(e.options),s.args[c].length&&!isNaN(s.args[c].instruction)&&(s.length+=s.args[c].instruction)}catch(p){}e.options.minLength=Math.max(e.options.minLength,s.length)}}catch(f){o.e(f)}finally{o.f()}var l,u=[],h=j(i);try{for(h.s();!(l=h.n()).done;){var d=l.value;u.push(this.getCustomPlotOptions(e,d))}}catch(f){h.e(f)}finally{h.f()}return{canRender:e.options.minLength<=1,series:[],functions:r,variables:n,plotsOptions:u,minLength:e.options.minLength}}},{key:"getCustomPlotOptions",value:function(e,t){var r={};for(var n in t.options)try{r[n]=new Function("options","'use strict'; return ".concat(t.options[n]))(e.options)}catch(i){r[n]=t.options[n]}return r}}]),e}(),F=r("0c01"),q=r("d951"),H=r("a914"),V=r("be31"),W=r("8766"),U=r("06c2"),Z=r("4902");function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){te(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function J(e){return ee(e)||X(e)||se(e)||Y()}function Y(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function X(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function ee(e){if(Array.isArray(e))return ce(e)}function te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function re(e,t){return ae(e)||ie(e,t)||se(e,t)||ne()}function ne(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ie(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done);o=!0)if(a.push(n.value),t&&a.length===t)break}catch(c){s=!0,i=c}finally{try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}return a}}function ae(e){if(Array.isArray(e))return e}function oe(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=se(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function se(e,t){if(e){if("string"===typeof e)return ce(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ce(e,t):void 0}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ue(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function he(e,t,r){return t&&ue(e.prototype,t),r&&ue(e,r),e}var de=function(){function e(t){le(this,e),this.loadedIndicators=[],this.renderedRange={from:null,to:null},this.markets={},this.alerts={},this.timezoneOffset=0,this.fillGapsWithEmpty=!0,this.propagateInitialPrices=!0,this.priceScales=[],this.queuedTrades=[],this.seriesIndicatorsMap={},this._queueHandler=this.releaseQueue.bind(this),this._refreshDecimalsHandler=this.refreshAutoDecimals.bind(this),this.paneId=t,this.chartCache=new _,this.serieBuilder=new N,this.setTimeframe(u["b"].state[this.paneId].timeframe),this.setTimezoneOffset(u["b"].state.settings.timezoneOffset),this.refreshMarkets(),H["a"].on("decimals",this._refreshDecimalsHandler),this.fillGapsWithEmpty=Boolean(u["b"].state[this.paneId].fillGapsWithEmpty)}return he(e,[{key:"refreshMarkets",value:async function(){if(u["b"].state.app.isExchangesReady)this._promiseOfMarkets&&(this._promiseOfMarkets=null);else{if(this._promiseOfMarkets)return this._promiseOfMarkets;this._promiseOfMarkets=Object(q["e"])((function(e){return e.app.isExchangesReady})).then(this.refreshMarkets.bind(this))}var e,t=u["b"].state.panes.panes[this.paneId].markets,r=u["b"].state.app.historicalMarkets,n=u["b"].state.settings.normalizeWatermarks,i=[],a={},o=oe(t);try{for(o.s();!(e=o.n()).done;){var s=e.value,c=s.split(":"),l=re(c,1),h=l[0],d=u["b"].state.panes.marketsListeners[s],p=s;d&&(p=Object(U["o"])(d.local)),a[s]={active:u["b"].state.exchanges[h]&&!u["b"].state.exchanges[h].disabled&&!u["b"].state[this.paneId].hiddenMarkets[s],index:p,historical:-1!==r.indexOf(s)},a[s].active&&-1===i.indexOf(p)&&i.push((!n&&d?d.exchange+":":"")+p)}}catch(f){o.e(f)}finally{o.f()}this.markets=a,u["b"].state.app.isExchangesReady&&await this.retrieveAlerts(),this.updateWatermark(i),this.resetPriceScales()}},{key:"setTimeframe",value:function(e){/t$/.test(e)?this.type="tick":this.type="time",this.timeframe=parseFloat(e),this.isOddTimeframe=Object(c["r"])(this.timeframe),this.updateWatermark()}},{key:"setTimezoneOffset",value:function(e){var t=this.timezoneOffset;this.timezoneOffset=e/1e3;var r=this.timezoneOffset-t;this.activeRenderer&&(this.activeRenderer.localTimestamp+=r)}},{key:"createChart",value:function(e){var t=Object(l["f"])(l["a"]);u["b"].state[this.paneId].showVerticalGridlines&&(t.grid.vertLines.visible=u["b"].state[this.paneId].showVerticalGridlines,t.grid.vertLines.color=u["b"].state[this.paneId].verticalGridlinesColor),u["b"].state[this.paneId].showHorizontalGridlines&&(t.grid.horzLines.visible=u["b"].state[this.paneId].showHorizontalGridlines,t.grid.horzLines.color=u["b"].state[this.paneId].horizontalGridlinesColor),u["b"].state[this.paneId].showWatermark&&(t.watermark.visible=u["b"].state[this.paneId].showWatermark,t.watermark.color=u["b"].state[this.paneId].watermarkColor);var r=u["b"].state[this.paneId].barSpacing;r&&(t.timeScale.barSpacing=u["b"].state[this.paneId].barSpacing,t.timeScale.rightOffset=Math.ceil(.05*e.clientWidth/t.timeScale.barSpacing)),this.chartInstance=g["b"](e,t),this.chartElement=e,this.addEnabledSeries(),this.updateWatermark(),this.updateFontSize()}},{key:"removeChart",value:function(){if(this.chartInstance){while(this.loadedIndicators.length)this.removeIndicator(this.loadedIndicators[0]);this.chartInstance.remove(),this.priceScales.splice(0,this.priceScales.length),this.chartInstance=null}}},{key:"getLoadedIndicator",value:function(e){for(var t=0;t<this.loadedIndicators.length;t++)if(this.loadedIndicators[t].id===e)return this.loadedIndicators[t]}},{key:"setIndicatorOption",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.getLoadedIndicator(e);if(i&&(i.options[t]=r,!n))if("visible"!==t){"priceFormat"===t&&r.auto&&this.refreshAutoDecimals(e);for(var a=0;a<i.apis.length;a++)"priceFormat"!==t||r.auto||(i.apis[a].precision=r.precision),i.apis[a].applyOptions(te({},t,r));this.optionRequiresRedraw(t)&&this.redrawIndicator(e)}else this.toggleIndicatorVisibility(i,r)}},{key:"toggleIndicatorVisibility",value:function(e,t){t?(e.model?this.createIndicatorSeries(e):this.prepareIndicator(e),this.redrawIndicator(e.id)):this.removeIndicatorSeries(e)}},{key:"optionRequiresRedraw",value:function(e){var t=/upColor|downColor|wickDownColor|wickUpColor|borderDownColor|borderUpColor|compositeOperation/i;if(t.test(e))return!0;var r=/color|priceFormat|linetype|width|style/i;return!r.test(e)}},{key:"rebuildIndicator",value:function(e){this.removeIndicator(this.getLoadedIndicator(e)),this.addIndicator(e)&&this.redrawIndicator(e)}},{key:"getReferencedIndicators",value:function(e){return e.model.references.slice().map((function(e){return e.indicatorId})).filter((function(e,t,r){return r.indexOf(e)===t}))}},{key:"redrawIndicator",value:function(e){var t=this.getLoadedIndicator(e);this.clearIndicatorSeries(t);var r,n=[],i=oe(this.chartCache.chunks);try{for(i.s();!(r=i.n()).done;){var a=r.value;n=n.concat(a.bars)}}catch(s){i.e(s)}finally{i.f()}var o=this.getReferencedIndicators(t);this.ensureIndicatorVisible(o),this.renderBars(n,[].concat(J(o),[e]))}},{key:"ensureIndicatorVisible",value:function(e){var t,r=oe(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.loadedIndicators[n]&&!1===this.loadedIndicators[n].options.visible&&this.setIndicatorOption(n,"visible",!0,!0)}}catch(i){r.e(i)}finally{r.f()}}},{key:"getVisibleRange",value:function(){var e=this.chartInstance.timeScale().getVisibleRange();return e?(e.from-=this.timezoneOffset,e.to-=this.timezoneOffset,e):e}},{key:"addEnabledSeries",value:function(){for(var e in u["b"].state[this.paneId].indicators)this.addIndicator(e)}},{key:"updateWatermark",value:function(e){if(e)if(u["b"].state.settings.normalizeWatermarks)this.watermark=e.join(" | ");else{var t=e.length-3;this.watermark=e.slice(0,3).join(" + ")+(t>0?" + "+t+" other"+(t>1?"s":""):"")}this.chartInstance&&this.chartInstance.applyOptions({watermark:{text:"    ".concat(this.watermark+" | "+Object(c["p"])(u["b"].state[this.paneId].timeframe),"    "),visible:u["b"].state[this.paneId].showWatermark,color:u["b"].state[this.paneId].watermarkColor}})}},{key:"updateFontSize",value:function(){var e=u["b"].state.panes.panes[this.paneId].zoom||1,t=u["b"].state.settings.normalizeWatermarks?72:48;this.chartInstance.applyOptions({layout:{fontSize:14*e},watermark:{fontSize:t*e}})}},{key:"addIndicator",value:function(e,t){if(this.getLoadedIndicator(e))return!0;if(t>5)return!1;var r=u["b"].state[this.paneId].indicators[e],n=r.options||{},i={id:e,options:JSON.parse(JSON.stringify(n)),script:r.script,model:null,adapter:null,silentAdapter:null,apis:[]};try{this.prepareIndicator(i)}catch(a){return"indicator-required"!==a.status||this.resolveDependency(i.id,a.serieId,t||0)||F["a"].confirm({message:'"'.concat(i.id,'" indicator need the "').concat(a.serieId,'" serie but that one WAS NOT found anywhere in the current indicators.'),ok:"I see",cancel:!1}),a.status||F["a"].isDialogOpened("indicator")||F["a"].openIndicator(this.paneId,i.id),!1}return this.loadedIndicators.push(i),!0}},{key:"resolveDependency",value:function(e,t,r){var n=u["b"].state[this.paneId].indicators;for(var i in n)if(i!==e&&n[i].series&&-1!==n[i].series.indexOf(t))return!!this.addIndicator(i,r+1)&&(0===r&&this.addIndicator(e,r+1),!0);return!(!n[t]||!this.addIndicator(n[t].id,r+1))&&(0===r&&this.addIndicator(e,r+1),!0)}},{key:"prepareIndicator",value:function(e){try{var t=this.serieBuilder.build(e,this.seriesIndicatorsMap,this.paneId);u["b"].state[this.paneId].indicatorsErrors[e.id]&&u["b"].commit(this.paneId+"/SET_INDICATOR_ERROR",{id:e.id,error:null}),e.model=t,!1!==e.options.visible&&this.createIndicatorSeries(e)}catch(r){if(!1!==e.options.visible)throw u["b"].commit(this.paneId+"/SET_INDICATOR_ERROR",{id:e.id,error:r.message}),r}}},{key:"bindIndicator",value:function(e,t){if(t&&"undefined"===typeof t.indicators[e.id]&&e.model){if(t.indicators[e.id]=this.serieBuilder.getRendererIndicatorData(e),!this.activeRenderer||t===this.activeRenderer){for(var r=0;r<t.indicators[e.id].plotsOptions.length;r++)e.apis[r].applyOptions(t.indicators[e.id].plotsOptions[r]);e.adapter=this.serieBuilder.getAdapter(e.model.output),e.silentAdapter=this.serieBuilder.getAdapter(e.model.silentOutput)}return this.prepareRendererForIndicators(e,t),e}}},{key:"unbindIndicator",value:function(e,t){t&&"undefined"!==typeof t.indicators[e.id]&&delete t.indicators[e.id]}},{key:"ensurePriceScale",value:function(e,t){if(-1===this.priceScales.indexOf(e)){this.priceScales.push(e);var r=u["b"].state[this.paneId].priceScales[e];r||(r={},t&&t.options.scaleMargins?r.scaleMargins=t.options.scaleMargins:r.scaleMargins={top:.1,bottom:.2},u["b"].commit(this.paneId+"/SET_PRICE_SCALE",{id:e,priceScale:r})),this.refreshPriceScale(e)}}},{key:"resetPriceScales",value:function(){for(var e=0;e<this.priceScales.length;e++)this.chartInstance.priceScale(this.priceScales[e]).applyOptions({autoScale:!0})}},{key:"removeIndicator",value:function(e){"string"===typeof e&&(e=this.getLoadedIndicator(e)),e&&(this.removeIndicatorSeries(e),this.loadedIndicators.splice(this.loadedIndicators.indexOf(e),1))}},{key:"clearChart",value:function(e){e||this.preventPan();var t,r=oe(this.loadedIndicators);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.clearIndicatorSeries(n)}}catch(i){r.e(i)}finally{r.f()}this.renderedRange.from=this.renderedRange.to=null}},{key:"clearData",value:function(){this.activeRenderer=null,this.activeChunk=null,this.queuedTrades.splice(0,this.queuedTrades.length)}},{key:"clearPriceLines",value:function(e){for(var t=0;t<this.loadedIndicators.length;t++)if(!e||-1!==e.indexOf(this.loadedIndicators[t].id)){this._priceIndicatorId===this.loadedIndicators[t].id&&(this._alertsRendered=!1);for(var r=0;r<this.loadedIndicators[t].apis.length;r++)this.loadedIndicators[t].apis[r].removeAllPriceLines()}}},{key:"clear",value:function(){this.chartCache.clear(),this.clearData(),this.clearChart(),this.setTimeframe(u["b"].state[this.paneId].timeframe),this.propagateInitialPrices=!0}},{key:"resample",value:function(e){var t=Object(c["h"])(this.activeRenderer.timestamp,e),r=this.getActiveChunk();if(r)for(var n in this.activeRenderer.sources)!1===this.activeRenderer.sources[n].empty&&r.bars.push(this.cloneSourceBar(this.activeRenderer.sources[n],t));if(this.setTimeframe(e),this.chartCache.chunks.length){for(var i=function(e,t,r){return"number"===typeof e.close?t.open=t.high=t.low=t.close=e.close:"undefined"!==typeof t.close&&null!==t.close||(t.open=t.high=t.low=t.close=null,t.vbuy=0,t.vsell=0,t.cbuy=0,t.csell=0,t.lbuy=0,t.lsell=0),t.timestamp=r,t},a={},o=0;o<this.chartCache.chunks.length;o++){for(var l=0;l<this.chartCache.chunks[o].bars.length;l++){var u=this.chartCache.chunks[o].bars[l],h=u.exchange+":"+u.pair,d=Object(c["h"])(u.timestamp,this.timeframe,this.isOddTimeframe);!a[h]||a[h].timestamp<d?a[h]?a[h]=i(a[h],u,d):a[h]=i({},u,d):(null===typeof a[h].open&&(a[h].open=u.open,a[h].high=u.high,a[h].low=u.low,a[h].close=u.close),a[h].vbuy+=u.vbuy,a[h].vsell+=u.vsell,a[h].cbuy+=u.cbuy,a[h].csell+=u.csell,a[h].lbuy+=u.lbuy,a[h].lsell+=u.lsell,a[h].close=u.close,a[h].high=Math.max(a[h].high,u.high,u.open,u.close),a[h].low=Math.min(a[h].low,u.low,u.open,u.close),this.chartCache.chunks[o].bars.splice(l--,1))}if(o&&this.chartCache.chunks[o].bars.length<s["c"]){if(this.chartCache.chunks[o].bars.length){var p=s["c"]-this.chartCache.chunks[o-1].bars.length;p&&(this.chartCache.chunks[o-1].bars=this.chartCache.chunks[o-1].bars.concat(this.chartCache.chunks[o].bars.splice(0,p)))}this.chartCache.chunks[o].bars.length||(this.chartCache.chunks.splice(o,1),o--)}}this.activeRenderer=null,this.renderAll()}}},{key:"getActiveChunk",value:function(){return this.activeChunk||this.chartCache.cacheRange.to!==this.activeRenderer.timestamp?(this.activeChunk&&(this.activeChunk.active=!1),this.activeChunk=this.chartCache.saveChunk({from:this.activeRenderer.timestamp,to:this.activeRenderer.timestamp,active:!0,rendered:!0,bars:[]})):(this.activeChunk=this.chartCache.chunks[this.chartCache.chunks.length-1],this.activeChunk.active=!0),this.activeChunk}},{key:"destroy",value:function(){this.chartCache.clear(),this.clearData(),this.clearChart(),this.removeChart(),this.clearQueue(),H["a"].off("decimals",this._refreshDecimalsHandler)}},{key:"clearIndicatorSeries",value:function(e){for(var t=0;t<e.apis.length;t++)e.apis[t].removeAllPriceLines(),e.apis[t].setData([])}},{key:"setupQueue",value:function(){this._releaseQueueInterval||(u["b"].state[this.paneId].refreshRate?this._releaseQueueInterval=setInterval(this._queueHandler,u["b"].state[this.paneId].refreshRate):this._releaseQueueInterval=requestAnimationFrame(this._queueHandler))}},{key:"clearQueue",value:function(){this._releaseQueueInterval&&(clearInterval(this._releaseQueueInterval),cancelAnimationFrame(this._releaseQueueInterval),delete this._releaseQueueInterval,this.releaseQueue())}},{key:"releaseQueue",value:function(){this.queuedTrades.length&&(this.renderRealtimeTrades(this.queuedTrades),this.queuedTrades.splice(0,this.queuedTrades.length))}},{key:"queueTrades",value:function(e){Array.prototype.push.apply(this.queuedTrades,e),u["b"].state[this.paneId].refreshRate||(this._releaseQueueInterval=requestAnimationFrame(this._queueHandler))}},{key:"renderRealtimeTrades",value:function(e){if(e.length){for(var t=!1,r=0;r<e.length;r++){var n=e[r],i=n.exchange+":"+n.pair;if("undefined"!==typeof this.markets[i]){var a=void 0;if(a=this.activeRenderer?"time"===this.activeRenderer.type?Object(c["h"])(n.timestamp/1e3,this.timeframe,this.isOddTimeframe):this.activeRenderer.bar.cbuy+this.activeRenderer.bar.csell>=this.timeframe?Math.max(this.activeRenderer.timestamp+.001,Math.round(n.timestamp/1e3)):this.activeRenderer.timestamp:n.timestamp/1e3,!this.activeRenderer||this.activeRenderer.timestamp<a)if(this.activeRenderer){for(var o in(!this.activeChunk||this.activeChunk.to<this.activeRenderer.timestamp&&this.activeChunk.bars.length>=s["c"])&&this.getActiveChunk(),this.activeRenderer.bar.empty||this.updateBar(this.activeRenderer),this.activeRenderer.sources)!1===this.activeRenderer.sources[o].empty&&this.activeChunk.bars.push(this.cloneSourceBar(this.activeRenderer.sources[o],this.activeRenderer.timestamp));this.activeChunk.to=this.chartCache.cacheRange.to=this.activeRenderer.timestamp,this.renderedRange.to<this.activeRenderer.timestamp&&(this.renderedRange.to=this.activeRenderer.timestamp),this.nextBar(a,this.activeRenderer)}else this.activeRenderer=this.createRenderer(a);var l=n.price*n.size;this.activeRenderer.sources[i]&&"undefined"!==typeof this.activeRenderer.sources[i].pair||(this.propagateInitialPrices&&(this.chartCache.initialPrices[i]={exchange:n.exchange,pair:n.pair,price:n.price},t||(t=!0)),this.activeRenderer.sources[i]={pair:n.pair,exchange:n.exchange,close:+n.price,active:this.markets[i].active},this.resetBar(this.activeRenderer.sources[i]));var u=this.markets[i].active;n.liquidation?(this.activeRenderer.sources[i]["l"+n.side]+=l,this.activeRenderer.bar.empty=!1,u&&(this.activeRenderer.bar["l"+n.side]+=l)):(this.activeRenderer.sources[i].close=+n.price,this.activeRenderer.sources[i].empty?this.activeRenderer.sources[i].open=this.activeRenderer.sources[i].high=this.activeRenderer.sources[i].low=this.activeRenderer.sources[i].close:(this.activeRenderer.sources[i].high=Math.max(this.activeRenderer.sources[i].high,this.activeRenderer.sources[i].close),this.activeRenderer.sources[i].low=Math.min(this.activeRenderer.sources[i].low,this.activeRenderer.sources[i].close)),this.activeRenderer.sources[i]["c"+n.side]+=n.count,this.activeRenderer.sources[i]["v"+n.side]+=l,this.activeRenderer.sources[i].empty=!1,u&&(this.activeRenderer.bar["v"+n.side]+=l,this.activeRenderer.bar["c"+n.side]+=n.count,this.activeRenderer.bar.empty=!1))}}this.activeRenderer&&(t?this.renderAll():this.activeRenderer.bar.empty||(this.updateBar(this.activeRenderer),this.renderedRange.to<this.activeRenderer.timestamp&&(this.renderedRange.to=this.activeRenderer.timestamp)))}}},{key:"cloneSourceBar",value:function(e,t){return{pair:e.pair,exchange:e.exchange,timestamp:t||e.timestamp,open:e.open,high:e.high,low:e.low,close:e.close,vbuy:e.vbuy,vsell:e.vsell,cbuy:e.cbuy,csell:e.csell,lbuy:e.lbuy,lsell:e.lsell}}},{key:"renderBars",value:function(e,t,r,n){e.length&&this.prependInitialPrices(e,r),this.clearPriceLines(t);var i,a,o={},s=null,c=null;if(e.length){if(this.activeRenderer&&this.activeRenderer.timestamp>e[e.length-1].timestamp)for(var l=Object.values(this.activeRenderer.sources).filter((function(e){return!1===e.empty})),u=0;u<l.length;u++){var h=l[u];h.timestamp=this.activeRenderer.timestamp;for(var d=e.length-1;d>=0;d--){var p=e[d];if(p.timestamp<this.activeRenderer.timestamp){e.splice(d+1,0,h),l.splice(u,1),u--;break}if(p.exchange===h.exchange&&p.pair===h.pair){p.vbuy+=h.vbuy,p.vsell+=h.vsell,p.cbuy+=h.cbuy,p.csell+=h.csell,p.lbuy+=h.lbuy,p.lsell+=h.lsell,p.open=h.open,p.high=h.high,p.low=h.low,p.close=h.close,l.splice(u,1),u--;break}}}}else if(this.activeRenderer&&this.activeRenderer.bar&&!this.activeRenderer.bar.empty&&(e=Object.values(this.activeRenderer.sources).filter((function(e){return!1===e.empty}))),!e.length)return;for(var f,m=0,v=0;v<=e.length;v++){var y=e[v];if(!y||!i||y.timestamp>i.timestamp){if(i){if(i.bar.empty&&!this.fillGapsWithEmpty&&y){this.nextBar(y.timestamp,i);continue}for(var g in null===s&&(s=i.timestamp),c=i.timestamp,a=this.computeBar(i,t),a)"undefined"===typeof o[g]&&(o[g]=[]),o[g].push(a[g])}if(!y)break;if(m++,i){if(this.fillGapsWithEmpty&&"time"===i.type){var b=(y.timestamp-i.timeframe-i.timestamp)/i.timeframe;if(b>0)for(var I=0;I<b;I++)for(var k in this.incrementRendererBar(i),a)"undefined"===typeof o[k]&&(o[k]=[]),o[k].push({time:i.localTimestamp})}this.nextBar(y.timestamp,i)}else i=this.createRenderer(y.timestamp||this.activeRenderer.timestamp,t)}var _=y.exchange+":"+y.pair,w=this.markets[_].active;w&&!y.empty&&(i.bar.empty=!1,i.bar.vbuy+=y.vbuy,i.bar.vsell+=y.vsell,i.bar.cbuy+=y.cbuy,i.bar.csell+=y.csell,i.bar.lbuy+=y.lbuy,i.bar.lsell+=y.lsell),i.sources[_]=this.cloneSourceBar(y),i.sources[_].empty=!1,i.sources[_].active=w}if(this.activeRenderer){for(var O in this.activeRenderer.bar=i.bar,i.indicators)this.activeRenderer.indicators[O]=i.indicators[O];for(var C in i.sources)this.activeRenderer.sources[C]=i.sources[C]}else this.activeRenderer=i;t&&t.length||(this.activeRenderer.length=m,f=this.chartInstance.timeScale().scrollPosition(),e.length?(this.renderedRange.from=s,this.renderedRange.to=c):this.renderedRange.from=this.renderedRange.to=null),this.replaceData(o,n),f&&this.chartInstance.timeScale().scrollToPosition(f,!1),this.renderAlerts()}},{key:"prependInitialPrices",value:function(e,t){var r=this,n=Object.keys(this.markets).filter((function(e){return r.markets[e].historical})),i=100*n.length;if(this.propagateInitialPrices){var a=e[0].timestamp;if(t)for(var o=0;o<e.length;o++){var s=e[o].exchange+":"+e[o].pair,c=void 0;if(t){if(e[o].timestamp<=a){-1!==(c=n.indexOf(s))&&n.splice(c,1);continue}if(-1!==(c=n.indexOf(s)))this.chartCache.initialPrices[s]={exchange:e[o].exchange,pair:e[o].pair,price:e[o].close},n.splice(c,1);else if(!n.length||o>i)break}}for(var l in this.chartCache.initialPrices){var u=this.chartCache.initialPrices[l].price,h=this.chartCache.initialPrices[l].exchange,d=this.chartCache.initialPrices[l].pair,p=this.resetBar({timestamp:a,exchange:h,pair:d,open:u,high:u,low:u,close:u});e.unshift(p)}}}},{key:"removeIndicatorSeries",value:function(e){for(var t=0;t<e.apis.length;t++)this.chartInstance.removeSeries(e.apis[t]),e.apis.splice(t--,1);this.unbindIndicator(e,this.activeRenderer);var r="undefined"===typeof this.loadedIndicators.find((function(t){return t.id!==e.id&&!1!==t.options.visible&&t.options.priceScaleId===e.options.priceScaleId}));r&&this.priceScales.splice(this.priceScales.indexOf(e.options.priceScaleId),1)}},{key:"createIndicatorSeries",value:function(e){for(var t=[],r=0;r<e.model.plots.length;r++){var n=e.model.plots[r],i=Object(c["c"])("add-"+n.type+"-series"),a=this.serieBuilder.getCustomPlotOptions(e,n),o=K(K(K(K({},l["c"]),l["b"][n.type]||{}),e.options),a);o.scaleMargins&&delete o.scaleMargins;var s=this.chartInstance[i](o);s.id=n.id,o.priceFormat&&"number"===typeof o.priceFormat.precision&&(s.precision=o.priceFormat.precision),this.seriesIndicatorsMap[n.id]={indicatorId:e.id,plotIndex:r},t.push(n.id),e.apis.push(s)}u["b"].commit(this.paneId+"/SET_INDICATOR_SERIES",{id:e.id,series:t}),this.ensurePriceScale(e.options.priceScaleId,e),this.bindIndicator(e,this.activeRenderer)}},{key:"refreshPriceScale",value:function(e){var t=u["b"].state[this.paneId].priceScales[e];this.chartInstance.priceScale(e).applyOptions(K({},t))}},{key:"preventPan",value:function(){var e=this;if(!this.panPrevented){var t=100;"undefined"!==typeof this._releasePanTimeout&&clearTimeout(this._releasePanTimeout),this.panPrevented=!0,this._releasePanTimeout=window.setTimeout((function(){e.panPrevented=!1}),t)}}},{key:"renderAll",value:function(e,t){var r=this;if(this.chartInstance){if(this._promiseOfMarkets)return this._promiseOfMarketsRender||(this._promiseOfMarketsRender=this._promiseOfMarkets.then((function(){r._promiseOfMarketsRender=null,r.renderAll(!1,!0)}))),this._promiseOfMarketsRender;this.clearChart(t),this.renderBars(this.chartCache.chunks.length?this.chartCache.chunks.reduce((function(e,t){return e.concat(t.bars)}),[]):[],null,e,t)}}},{key:"retrieveAlerts",value:async function(){for(var e=this,t=Object.values(this.markets).reduce((function(e,t){return-1===e.indexOf(t.index)&&e.push(t.index),e}),[]),r=0,n=Object.keys(this.alerts);r<n.length;r++){var i=n[r];-1===t.indexOf(i)&&delete this.alerts[i]}var a,o=oe(t);try{var s=async function(){var t=a.value;if(e.alerts[t])return"continue";e.alerts[t]=[],await V["a"].getAlerts(t).then((function(r){for(var n=0;n<r.length;n++)e.alerts[t].push(r[n])}))};for(o.s();!(a=o.n()).done;)await s()}catch(c){o.e(c)}finally{o.f()}}},{key:"renderAlerts",value:function(){if(!this._alertsRendered&&u["b"].state.settings.alerts){var e=this.getPriceApi();if(e){for(var t in this.alerts)for(var r=0;r<this.alerts[t].length;r++)this.renderAlert(this.alerts[t][r],e);this._alertsRendered=!0}}}},{key:"triggerAlert",value:function(e,t){if(this.alerts[e]){var r=this.alerts[e].find((function(e){return e.price===t}));if(r){u["b"].state.settings.alertSound&&Z["d"].playOnce(u["b"].state.settings.alertSound),r.triggered=!0;var n=this.getPriceApi(),i=n.getPriceLine(t);i&&n.removePriceLine(i),this.renderAlert(r,n)}}}},{key:"renderAlert",value:function(e,t,r){var n,i;if(e.timestamp){var a=Object(c["h"])(e.timestamp,this.timeframe);n=this.chartInstance.timeScale().coordinateToLogical(this.chartInstance.timeScale().timeToCoordinate(a))}return e.triggered&&(i="✔"),t.createPriceLine({market:e.market,index:n,price:e.price,color:r||u["b"].state.settings.alertsColor,lineWidth:u["b"].state.settings.alertsLineWidth,lineStyle:u["b"].state.settings.alertsLineStyle,title:i})}},{key:"replaceData",value:function(e,t){t||this.preventPan();for(var r=this.loadedIndicators.length-1;r>=0;r--)if(!1!==this.loadedIndicators[r].options.visible)for(var n=0;n<this.loadedIndicators[r].apis.length;n++){var i=this.loadedIndicators[r].apis[n].id;if(e[i])try{this.loadedIndicators[r].apis[n].setData(e[i])}catch(a){u["b"].commit(this.paneId+"/SET_INDICATOR_ERROR",{id:this.loadedIndicators[r].id,error:a.message}),this.setIndicatorOption(this.loadedIndicators[r].id,"visible",!1)}}}},{key:"updateBar",value:function(e){this.preventPan();for(var t=0;t<this.loadedIndicators.length;t++)if(!1!==this.loadedIndicators[t].options.visible){var r=this.loadedIndicators[t],n=e.indicators[r.id];n.canRender?this.loadedIndicators[t].adapter(e,n.functions,n.variables,r.apis,r.options,y):this.loadedIndicators[t].silentAdapter(e,n.functions,n.variables,r.apis,r.options,y)}}},{key:"computeBar",value:function(e,t){for(var r={},n=0;n<this.loadedIndicators.length;n++)if(!(t&&-1===t.indexOf(this.loadedIndicators[n].id)||!1===this.loadedIndicators[n].options.visible)){var i=this.loadedIndicators[n],a=e.indicators[i.id];a.series=[];try{i.silentAdapter(e,a.functions,a.variables,i.apis,i.options,y)}catch(s){u["b"].commit(this.paneId+"/SET_INDICATOR_ERROR",{id:i.id,error:s.message});continue}for(var o=0;o<a.series.length;o++){if(!i.model.plots[o])break;e.length<a.minLength||!a.series[o]||"undefined"!==typeof a.series[o].value&&null===a.series[o].value||"undefined"!==typeof a.series[o].lowerValue&&null===a.series[o].lowerValue||"histogram"===i.model.plots[o].type&&0===a.series[o].value||(r[i.apis[o].id]=a.series[o])}}return r}},{key:"getPriceApi",value:function(){for(var e=0;e<this.loadedIndicators.length;e++)for(var t=0;t<this.loadedIndicators[e].apis.length;t++){var r=this.loadedIndicators[e].apis[t];if("right"===r.options().priceScaleId)return this._priceIndicatorId=this.loadedIndicators[e].id,r}}},{key:"createRenderer",value:function(e,t){e=Object(c["h"])(e,this.timeframe);var r={timestamp:e,localTimestamp:e+this.timezoneOffset,timeframe:this.timeframe,type:this.type,length:1,indicators:{},sources:{},bar:{vbuy:0,vsell:0,cbuy:0,csell:0,lbuy:0,lsell:0,empty:!0}};this.loadedIndicators=this.loadedIndicators.sort((function(e,t){var r=e.model?e.model.references.length:0,n=t.model?t.model.references.length:0;return r-n}));var n,i=oe(this.loadedIndicators);try{for(i.s();!(n=i.n()).done;){var a=n.value;t&&-1===t.indexOf(a.id)||!1===a.options.visible||this.bindIndicator(a,r)}}catch(o){i.e(o)}finally{i.f()}return r}},{key:"nextBar",value:function(e,t){if(this.fillGapsWithEmpty&&t===this.activeRenderer&&"time"===this.activeRenderer.type&&this.activeRenderer.timestamp<e-this.activeRenderer.timeframe)for(var r=(e-this.activeRenderer.timeframe-this.activeRenderer.timestamp)/this.activeRenderer.timeframe,n=0;n<this.loadedIndicators.length;n++)for(var i=0;i<this.loadedIndicators[n].apis.length;i++)for(var a=0;a<r;a++)0===n&&0===i&&this.incrementRendererBar(t),this.loadedIndicators[n].apis[i].update({time:t.localTimestamp});this.incrementRendererBar(t),this.resetRendererBar(t),t.timestamp=e,t.localTimestamp=e+this.timezoneOffset}},{key:"incrementRendererBar",value:function(e){e.length++,e.timestamp+=e.timeframe,e.localTimestamp+=e.timeframe;for(var t=0;t<this.loadedIndicators.length;t++){var r=e.indicators[this.loadedIndicators[t].id];if(r){r.canRender=e.length>=r.minLength;for(var n=0;n<r.functions.length;n++){var i=r.functions[n];"function"===typeof y[i.name].next&&y[i.name].next(i)}for(var a=0;a<r.variables.length;a++){var o=r.variables[a];o.length>1&&(o.state.unshift(o.state[0]),o.state.length>o.length&&o.state.pop())}}}}},{key:"resetRendererBar",value:function(e){if(e.bar={vbuy:0,vsell:0,cbuy:0,csell:0,lbuy:0,lsell:0,empty:!0},"undefined"!==typeof e.sources)for(var t in e.sources)this.resetBar(e.sources[t])}},{key:"resetBar",value:function(e){return null!==e.close&&(e.open=e.close,e.high=e.close,e.low=e.close),e.vbuy=0,e.vsell=0,e.cbuy=0,e.csell=0,e.lbuy=0,e.lsell=0,e.empty=!0,e}},{key:"prepareRendererForIndicators",value:function(e,t){for(var r=Object.keys(e.model.markets),n=0;n<r.length;n++){t.sources[r[n]]||(t.sources[r[n]]={open:null,high:null,low:null,close:null});var i=e.model.markets[r[n]];if(i.length)for(var a=0;a<i.length;a++)"undefined"===typeof t.sources[r[n]][i[a]]&&"open"!==i[a]&&"high"!==i[a]&&"low"!==i[a]&&"close"!==i[a]&&(t.sources[r[n]][i[a]]=0)}}},{key:"toggleFillGapsWithEmpty",value:function(){this.fillGapsWithEmpty=!this.fillGapsWithEmpty,this.renderAll()}},{key:"refreshAutoDecimals",value:function(e){var t=Object.keys(this.markets),r=Object.keys(U["l"]).find((function(e){return-1!==t.indexOf(e)}));if(r)for(var n=U["l"][r],i=0;i<this.loadedIndicators.length;i++)if(!e||e===this.loadedIndicators[i].id){var a=this.loadedIndicators[i].options.priceFormat||{type:"price"};if(a.auto&&"volume"!==a.type&&a.precision!==n){a=K(K({},a),{},{precision:n,minMove:1/Math.pow(10,n)}),u["b"].dispatch(this.paneId+"/setIndicatorOption",{id:this.loadedIndicators[i].id,key:"priceFormat",value:a,silent:!0});for(var o=0;o<this.loadedIndicators[i].apis.length;o++)this.loadedIndicators[i].apis[o].applyOptions({priceFormat:a}),this.loadedIndicators[i].apis[o].precision=n}}}},{key:"getPricelineAtPoint",value:function(e){var t=Object(W["a"])(e),r={x:t.x,y:t.y},n=this.getPriceApi();if(n){var i=n.coordinateToPrice(t.y);if(i){var a,o=n.getPriceLine(i,this.chartInstance.timeScale().coordinateToLogical(t.x));if(o){var s=o.options();a=s.market,s.market?(a=s.market,i=s.price):o=null}if(!a){for(var c in this.markets)if(this.markets[c].active&&this.markets[c].historical){a=this.markets[c].index;break}a||(a=Object.values(this.markets)[0].index)}o||(i=+Object(U["e"])(i,n.options().priceFormat.precision));var l=u["b"].state.settings.alerts&&(e.shiftKey||u["b"].state.settings.alertsClick);return{api:n,price:i,market:a,priceline:o,canCreate:l,originalOffset:t,offset:r}}}}},{key:"disableCrosshair",value:function(){this.chartInstance.applyOptions({crosshair:{vertLine:{color:"transparent",labelVisible:!1},horzLine:{color:"transparent",labelVisible:!1}}})}},{key:"enableCrosshair",value:function(){var e=Object(l["e"])();this.chartInstance.applyOptions({crosshair:{vertLine:{color:e.crosshair.vertLine.color,labelVisible:!0},horzLine:{color:e.crosshair.horzLine.color,labelVisible:!0}}})}}]),e}(),pe=r("fa07"),fe=r("ba10"),me=r.n(fe);function ve(e){return ve="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function ye(e,t){return Ie(e)||be(e,t)||we(e,t)||ge()}function ge(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function be(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done);o=!0)if(a.push(n.value),t&&a.length===t)break}catch(c){s=!0,i=c}finally{try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}return a}}function Ie(e){if(Array.isArray(e))return e}function ke(e){return Ce(e)||Oe(e)||we(e)||_e()}function _e(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function we(e,t){if(e){if("string"===typeof e)return Se(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Se(e,t):void 0}}function Oe(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Ce(e){if(Array.isArray(e))return Se(e)}function Se(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Te(e,t,r){return t&&xe(e.prototype,t),r&&xe(e,r),e}function Ee(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&je(e,t)}function je(e,t){return je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},je(e,t)}function Pe(e){var t=$e();return function(){var r,n=Le(e);if(t){var i=Le(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Me(this,r)}}function Me(e,t){if(t&&("object"===ve(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ae(e)}function Ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $e(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Le(e){return Le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Le(e)}var De=function(e){Ee(r,e);var t=Pe(r);function r(){var e;return Re(this,r),e=t.call(this),e.promisesOfData={},e.url=Object(c["j"])("historical"),e}return Te(r,[{key:"filterOutUnavailableMarkets",value:function(e){return e.filter((function(e){return-1!==u["b"].state.app.historicalMarkets.indexOf(e)}))}},{key:"getApiUrl",value:function(e,t,r,n){var i=[e,t,(1e3*r).toString()];return n&&n.length&&i.push(encodeURIComponent(n.join("+"))),"".concat(this.url,"/").concat(i.join("/"))}},{key:"fetch",value:function(e){function t(t,r,n,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,r,n){var i=this,a=this.getApiUrl(e,t,r,n);return this.promisesOfData[a]||(u["b"].commit("app/TOGGLE_LOADING",!0),this.promisesOfData[a]=fetch(a).then((function(e){return e.json().then((function(t){return t.status=e.status,t}))})).then((function(e){if(!e||e.error)throw new Error(e&&e.error?e.error:"empty-response");if(!e.results.length)throw new Error("No more data");if("point"!==e.format)throw new Error("Bad data");return i.normalizePoints(e.results,e.columns,r,n)})).catch((function(e){throw Object(c["q"])(e),e})).then((function(e){return u["b"].commit("app/TOGGLE_LOADING",!1),delete i.promisesOfData[a],e}))),this.promisesOfData[a]}))},{key:"normalizePoints",value:function(e,t,r,n){var i,a={};if(n=n.slice(),!e||!e.length)return e;i=Array.isArray(e[0])?e[0][0]:+new Date(e[0].time)/1e3,n=ke(n);for(var o={},s=Object(c["r"])(r),l=0;l<e.length;l++){if(!e[l].time&&e[l][0])e[l]={time:"undefined"!==typeof t["time"]?e[l][t["time"]]:0,cbuy:"undefined"!==typeof t["cbuy"]?e[l][t["cbuy"]]:0,close:"undefined"!==typeof t["close"]?e[l][t["close"]]:0,csell:"undefined"!==typeof t["csell"]?e[l][t["csell"]]:0,high:"undefined"!==typeof t["high"]?e[l][t["high"]]:0,lbuy:"undefined"!==typeof t["lbuy"]?e[l][t["lbuy"]]:0,low:"undefined"!==typeof t["low"]?e[l][t["low"]]:0,lsell:"undefined"!==typeof t["lsell"]?e[l][t["lsell"]]:0,market:"undefined"!==typeof t["market"]?e[l][t["market"]]:0,open:"undefined"!==typeof t["open"]?e[l][t["open"]]:0,vbuy:"undefined"!==typeof t["vbuy"]?e[l][t["vbuy"]]:0,vsell:"undefined"!==typeof t["vsell"]?e[l][t["vsell"]]:0},e[l].timestamp=e[l].time;else{if(!a[e[l].market])for(var u=l-1;u>=0;u--)if(e[u].market===e[l].market){a[e[l].market]=e[u];break}if(e[l].timestamp=Object(c["h"])(e[l].time/1e3,r,s),!a[e[l].market]||a[e[l].market].timestamp<e[l].timestamp)a[e[l].market]=e[l];else if(a[e[l].market]!==e[l]){a[e[l].market].vbuy+=e[l].vbuy,a[e[l].market].vsell+=e[l].vsell,a[e[l].market].cbuy+=e[l].cbuy,a[e[l].market].csell+=e[l].csell,a[e[l].market].lbuy+=e[l].lbuy,a[e[l].market].lsell+=e[l].lsell,a[e[l].market].high=Math.max(e[l].high,a[e[l].market].high),a[e[l].market].low=Math.min(e[l].low,a[e[l].market].low),a[e[l].market].close=e[l].close,e.splice(l,1),l--;continue}}if("number"!==typeof o[e[l].market]&&(o[e[l].market]=e[l].open),e[l].timestamp===i){var h=n.indexOf(e[l].market);n.splice(h,1)}var d=Object(U["m"])(e[l].market),p=ye(d,2),f=p[0],m=p[1];e[l].exchange=f,e[l].pair=m,delete e[l].time}return{data:e,markets:n,from:e[0].timestamp,to:e[e.length-1].timestamp}}}]),r}(me.a),ze=new De,Ge=r("f634"),Be=r("024c"),Ne=r("8c91"),Fe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chart-layout",style:{right:e.axis[0]+"px",bottom:e.axis[1]+"px"},on:{dblclick:function(t){return e.$store.commit(e.paneId+"/TOGGLE_LAYOUTING")}}},[r("div",{staticClass:"chart-layout__controls"},[r("button",{staticClass:"btn -red -small",attrs:{title:"Close menu while reverting chart layout to it's original state"},on:{click:e.cancel}},[e._v(" Cancel "),r("i",{staticClass:"icon-eraser ml4"})]),r("button",{staticClass:"btn -green -small ml8",attrs:{title:"Click if you finished rearranging the chart layout"},on:{click:function(t){return e.$store.commit(e.paneId+"/TOGGLE_LAYOUTING")}}},[e._v(" Ok "),r("i",{staticClass:"icon-check ml4"})])]),e._l(e.activePriceScales,(function(t,n){return r("chart-price-scale",{key:n,staticClass:"chart-layout__item",attrs:{paneId:e.paneId,priceScaleId:n,priceScale:t},on:{update:function(t){return e.updatePriceScaleScaleMargins(n,t)}}})}))],2)},qe=[],He=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chart-pricescale",class:{"-active":!!e.currentSide},style:{top:e.roundedTop+"%",bottom:e.roundedBottom+"%"}},[r("div",{staticClass:"chart-pricescale__content"},[r("div",{staticClass:"chart-pricescale__title pane-overlay",on:{mousedown:e.handleMove,touchstart:e.handleMove}},[r("i",{staticClass:"icon-move mr8"}),e._v(" "+e._s(e.priceScale.indicators.join(", "))+" "),"right"===e.priceScaleId?r("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"ml4",attrs:{title:"Main scale"}},[e._v("👑")]):e._e(),r("dropdown-button",{staticClass:"chart-pricescale__mode -text -small ml8 text-bold -arrow",attrs:{options:e.modes,placeholder:"linear"},on:{input:function(t){return e.updateMode(t)}},model:{value:e.priceScale.mode,callback:function(t){e.$set(e.priceScale,"mode",t)},expression:"priceScale.mode"}})],1),r("div",{staticClass:"chart-pricescale__size pane-overlay",domProps:{textContent:e._s(100-e.roundedTop-e.roundedBottom+"%")}})]),r("div",{staticClass:"chart-pricescale__boundary -top",class:{"-active":"top"===e.currentSide},on:{mousedown:function(t){return e.handleResize(t,"top")},touchstart:function(t){return e.handleResize(t,"top")}}}),r("div",{staticClass:"chart-pricescale__boundary -bottom",class:{"-active":"bottom"===e.currentSide},on:{mousedown:function(t){return e.handleResize(t,"bottom")},touchstart:function(t){return e.handleResize(t,"bottom")}}})])},Ve=[],We=r("3918");function Ue(e){return Ue="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(e)}function Ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ke(e,t,r){return t&&Qe(e.prototype,t),r&&Qe(e,r),e}function Je(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ye(e,t)}function Ye(e,t){return Ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ye(e,t)}function Xe(e){var t=rt();return function(){var r,n=nt(e);if(t){var i=nt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return et(this,r)}}function et(e,t){if(t&&("object"===Ue(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return tt(e)}function tt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function nt(e){return nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},nt(e)}var it=function(e){Je(r,e);var t=Xe(r);function r(){var e;return Ze(this,r),e=t.apply(this,arguments),e.top=null,e.bottom=null,e.roundedTop=null,e.roundedBottom=null,e.currentMoveId=null,e.currentSide=null,e.currentOrigin=null,e.currentContainerHeight=null,e.modes={0:"Linear",1:"Logarithimic",2:"Percent",3:"Indexed to 100"},e}return Ke(r,[{key:"created",value:function(){this.getSize()}},{key:"beforeDestroy",value:function(){this.release()}},{key:"getSize",value:function(){this.roundedTop=this.top=100*this.priceScale.scaleMargins.top,this.roundedBottom=this.bottom=100*this.priceScale.scaleMargins.bottom}},{key:"handleResize",value:function(e,t){this.currentMoveId?this.release():(this.start(t,Object(c["m"])(e).y),document.addEventListener("mousemove",this.resize),document.addEventListener("mouseup",this.release),document.addEventListener("touchmove",this.resize),document.addEventListener("touchend",this.release))}},{key:"resize",value:function(e){var t=this.getPercentMove(e);t&&(this[this.currentSide]+=t*("top"===this.currentSide?1:-1),this.updateScaleMargins(e))}},{key:"handleMove",value:function(e){this.currentMoveId?this.release():(this.start("both",Object(c["m"])(e).y),document.addEventListener("mousemove",this.move),document.addEventListener("mouseup",this.release),document.addEventListener("touchmove",this.move),document.addEventListener("touchend",this.release))}},{key:"move",value:function(e){var t=this.getPercentMove(e);t&&(this.top+=t,this.bottom-=t,this.updateScaleMargins(e))}},{key:"release",value:function(){this.currentSide&&("both"!==this.currentSide?(document.removeEventListener("mousemove",this.resize),document.removeEventListener("touchmove",this.resize)):(document.removeEventListener("mousemove",this.move),document.removeEventListener("touchmove",this.move)),document.removeEventListener("mouseup",this.release),document.removeEventListener("touchend",this.release),this.currentMoveId=null,this.currentSide=null,this.top=this.roundedTop,this.bottom=this.roundedBottom)}},{key:"updateScaleMargins",value:function(e){var t=Math.round(this.top),r=Math.round(this.bottom);this.roundedTop=Math.max(0,Math.min(100-r,t)),this.roundedBottom=Math.max(0,Math.min(r,100-t));var n={top:this.roundedTop/100,bottom:this.roundedBottom/100};this.priceScale.scaleMargins.top===n.top&&this.priceScale.scaleMargins.bottom===n.bottom||this.$emit("update",{id:this.currentMoveId,side:this.currentSide,value:n,syncable:"touchmove"!==e.type&&!e.shiftKey})}},{key:"updateMode",value:function(e){this.priceScale.mode=+e,this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:this.priceScaleId,priceScale:this.priceScale})}},{key:"getContainerHeight",value:function(){var e=parseFloat(this.$el.parentElement.clientHeight);return e}},{key:"getPercentMove",value:function(e){var t=Object(c["m"])(e),r=(t.y-this.currentOrigin)/this.currentContainerHeight*100;return r?(this.currentOrigin=t.y,r):null}},{key:"start",value:function(e,t){this.currentMoveId=Object(c["v"])(8),this.currentSide=e,this.currentOrigin=t,this.currentContainerHeight=this.getContainerHeight()}}]),r}(o["c"]);it=Object(a["a"])([Object(o["a"])({name:"ChartPriceScale",components:{DropdownButton:We["a"]},props:{paneId:{required:!0},priceScaleId:{required:!0},priceScale:{required:!0}},watch:{"priceScale.scaleMargins.top":function(){this.currentMoveId||this.getSize()},"priceScale.scaleMargins.bottom":function(){this.currentMoveId||this.getSize()}}})],it);var at=it,ot=at,st=(r("cce1"),r("2877")),ct=Object(st["a"])(ot,He,Ve,!1,null,null,null),lt=ct.exports;function ut(e){return ut="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}function ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pt(e,t,r){return t&&dt(e.prototype,t),r&&dt(e,r),e}function ft(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}function mt(e,t){return mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},mt(e,t)}function vt(e){var t=bt();return function(){var r,n=It(e);if(t){var i=It(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return yt(this,r)}}function yt(e,t){if(t&&("object"===ut(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return gt(e)}function gt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function It(e){return It=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},It(e)}var kt=function(e){ft(r,e);var t=vt(r);function r(){return ht(this,r),t.apply(this,arguments)}return pt(r,[{key:"created",value:function(){this.getActivePriceScales()}},{key:"mounted",value:function(){document.body.classList.add("-unselectable")}},{key:"beforeDestroy",value:function(){document.body.classList.remove("-unselectable")}},{key:"getActivePriceScales",value:function(){var e=this,t=this.$store.state[this.paneId].indicators;this.activePriceScales=Object.keys(t).reduce((function(r,n){if("string"===typeof e.layouting&&n!==e.layouting)return r;var i=t[n].options.priceScaleId;return r[i]||(r[i]=e.$store.state[e.paneId].priceScales[i],r[i].indicators=[]),r[i].indicators.push(t[n].name),r}),{}),this._originalActivePriceScales=JSON.parse(JSON.stringify(this.activePriceScales))}},{key:"updatePriceScaleScaleMargins",value:function(e,t){t.syncable&&this.unsyncableMoveId!==t.id&&(this.syncMoveWithOthers(e,t.side,t.value)||(this.unsyncableMoveId=t.id)),this.activePriceScales[e].scaleMargins=t.value,this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:e,priceScale:this.activePriceScales[e]})}},{key:"syncMoveWithOthers",value:function(e,t,r){var n=this.activePriceScales[e].scaleMargins,i=!1;for(var a in this.activePriceScales)if(e!==a){var s=this.activePriceScales[a].scaleMargins;s.top===n.top&&s.bottom===n.bottom&&(o["c"].set(this.activePriceScales[a],"scaleMargins",r),this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:a,priceScale:this.activePriceScales[a]}),i=!0)}return i}},{key:"cancel",value:function(){for(var e in this._originalActivePriceScales)this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:e,priceScale:this._originalActivePriceScales[e]});this.$store.commit(this.paneId+"/TOGGLE_LAYOUTING")}}]),r}(o["c"]);kt=Object(a["a"])([Object(o["a"])({components:{ChartPriceScale:lt},name:"ChartLayout",props:{paneId:{required:!0},axis:{required:!0},layouting:{required:!0}}})],kt);var _t=kt,wt=_t,Ot=(r("2231"),Object(st["a"])(wt,Fe,qe,!1,null,null,null)),Ct=Ot.exports,St=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"timeframe-dropdown"},[r("div",{staticClass:"dropdown-item timeframe-dropdown__header",on:{click:function(e){e.stopPropagation()}}},[r("timeframe-input",{staticClass:"timeframe-dropdown__input",attrs:{placeholder:"enter tf."},on:{input:e.onInput,submit:e.addTimeframe}}),e.typeaheadTimeframe&&e.typeaheadTimeframe.value?r("div",{staticClass:"text-nowrap text-monospace text-muted"},[e._v(" ~ "+e._s(e.typeaheadTimeframe.label)+" ")]):e._e(),r("button",{staticClass:"btn -text",attrs:{type:"button"},on:{click:e.toggleEdit}},[r("i",{class:e.editing?"icon-cross":"icon-edit"})])],1),e._l(e.groups,(function(t){return r("section",{key:t.title,staticClass:"section section--small"},[-1!==e.timeframeGroups.indexOf(t.title)?r("div",{staticClass:"section__content"},e._l(t.timeframes,(function(t){return r("button",{key:t.value,staticClass:"dropdown-item dropdown-item--space-between",attrs:{type:"button"},on:{click:function(r){return e.$emit("timeframe",t.value)}}},[r("span",[e._v(e._s(t.label))]),e.editing?r("i",{staticClass:"icon-trash",on:{click:function(r){return r.stopPropagation(),e.removeTimeframe(t.value)}}}):r("i",{staticClass:"icon-star",class:{"icon-star-filled":e.favoriteTimeframes[t.value]},on:{click:function(r){return r.stopPropagation(),e.toggleFavoriteTimeframe(t.value)}}})])})),0):e._e(),r("div",{staticClass:"section__title",on:{click:function(r){return r.stopPropagation(),e.toggleGroup(t)}}},[e._v(" "+e._s(t.title)+" "),r("i",{staticClass:"icon-up-thin"})])])}))],2)},Rt=[],xt=r("a0a8");function Tt(e){return Tt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tt(e)}function Et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pt(e,t,r){return t&&jt(e.prototype,t),r&&jt(e,r),e}function Mt(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}function At(e,t){return At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},At(e,t)}function $t(e){var t=zt();return function(){var r,n=Gt(e);if(t){var i=Gt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Lt(this,r)}}function Lt(e,t){if(t&&("object"===Tt(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Dt(e)}function Dt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Gt(e){return Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Gt(e)}var Bt=function(e){Mt(r,e);var t=$t(r);function r(){var e;return Et(this,r),e=t.apply(this,arguments),e.editing=!1,e.typeaheadTimeframe=null,e}return Pt(r,[{key:"timeframes",get:function(){return this.$store.state.settings.timeframes}},{key:"favoriteTimeframes",get:function(){return this.$store.state.settings.favoriteTimeframes}},{key:"timeframeGroups",get:function(){return this.$store.state.settings.timeframeGroups}},{key:"created",value:function(){}},{key:"mounted",value:function(){}},{key:"groups",get:function(){var e=["seconds","minutes","hours","ticks"],t=-1,r=60,n=60*r,i=24*n,a=this.typeaheadTimeframe;return this.timeframes.sort((function(e,t){var r=e.value&&"t"===e.value[e.value.length-1],n=t.value&&"t"===t.value[t.value.length-1],i=r===n?0:r?1e5:-1e5;return i+=parseFloat(e.value)-parseFloat(t.value),i})).reduce((function(o,s){return a&&a.value!=s.value&&-1===s.label.indexOf(a.label)||(c=+s.value<r?0:+s.value<n?1:+s.value<=i?2:3,c>t&&(o.push({title:e[c],timeframes:[]}),t=c),o[o.length-1].timeframes.push(s)),o;var c}),[])}},{key:"toggleGroup",value:function(e){this.$store.commit("settings/TOGGLE_TIMEFRAME_GROUP",e.title)}},{key:"toggleFavoriteTimeframe",value:function(e){this.$store.commit("settings/TOGGLE_FAVORITE_TIMEFRAME",e)}},{key:"addTimeframe",value:function(e){e&&(this.$store.commit(this.paneId+"/SET_TIMEFRAME",e),this.timeframes.find((function(t){return t.value==e}))||(this.$store.commit("settings/ADD_TIMEFRAME",e),this.$store.dispatch("app/showNotice",{title:"Added timeframe ".concat(Object(c["p"])(e)," to the list !")})))}},{key:"removeTimeframe",value:function(e){this.$store.commit("settings/REMOVE_TIMEFRAME",e)}},{key:"toggleEdit",value:function(){this.editing=!this.editing}},{key:"onInput",value:async function(e){this.typeaheadTimeframe=e,await this.$nextTick();var t=Object.keys(this.groups);1===t.length&&-1===this.timeframeGroups.indexOf(this.groups[t[0]].title)&&this.toggleGroup(this.groups[t[0]])}}]),r}(o["c"]);Bt=Object(a["a"])([Object(o["a"])({name:"TimeframeDropdown",components:{TimeframeInput:xt["a"]},props:{paneId:{type:String,required:!0}}})],Bt);var Nt=Bt,Ft=Nt,qt=(r("d4d0"),Object(st["a"])(Ft,St,Rt,!1,null,"0d62332e",null)),Ht=qt.exports,Vt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chart-overlay__panel indicators-overlay"},[e.value?r("div",{staticClass:"chart-overlay__content"},[r("dropdown",{model:{value:e.dropdownTrigger,callback:function(t){e.dropdownTrigger=t},expression:"dropdownTrigger"}},[r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.editIndicator(e.selectedIndicator)}}},[r("i",{staticClass:"icon-edit"}),r("span",[e._v("Edit")])]),r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.resizeIndicator(e.selectedIndicator)}}},[r("i",{staticClass:"icon-resize-height"}),r("span",[e._v("Resize")])]),r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.duplicateIndicator(e.selectedIndicator)}}},[r("i",{staticClass:"icon-copy-paste"}),r("span",[e._v("Duplicate")])]),r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.downloadIndicator(e.selectedIndicator)}}},[r("i",{staticClass:"icon-download"}),r("span",[e._v("Download")])]),r("div",{staticClass:"dropdown-divider"}),r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.removeIndicator(e.selectedIndicator)}}},[r("i",{staticClass:"icon-trash"}),r("span",[e._v("Remove")])])]),e._l(e.indicators,(function(t,n){return r("IndicatorControl",{key:n,attrs:{"indicator-id":n,"pane-id":e.paneId},on:{action:e.onClickIndicator}})}))],2):e._e(),r("div",{staticClass:"chart-overlay__title pane-overlay",on:{click:e.toggleOverlay}},[r("span",[e._v("Indicators")]),r("button",{staticClass:"btn badge -outline",attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.addIndicator.apply(null,arguments)}}},[e._v(" Add "),r("i",{staticClass:"icon-plus -small ml4"})]),r("i",{staticClass:"icon-up-thin"})])])},Wt=[],Ut=r("2b0e"),Zt=r("2fe1"),Qt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"indicator",class:{"-error":!!e.error,"-disabled":!e.visible}},[r("button",{staticClass:"indicator__name pane-overlay",attrs:{type:"button"},on:{click:e.onClick}},[e._v(" "+e._s(e.name)+" ")]),r("div",{staticClass:"indicator__controls"},[r("button",{staticClass:"btn",attrs:{title:e.visible?"Hide":"Show"},on:{click:e.toggleVisibility}},[r("i",{class:{"icon-visible":!e.visible,"icon-hidden":e.visible}})]),r("button",{staticClass:"btn",attrs:{title:"Menu"},on:{click:function(t){return e.$emit("action",{indicatorId:e.indicatorId,actionName:"menu",event:t})}}},[r("i",{staticClass:"icon-more"})])]),r("div",{staticClass:"indicator__legend pane-overlay",attrs:{id:e.paneId+e.indicator.id}}),e.error?r("div",[r("i",{staticClass:"icon-warning ml4 mr8"}),e._v(" "+e._s(e.error)+" ")]):e._e()])},Kt=[];function Jt(e){return Jt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function Yt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function er(e,t,r){return t&&Xt(e.prototype,t),r&&Xt(e,r),e}function tr(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rr(e,t)}function rr(e,t){return rr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},rr(e,t)}function nr(e){var t=or();return function(){var r,n=sr(e);if(t){var i=sr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return ir(this,r)}}function ir(e,t){if(t&&("object"===Jt(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ar(e)}function ar(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function or(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function sr(e){return sr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},sr(e)}var cr=function(e){tr(r,e);var t=nr(r);function r(){return Yt(this,r),t.apply(this,arguments)}return er(r,[{key:"indicator",get:function(){return this.$store.state[this.paneId].indicators[this.indicatorId]}},{key:"showLegend",get:function(){return this.$store.state[this.paneId].showLegend}},{key:"name",get:function(){return this.indicator.displayName?this.indicator.displayName:this.indicator.name?this.indicator.name:this.indicatorId}},{key:"visible",get:function(){return!this.indicator.options||"undefined"===typeof this.indicator.options.visible||this.indicator.options.visible}},{key:"error",get:function(){return this.$store.state[this.paneId].indicatorsErrors[this.indicatorId]}},{key:"onClick",value:function(e){e.shiftKey?this.$emit("action",{actionName:"resize",indicatorId:this.indicatorId}):this.$emit("action",{indicatorId:this.indicatorId})}},{key:"toggleVisibility",value:function(){var e=this;this.$nextTick((function(){e.$store.dispatch(e.paneId+"/toggleSerieVisibility",e.indicatorId)}))}}]),r}(Ut["default"]);cr=Object(a["a"])([Object(Zt["b"])({name:"IndicatorControl",props:{paneId:{required:!0},indicatorId:{required:!0}}})],cr);var lr=cr,ur=lr,hr=(r("fa84"),Object(st["a"])(ur,Qt,Kt,!1,null,"1bc47e00",null)),dr=hr.exports,pr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Dialog",{staticClass:"-auto",on:{clickOutside:e.close},scopedSlots:e._u([{key:"header",fn:function(){return[r("div",{staticClass:"title"},[e._v("Add indicator")]),r("div",{staticClass:"column -center"})]},proxy:!0}])},[r("div",{staticClass:"d-flex mobile-dir-col-desktop-dir-row"},[e.indicators.length?[r("div",{staticClass:"form-group"},[r("label",[e._v("Choose from existing indicator")]),r("div",{staticClass:"d-flex mb8"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.query,expression:"query"}],staticClass:"form-control",attrs:{type:"text",placeholder:"search"},domProps:{value:e.query},on:{input:function(t){t.target.composing||(e.query=t.target.value)}}}),r("div",{staticClass:"-center text-muted ml16",domProps:{textContent:e._s(e.indicators.length)}})]),e.filteredIndicators.length?r("table",{staticClass:"table"},[r("thead",[r("tr",[r("th",[e._v("Name")]),r("th",{staticClass:"min-768"},[e._v("Description")]),r("th")])]),r("tbody",e._l(e.filteredIndicators,(function(t){return r("tr",{key:t.id,staticClass:"-action",on:{click:function(r){return e.selectIndicator(t)}}},[r("td",{staticClass:"table-input"},[e._v(" "+e._s((t.displayName||t.name).replace(/\{[\w_]+\}/g,""))+" ")]),r("td",{staticClass:"min-768 table-input"},[r("span",{staticClass:"text-muted"},[e._v(e._s(t.description))])]),r("td",{staticClass:"table-action -hover",on:{click:function(r){return r.stopPropagation(),e.toggleDropdown(r,t)}}},[r("button",{staticClass:"btn -text -small"},[r("i",{staticClass:"icon-more"})])])])})),0)]):e._e()]),r("hr",{staticClass:"-single -horizontal"}),r("hr",{staticClass:"-single -vertical"})]:e._e(),r("div",{staticClass:"-unshrinkable"},[r("div",{staticClass:"form-group mb16"},[r("label",[e._v("Import indicator")]),r("button",{staticClass:"btn -blue -large -cases w-100 -file"},[r("i",{staticClass:"icon-upload mr8"}),e._v(" Browse "),r("input",{attrs:{type:"file"},on:{change:e.handleFile}})]),r("div",{staticClass:"divider -horizontal",staticStyle:{display:"flex"}},[e._v("Or")]),r("label",[e._v("Create blank indicator")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"form-control",attrs:{placeholder:"Name it"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]),r("div",{staticClass:"form-group mb16"},[r("label",[e._v("Scale with")]),r("dropdown-button",{staticClass:"-outline form-control -arrow",attrs:{options:e.availableScales,placeholder:"Default scale"},on:{input:function(t){return e.setPriceScaleId(t)}},model:{value:e.priceScaleId,callback:function(t){e.priceScaleId=t},expression:"priceScaleId"}})],1),r("div",{staticClass:"text-right"},[r("button",{staticClass:"btn -large -green ml16",on:{click:function(t){return e.createIndicator()}}},[e._v(" Start coding "),r("i",{staticClass:"icon-plus ml8"})])])])],2),r("dropdown",{model:{value:e.dropdownTrigger,callback:function(t){e.dropdownTrigger=t},expression:"dropdownTrigger"}},[r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.selectIndicator()}}},[r("i",{staticClass:"icon-plus"}),r("span",[e._v("Add to chart")])]),r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.duplicateIndicator(e.selectedIndicator)}}},[r("i",{staticClass:"icon-copy-paste"}),r("span",[e._v("Duplicate")])]),r("div",{staticClass:"dropdown-divider"}),r("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){return e.removeIndicator(e.selectedIndicator)}}},[r("i",{staticClass:"icon-trash"}),r("span",[e._v("Remove")])])])],1)},fr=[],mr=r("7250"),vr=r("1ea0"),yr=r("e7a1"),gr={mixins:[vr["a"]],components:{Dialog:mr["a"],DropdownButton:We["a"]},props:{paneId:{type:String,required:!0}},data:function(){return{name:"",priceScaleId:"right",query:"",indicators:[],selectedIndicator:null,dropdownTrigger:null}},computed:{indicatorId:function(){return Object(c["y"])(Object(c["x"])(this.name),this.indicators.map((function(e){return e.id})))},queryFilter:function(){return new RegExp(this.query.replace(/\W/,".*"),"i")},filteredIndicators:function(){var e=this;return this.indicators.filter((function(t){return e.queryFilter.test(t.name)||e.queryFilter.test(t.displayName)}))},availableScales:function(){return this.indicators.map((function(e){return e.options&&e.options.priceScaleId})).reduce((function(e,t){return!t||e[t]||(e[t]=t),e}),{"":"Own scale",right:"Main scale (right)"})}},created:async function(){await this.getIndicators()},beforeDestroy:function(){this.editor&&this.editor.destroy()},methods:{getIndicators:async function(){this.indicators=(await V["a"].getIndicators()).sort((function(e,t){return(t.uses||0)-(e.uses||0)}))},handleFile:async function(e){try{var t=await yr["a"].getJSON(e.target.files[0]);if(!t.data)throw new Error("indicator is empty");if("indicator"!==t.type)throw new Error("not an indicator");this.createIndicator({name:t.name.split(":").slice(1).join(":"),script:t.data.script||"",options:t.data.options||{}})}catch(r){this.$store.dispatch("app/showNotice",{title:r.message,type:"error"})}},createIndicator:async function(e){if(e||(e={}),e.name?this.name=e.name:this.name||(this.name="Untitled"),e.id=this.indicatorId,e.name=this.name,!e.priceScaleId){var t=Object(c["x"])(e.name);e.priceScaleId=this.priceScaleId||t}this.$store.dispatch(this.paneId+"/addIndicator",e),F["a"].openIndicator(this.paneId,e.id),this.close(null)},selectIndicator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectedIndicator;V["a"].incrementIndicatorUsage(e.id),this.$store.dispatch(this.paneId+"/addIndicator",e),this.close(null)},removeIndicator:async function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectedIndicator;await F["a"].confirm('Delete indicator "'.concat(e.name,'" ?'))&&(V["a"].deleteIndicator(e.id),this.indicators.splice(this.indicators.indexOf(e),1))},duplicateIndicator:async function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectedIndicator;this.$store.dispatch(this.paneId+"/duplicateIndicator",{paneId:this.paneId,indicatorId:e.id})},toggleDropdown:function(e,t){!e||this.dropdownTrigger&&this.selectedIndicator===t?(this.dropdownTrigger=null,this.selectedIndicator=null):(this.dropdownTrigger=e.currentTarget,this.selectedIndicator=t)},setPriceScaleId:function(e){this.priceScaleId=e}}},br=gr,Ir=Object(st["a"])(br,pr,fr,!1,null,null,null),kr=Ir.exports;function _r(e){return _r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_r(e)}function wr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Or(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Cr(e,t,r){return t&&Or(e.prototype,t),r&&Or(e,r),e}function Sr(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rr(e,t)}function Rr(e,t){return Rr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Rr(e,t)}function xr(e){var t=jr();return function(){var r,n=Pr(e);if(t){var i=Pr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Tr(this,r)}}function Tr(e,t){if(t&&("object"===_r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Er(e)}function Er(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Pr(e){return Pr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Pr(e)}var Mr=function(e){Sr(n,e);var t=xr(n);function n(){var e;return wr(this,n),e=t.apply(this,arguments),e.dropdownTrigger=null,e.selectedIndicator=null,e}return Cr(n,[{key:"indicators",get:function(){return this.$store.state[this.paneId].indicators}},{key:"ids",get:function(){return Object.values(this.indicators).map((function(e){return e.id}))}},{key:"toggleOverlay",value:function(){this.$emit("input",!this.value)}},{key:"toggleDropdown",value:function(e,t){!e||this.dropdownTrigger&&this.selectedIndicator===t?(this.dropdownTrigger=null,this.selectedIndicator=null):(this.dropdownTrigger=e.currentTarget,this.selectedIndicator=t)}},{key:"editIndicator",value:async function(e){F["a"].open((await Promise.all([r.e("chunk-d2fbbe60"),r.e("chunk-1456abbc")]).then(r.bind(null,"bb45"))).default,{paneId:this.paneId,indicatorId:e},"indicator"),this.dropdownTrigger=null}},{key:"removeIndicator",value:function(e){this.$store.dispatch(this.paneId+"/removeIndicator",{id:e})}},{key:"resizeIndicator",value:function(e){this.$store.commit(this.paneId+"/TOGGLE_LAYOUTING",e)}},{key:"duplicateIndicator",value:function(e){this.$store.dispatch(this.paneId+"/duplicateIndicator",e)}},{key:"downloadIndicator",value:function(e){this.$store.dispatch(this.paneId+"/downloadIndicator",e)}},{key:"addIndicator",value:function(){F["a"].open(kr,{paneId:this.paneId})}},{key:"onClickIndicator",value:function(e){var t=e.indicatorId,r=e.actionName,n=e.event;switch(r){case"menu":return this.toggleDropdown(n,t);case"remove":return this.removeIndicator(t);case"resize":return this.resizeIndicator(t)}return this.editIndicator(t)}}]),n}(Ut["default"]);Mr=Object(a["a"])([Object(Zt["b"])({name:"IndicatorsOverlay",components:{IndicatorControl:dr},props:{paneId:{type:String},value:{type:Boolean,required:!0}}})],Mr);var Ar=Mr,$r=Ar,Lr=(r("5aa9"),Object(st["a"])($r,Vt,Wt,!1,null,"4463ad8b",null)),Dr=Lr.exports,zr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chart-overlay__panel markets-overlay"},[e.showOverlay?r("div",{staticClass:"chart-overlay__content pane-overlay"},[r("div",{staticClass:"column"},[r("a",{staticClass:"btn -text",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.toggleMarkets("perp")}}},[e._v("perp")]),r("i",{staticClass:"pipe -center"},[e._v("|")]),r("a",{staticClass:"btn -text",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.toggleMarkets("spot")}}},[e._v("spot")]),r("i",{staticClass:"pipe -center"},[e._v("|")]),r("a",{staticClass:"btn -text",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.toggleMarkets("all")}}},[e._v("all")])]),r("div",{staticClass:"mx8 mt0"},e._l(e.markets,(function(t){return r("div",{key:t,on:{click:function(r){return e.toggleMarket(r,t)}}},[r("label",{staticClass:"checkbox-control -extra-small mb4"},[r("input",{staticClass:"form-control",attrs:{type:"checkbox"},domProps:{checked:!e.hiddenMarkets[t]},on:{click:function(e){e.stopPropagation(),e.preventDefault()}}}),r("div"),r("span",[e._v(e._s(t))])])])})),0)]):e._e(),r("div",{staticClass:"chart-overlay__title pane-overlay",on:{click:function(t){e.showOverlay=!e.showOverlay}}},[r("div",[e._v("Sources")]),r("button",{staticClass:"btn badge -outline",attrs:{type:"button"},on:{click:e.searchMarkets}},[r("span",{staticClass:"mr4"},[e._v(" "+e._s(e.visibleMarkets)+" ")]),e._v("| "),r("span",[e._v(" Add")]),r("i",{staticClass:"icon-plus -small ml4"})]),r("i",{staticClass:"icon-up-thin"})])])},Gr=[];function Br(e){return Br="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Br(e)}function Nr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qr(e,t,r){return t&&Fr(e.prototype,t),r&&Fr(e,r),e}function Hr(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vr(e,t)}function Vr(e,t){return Vr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Vr(e,t)}function Wr(e){var t=Qr();return function(){var r,n=Kr(e);if(t){var i=Kr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Ur(this,r)}}function Ur(e,t){if(t&&("object"===Br(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Zr(e)}function Zr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Kr(e){return Kr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Kr(e)}var Jr=function(e){Hr(r,e);var t=Wr(r);function r(){var e;return Nr(this,r),e=t.apply(this,arguments),e.showOverlay=!1,e}return qr(r,[{key:"markets",get:function(){return this.$store.state.panes.panes[this.paneId].markets}},{key:"hiddenMarkets",get:function(){return this.$store.state[this.paneId].hiddenMarkets}},{key:"visibleMarkets",get:function(){var e=this;return this.markets.filter((function(t){return!e.hiddenMarkets[t]})).length}},{key:"searchMarkets",value:function(e){this.$store.dispatch("app/showSearch",this.paneId),e.stopPropagation()}},{key:"toggleMarket",value:function(e,t){this.$store.dispatch(this.paneId+"/toggleMarkets",{id:t,inverse:e.shiftKey})}},{key:"toggleMarkets",value:function(e){this.$store.dispatch(this.paneId+"/toggleMarkets",{type:e})}}]),r}(Ut["default"]);Jr=Object(a["a"])([Object(Zt["b"])({name:"MarketsOverlay",props:{paneId:{type:String}}})],Jr);var Yr=Jr,Xr=Yr,en=(r("711c"),Object(st["a"])(Xr,zr,Gr,!1,null,null,null)),tn=en.exports;function rn(e){return rn="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rn(e)}function nn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function an(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function on(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function sn(e,t,r){return t&&on(e.prototype,t),r&&on(e,r),e}function cn(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}function ln(e,t){return ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ln(e,t)}function un(e){var t=pn();return function(){var r,n=fn(e);if(t){var i=fn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return hn(this,r)}}function hn(e,t){if(t&&("object"===rn(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return dn(e)}function dn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function fn(e){return fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},fn(e)}var mn=function(e){cn(r,e);var t=un(r);function r(){var e;return an(this,r),e=t.apply(this,arguments),e.axis=[null,null],e.showIndicatorsOverlay=!1,e.timeframeDropdownTrigger=null,e}return sn(r,[{key:"layouting",get:function(){return this.updateChartAxis(),this.$store.state[this.paneId].layouting}},{key:"showLegend",get:function(){return this.$store.state[this.paneId].showLegend}},{key:"favoriteTimeframes",get:function(){return this.$store.state.settings.favoriteTimeframes}},{key:"timeframe",get:function(){return this.$store.state[this.paneId].timeframe}},{key:"timeframeForHuman",get:function(){return this.timeframe?Object(c["p"])(this.timeframe):"ERR"}},{key:"alerts",get:function(){return this.$store.state[this.paneId].alerts}},{key:"created",value:function(){var e=this;this._chartController=new de(this.paneId),this._legendElements={},this._onStoreMutation=this.$store.subscribe((function(t){switch(t.type){case"settings/SET_TEXT_COLOR":e._chartController.chartInstance.applyOptions(Object(l["e"])(t.payload));break;case"settings/SET_CHART_THEME":e._chartController.chartInstance.applyOptions(Object(l["e"])());break;case"settings/TOGGLE_NORMAMIZE_WATERMARKS":e._chartController.refreshMarkets();break;case"settings/SET_TIMEZONE_OFFSET":e._chartController.setTimezoneOffset(e.$store.state.settings.timezoneOffset),e._chartController.clearChart(),e._chartController.renderAll();break;case"panes/SET_PANE_MARKETS":t.payload.id===e.paneId&&(e.$store.state[e.paneId].hiddenMarkets={},e._chartController.refreshMarkets(),e.clear(),e.fetch());break;case"panes/SET_PANE_ZOOM":t.payload.id===e.paneId&&e._chartController.updateFontSize(),e.updateChartAxis();break;case e.paneId+"/SET_TIMEFRAME":e.setTimeframe(t.payload);break;case"settings/TOGGLE_ALERTS":case"app/EXCHANGE_UPDATED":case e.paneId+"/TOGGLE_MARKET":e._chartController.refreshMarkets(),e._chartController.renderAll();break;case e.paneId+"/SET_REFRESH_RATE":e._chartController.clearQueue(),e._chartController.setupQueue();break;case e.paneId+"/TOGGLE_LEGEND":e.showLegend?e.bindLegend():e.unbindLegend();break;case e.paneId+"/SET_GRIDLINES":e.updateGridlines(t.payload.type);break;case e.paneId+"/SET_WATERMARK":case e.paneId+"/TOGGLE_NORMAMIZE_WATERMARKS":e._chartController.updateWatermark();break;case e.paneId+"/SET_INDICATOR_OPTION":e._chartController.setIndicatorOption(t.payload.id,t.payload.key,t.payload.value,t.payload.silent);break;case e.paneId+"/SET_PRICE_SCALE":t.payload.priceScale&&e._chartController.refreshPriceScale(t.payload.id);break;case e.paneId+"/SET_INDICATOR_SCRIPT":e._chartController.rebuildIndicator(t.payload.id);break;case e.paneId+"/ADD_INDICATOR":e._chartController.addIndicator(t.payload.id)&&(e._chartController.redrawIndicator(t.payload.id),e.bindLegend(t.payload.id));break;case e.paneId+"/REMOVE_INDICATOR":e.unbindLegend(t.payload),e._chartController.removeIndicator(t.payload);break;case e.paneId+"/TOGGLE_FILL_GAPS_WITH_EMPTY":e._chartController.toggleFillGapsWithEmpty();break;case e.paneId+"/TOGGLE_FORCE_NORMALIZE_PRICE":e._chartController.propagateInitialPrices=e.$store.state[e.paneId].forceNormalizePrice,e.clear(),e.fetch();break;case"settings/TOGGLE_AUTO_HIDE_HEADERS":e.refreshChartDimensions();break}}))}},{key:"mounted",value:function(){this.showIndicatorsOverlay=this.$parent.$el.clientHeight>420,this.createChart()}},{key:"createChart",value:async function(){await this.$nextTick(),this._chartController.createChart(this.$refs.chartContainer),await this.$nextTick(),this.bindChartEvents(),this.setupRecycle(),this.fetch(),this._chartController.setupQueue()}},{key:"destroyChart",value:function(){this.unbindChartEvents(),this._chartController.destroy(),clearTimeout(this._recycleTimeout)}},{key:"beforeDestroy",value:function(){this.destroyChart()}},{key:"fetch",value:function(e){var t=this;e||(this._reachedEnd=!1);var r=this._chartController.chartCache.cacheRange&&this._chartController.chartCache.cacheRange.from,n=ze.filterOutUnavailableMarkets(this.$store.state.panes.panes[this.paneId].markets);if(n.length){var i=+this.$store.state[this.paneId].timeframe;if(i){if(-1!==this.$store.state.app.apiSupportedTimeframes.indexOf(this.timeframe.toString())){var a,o,s=this._chartController.getVisibleRange();if(e)a=e;else o=r?this._chartController.chartCache.cacheRange.from:s&&s.from?s.from+this.$store.state.settings.timezoneOffset/1e3:Date.now()/1e3,a={from:o-20*i,to:o};a.from=Object(c["h"])(Math.round(a.from),i),a.to=Object(c["h"])(Math.round(a.to),i)+i,this._chartController.chartCache.cacheRange.from&&(a.to=Math.min(Object(c["h"])(this._chartController.chartCache.cacheRange.from,i),a.to));var l=Math.floor((a.to-a.from)/i),u=112,h=Object(c["i"])(l*n.length*u);return this.$store.dispatch("app/showNotice",{id:"fetching-"+this.paneId,timeout:15e3,title:"Fetching ".concat(l*n.length," bars (~").concat(h,")"),type:"info"}),this._loading=!0,ze.fetch(1e3*a.from,1e3*a.to,i,n).then((function(e){return t.onHistorical(e)})).catch((function(e){t._reachedEnd=!0})).then((function(){t.$store.dispatch("app/hideNotice","fetching-"+t.paneId),setTimeout((function(){t._loading=!1,t.fetchMore(t._chartController.chartInstance.timeScale().getVisibleLogicalRange())}),200)}))}}else this._reachedEnd=!0}}},{key:"onCrosshair",value:function(e){var t;if(e&&e.time&&e.point.x>0&&e.point.x<this.$refs.chartContainer.clientWidth&&(t=e.point.x),this._lastCrosshairCoordinates!==t){this._lastCrosshairCoordinates=t;for(var r=0;r<this._chartController.loadedIndicators.length;r++){var n=this._chartController.loadedIndicators[r];if(n.apis.length){var i=this.paneId+n.id;if(this._legendElements[i]&&t){for(var a="",o=0;o<n.apis.length;o++){if(o>10)break;var s=n.apis[o],c=e.seriesPrices.get(s);if(a.length&&(a+=" | "),c){var l=n.options.priceFormat&&"volume"===n.options.priceFormat.type?U["c"]:U["e"];"number"===typeof c?a+=l(c,s.precision):c.close&&(a+="O: ".concat(l(c.open,s.precision)," H: ").concat(l(c.high,s.precision)," L: ").concat(l(c.low,s.precision)," C: ").concat(l(c.close,s.precision)))}else a+="na"}this._legendElements[i].textContent=a}}}}}},{key:"onHistorical",value:function(e){var t={from:e.from,to:e.to,bars:e.data};this._chartController.chartCache.saveChunk(t),this.$store.state[this.paneId].forceNormalizePrice||(this._chartController.propagateInitialPrices=!1),this._chartController.renderAll(!0)}},{key:"onTrades",value:function(e){this._chartController.queueTrades(e)}},{key:"onAlert",value:function(e){var t=e.price,r=e.market;this._chartController.triggerAlert(r,t)}},{key:"refreshChartDimensions",value:function(){var e=this;this._chartController&&this._chartController.chartInstance&&this.$nextTick((function(){var t=0;e.$store.state.settings.autoHideHeaders||(t=2*(e.$store.state.panes.panes[e.paneId].zoom||1)*16),e._chartController.chartInstance.resize(e.$el.clientWidth,e.$el.clientHeight-t)}))}},{key:"onPan",value:function(e){var t=this;!e||this._chartController.panPrevented||this._loading||/t$/.test(this.timeframe)||(this._onPanTimeout&&(clearTimeout(this._onPanTimeout),this._onPanTimeout=null),this._onPanTimeout=setTimeout((function(){t._onPanTimeout=null,null!==t._chartController.chartCache.cacheRange.from&&(e=t._chartController.chartInstance.timeScale().getVisibleLogicalRange(),t.savePosition(e),t.fetchMore(e))}),500))}},{key:"bindChartEvents",value:function(){H["a"].on("trades",this.onTrades),H["a"].on("alert",this.onAlert),this.showLegend&&this.showIndicatorsOverlay&&this.bindLegend(),this._chartController.chartInstance.timeScale().subscribeVisibleLogicalRangeChange(this.onPan);var e=this._chartController.chartElement.querySelector("canvas:nth-child(2)");e.addEventListener(Object(W["b"])()?"touchstart":"mousedown",this.onLevelDragStart)}},{key:"unbindChartEvents",value:function(){H["a"].off("trades",this.onTrades),H["a"].off("alert",this.onAlert),this.unbindLegend(),this._chartController.chartInstance.timeScale().unsubscribeVisibleLogicalRangeChange(this.onPan);var e=this._chartController.chartElement.querySelector("canvas:nth-child(2)");e.removeEventListener(Object(W["b"])()?"touchstart":"mousedown",this.onLevelDragStart)}},{key:"onLevelDragStart",value:function(e){if(!this._levelDragEndHandler&&this.$store.state.settings.alerts&&!e.button&&!F["a"].hasDialogOpened){var t=this._chartController.getPricelineAtPoint(e);if(t&&t.api){var r=this._chartController.chartElement.querySelector("canvas:nth-child(2)");t.priceline&&this._chartController.disableCrosshair(),this._levelDragMoveHandler=this.onLevelDragMove.bind(this,t,Date.now()),r.addEventListener(/touch/.test(e.type)?"touchmove":"mousemove",this._levelDragMoveHandler),this._levelDragEndHandler=this.onLevelDragEnd.bind(this,t,Date.now()),r.addEventListener(/touch/.test(e.type)?"touchend":"mouseup",this._levelDragEndHandler)}}}},{key:"onLevelDragMove",value:function(e,t,r){var n=e.api,i=e.priceline,a=e.originalOffset,o=e.offset,s=Object(W["a"])(r),c=s.x,l=s.y,u=Math.abs(a.y-l)>5||Date.now()-t>100;if(o.x=c,o.y=l,i){if(r.stopPropagation(),!u)return;var h=+Object(U["e"])(n.coordinateToPrice(l),n.options().priceFormat.precision);i.applyOptions({price:h})}}},{key:"onLevelDragEnd",value:async function(e,t,r){var n=this,i=e.api,a=e.priceline,o=e.price,s=e.market,c=e.canCreate,l=e.originalOffset,u=e.offset,h=this._chartController.chartElement.querySelector("canvas:nth-child(2)"),d=Math.abs(l.y-u.y)>5||Date.now()-t>200;if(c=!a&&c&&!d,(a||c)&&this._chartController.chartInstance.clearCrosshairPosition(),h.removeEventListener(/touch/.test(r.type)?"touchend":"mouseup",this._levelDragEndHandler),this._levelDragEndHandler=null,this._levelDragMoveHandler&&(h.removeEventListener(/touch/.test(r.type)?"touchmove":"mousemove",this._levelDragMoveHandler),this._levelDragMoveHandler=null),!this._onPanTimeout)if(a){this._chartController.enableCrosshair();var p=this._chartController.alerts[s].find((function(e){return e.price===o})),f=a.options().price;if(o!==f&&d){var m=await Ge["a"].moveAlert(s,o,f);p.triggered=!1,p.price=f,p.active=m,await V["a"].saveAlerts({market:s,alerts:this._chartController.alerts[s].filter((function(e){return e.market===p.market}))}),a.applyOptions({title:""})}else{i.removePriceLine(a);try{await Ge["a"].unsubscribe(s,o)}catch(w){p&&p.active&&this.$store.dispatch("app/showNotice",{id:"alert-registration-failure",title:"".concat(w.message,"\nYou need to make sure your browser is set to allow push notifications."),type:"error"})}var v=this._chartController.alerts[s].indexOf(p);-1!==v&&this._chartController.alerts[s].splice(v,1),await V["a"].saveAlerts({market:s,alerts:this._chartController.alerts[s].filter((function(e){return e.price!==o}))})}}else if(c){var y,g=Object(pe["k"])(this.$store.state.settings.alertsColor),b=g[3]||1;g[3]=.5*b,r.ctrlKey||r.metaKey||(y=this._chartController.chartInstance.timeScale().coordinateToTime(u.x));var I,k=this._chartController.renderAlert({price:o,market:s,timestamp:y},i,Object(pe["i"])(g)),_={price:o,market:s,timestamp:y,active:!1};this._chartController.alerts[s].push(_),await Ge["a"].subscribe(s,o).then((function(e){if(-1!==n._chartController.alerts[s].indexOf(_)){_.active=e;var t=e?b:.75*b;g[3]=t,I=Object(pe["i"])(g)}})).catch((function(e){n.$store.dispatch("app/showNotice",{id:"alert-registration-failure",title:"".concat(e.message,"\nYou need to make sure your browser is set to allow push notifications."),type:"error"}),I=n.$store.state.settings.alertsColor})).finally((function(){V["a"].saveAlerts({market:s,alerts:n._chartController.alerts[s]}),k.applyOptions({color:I})}))}}},{key:"getBarSpacing",value:function(e){if(!e)return l["a"].timeScale.barSpacing;var t=this.$refs.chartContainer.querySelector("canvas").width;return t/(e.to-e.from)/window.devicePixelRatio}},{key:"savePosition",value:function(e){this.$store.commit(this.paneId+"/SET_BAR_SPACING",this.getBarSpacing(e))}},{key:"setupRecycle",value:function(){this._recycleTimeout=setTimeout(this.trimChart.bind(this),18e4),this.setTimeToRecycle()}},{key:"trimChart",value:function(){if(Date.now()>this._timeToRecycle){var e,t=this._chartController.getVisibleRange();t&&(e=t.from-2*(t.to-t.from)),this._chartController.chartCache.trim(e)&&this.renderChart(),this.setTimeToRecycle()}var r=this.$store.state[this.paneId].refreshRate<1e3;r&&this.fixFastRefreshRate(),this._recycleTimeout=setTimeout(this.trimChart,6e4*(r?3:15))}},{key:"fixFastRefreshRate",value:function(){var e=this,t=this._chartController.chartInstance.options().layout.fontSize;this._chartController.preventPan(),this._chartController.chartInstance.applyOptions({layout:{fontSize:t+1}}),setTimeout((function(){e._chartController.chartInstance.applyOptions({layout:{fontSize:t}})}),50)}},{key:"renderChart",value:function(){this._chartController.renderAll()}},{key:"resetChart",value:function(){var e=this;this.destroyChart(),this.$nextTick((function(){e.createChart()}))}},{key:"fetchMore",value:async function(e){if(!(this._loading||this._reachedEnd||!e||e.from>0)){var t=0;if(this._chartController.activeRenderer)for(var r in this._chartController.activeRenderer.indicators)this._chartController.activeRenderer.indicators[r].minLength&&(t=Math.max(t,this._chartController.activeRenderer.indicators[r].minLength));var n=Math.round(Math.min(Math.abs(e.from)+t,500));if(n){var i={from:this._chartController.chartCache.cacheRange.from-n*this.$store.state[this.paneId].timeframe,to:this._chartController.chartCache.cacheRange.from-1};await this.fetch(i)}}}},{key:"onResize",value:function(){this.refreshChartDimensions()}},{key:"clear",value:function(){this._chartController.clear(),this._reachedEnd=!1}},{key:"changeTimeframe",value:function(e){if(window.event.shiftKey)for(var t in this.$store.state.panes.panes){var r=this.$store.state.panes.panes[t].type;"chart"===r&&this.$store.state[t].timeframe!==e&&this.$store.commit(t+"/SET_TIMEFRAME",e)}else this.$store.commit(this.paneId+"/SET_TIMEFRAME",e)}},{key:"setTimeframe",value:function(e){var t=parseInt(e),r="t"===e[e.length-1]?"tick":"time";r===this._chartController.type&&"time"===r&&this._chartController.timeframe<t&&-1===this.$store.state.app.apiSupportedTimeframes.indexOf(e)&&Number.isInteger(t/this._chartController.timeframe)?(this._chartController.resample(e),this.fetchMore(this._chartController.chartInstance.timeScale().getVisibleLogicalRange())):(this._chartController.clear(),this.fetch()),this._reachedEnd=!1}},{key:"bindLegend",value:async function(e){if(this.showLegend)if(e){await this.$nextTick();var t=this.paneId+e;if(!this._legendElements[t]){var r=document.getElementById(t);r&&(this._legendElements[t]=r)}}else{for(var n in this.$store.state[this.paneId].indicators)this.bindLegend(n);this._chartController.chartInstance.subscribeCrosshairMove(this.onCrosshair)}}},{key:"unbindLegend",value:function(e){if(e){var t=this.paneId+e;for(var r in this._legendElements)if(t===r)return this._legendElements[r].innerText="",void delete this._legendElements[r]}else{for(var n in this.$store.state[this.paneId].indicators)this.unbindLegend(n);this._chartController.chartInstance.unsubscribeCrosshairMove(this.onCrosshair)}}},{key:"updateGridlines",value:function(e){var t,r,n=this.$store.state[this.paneId];"vertical"===e?(t=n.showVerticalGridlines,r=n.verticalGridlinesColor):(t=n.showHorizontalGridlines,r=n.horizontalGridlinesColor),this._chartController.chartInstance.applyOptions({grid:nn({},"vertical"===e?"vertLines":"horzLines",{color:r,visible:t})})}},{key:"updateWatermark",value:function(){var e=this.$store.state[this.paneId];this._chartController.chartInstance.applyOptions({watermark:{color:e.watermarkColor,visible:e.showWatermark}})}},{key:"updateChartAxis",value:function(){this.$refs.chartContainer&&(this.axis=[this.$refs.chartContainer.querySelector("td:last-child canvas:nth-child(2)").clientWidth,this.$refs.chartContainer.querySelector("tr:last-child").clientHeight])}},{key:"takeScreenshot",value:function(){var e=this,t=this._chartController.chartInstance.takeScreenshot(),r=document.createElement("canvas"),n=r.getContext("2d"),i=this.$store.state.panes.panes[this.paneId].zoom||1,a=window.devicePixelRatio||1,o=16*i*a,s=12*i*a;r.width=t.width,n.font="".concat(s,"px Share Tech Mono"),n.textAlign="left",n.textBaseline="top";var l=[],u=(new Date).toUTCString(),h=this.$store.state.panes.panes[this.paneId].markets.filter((function(t){return!e.$store.state[e.paneId].hiddenMarkets[t]})).length;l.push(u+" | "+this.timeframeForHuman),l.push(this._chartController.watermark+(h>1&&this.$store.state.settings.normalizeWatermarks?" ("+h+" markets)":""));var d=Math.round(s);r.height=t.height;var p=this.$store.state.settings.backgroundColor,f=getComputedStyle(document.documentElement).getPropertyValue("--theme-color-100");n.fillStyle=p,n.fillRect(0,0,r.width,r.height),n.fillStyle="light"===this.$store.state.settings.theme?"rgba(255,255,255,.2)":"rgba(0,0,0,.2)",n.fillRect(0,0,r.width,r.height),n.drawImage(t,0,0),n.fillStyle=f,n.font="".concat(s,"px Share Tech Mono"),n.textAlign="left",n.textBaseline="top";for(var m=0,v=0;v<l.length;v++)n.fillText(l[v],o,o+m),m+=d*(v+1);var y=Object(pe["d"])(Object(pe["k"])(p)),g=y<0?"#ffffff":"#000000";this.showIndicatorsOverlay&&(m+=2*o,Object.values(this.$store.state[this.paneId].indicators).forEach((function(e){var t=e.options;if(!1!==t.visible){var r=t.color||t.upColor||g;try{r=Object(pe["k"])(r),"undefined"!==typeof r[3]&&(r[3]=1),r=Object(pe["i"])(r)}catch(a){}var i=e.displayName||e.name;n.fillStyle=p,n.fillText(i,o+1,m+1),n.fillText(i,o-1,m-1),n.fillStyle=r,n.fillText(i,o,m),m+=1.2*d}})));var b=r.toDataURL("image/png"),I=b.indexOf("base64,")+7,k=b.substr(I);Object(c["s"])(k,"image/png")}},{key:"toggleIndicatorOverlay",value:function(){var e=this;this.showIndicatorsOverlay&&this.unbindLegend(),this.showIndicatorsOverlay=!this.showIndicatorsOverlay,this.showIndicatorsOverlay&&this.$nextTick((function(){e.bindLegend()}))}},{key:"toggleLayout",value:function(){this.$store.commit(this.paneId+"/TOGGLE_LAYOUTING")}},{key:"setTimeToRecycle",value:function(){var e=Date.now();if("time"===this._chartController.type){var t=this.$refs.chartContainer.querySelector("canvas").width,r=this.getBarSpacing(this._chartController.chartInstance.timeScale().getVisibleLogicalRange());this._timeToRecycle=e+Math.min(864e5,1e3*parseInt(this.timeframe)*(t/r)/2)}this._timeToRecycle=e+9e5}},{key:"toggleTimeframeDropdown",value:function(e){this.timeframeDropdownTrigger?this.timeframeDropdownTrigger=null:this.timeframeDropdownTrigger=e.currentTarget}}]),r}(Object(o["b"])(Be["a"]));mn=Object(a["a"])([Object(o["a"])({name:"Chart",components:{ChartLayout:Ct,PaneHeader:Ne["a"],TimeframeDropdown:Ht,IndicatorsOverlay:Dr,MarketsOverlay:tn}})],mn);var vn=mn,yn=vn,gn=(r("474f"),Object(st["a"])(yn,n,i,!1,null,"4747b63b",null));t["default"]=gn.exports},c994:function(e,t,r){},cce1:function(e,t,r){"use strict";r("018d")},d4d0:function(e,t,r){"use strict";r("3cd6")},e983:function(e,t,r){},fa84:function(e,t,r){"use strict";r("9feb")}}]);
//# sourceMappingURL=chunk-35847707.32238db9.js.map